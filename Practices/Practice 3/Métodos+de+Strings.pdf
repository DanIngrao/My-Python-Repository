:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function Wl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Kl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return h(this,n)}}var Yl=function(e){d(C,e);var n,r,i,s,l,u,h,f,v=Kl(C);function C(e,t,n){var r;return o(this,C),pe(p(r=v.call(this,e)),"checkoutPageUrlData",void 0),pe(p(r),"checkoutPageData",void 0),pe(p(r),"rewardsData",void 0),pe(p(r),"contextID",void 0),pe(p(r),"logService",void 0),pe(p(r),"entryPointService",void 0),pe(p(r),"autoApplyScenario",H.AutoApplyCoupons),r.logService=t,r.entryPointService=n,r}return c(C,[{key:"WaitForOrderElement",value:(f=t(a().mark((function e(n,r,o){var i=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkoutPageUrlData.supportedNoOrderTotal){e.next=4;break}return e.next=3,Wt.WaitForCondition(t(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.IsFieldVisible(n,r,"Check Order Data Exists");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),o);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return f.apply(this,arguments)})},{key:"WaitForOrderElementInBackground",value:(h=t(a().mark((function e(){var n=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Wt.WaitForCondition(t(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.GetOrderTotal();case 2:return e.t0=e.sent,e.abrupt("return",e.t0>0);case 4:case"end":return e.stop()}}),e)}))),3e3);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(){return h.apply(this,arguments)})},{key:"GetPageCurrency",value:(u=t(a().mark((function e(){var t,n,r,o,i,s,l,c,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.checkoutPageUrlData.orderTotalDataElementSelector){e.next=27;break}t="Get Currency",n=this.checkoutPageUrlData.orderTotalDataElementSelector,r=n.split(","),o=0;case 5:if(!(o<r.length)){e.next=25;break}return i=r[o],e.prev=7,e.next=10,this.GetCurrencyValue(i,t);case 10:return e.abrupt("return",e.sent);case 13:if(e.prev=13,e.t0=e.catch(7),(null===e.t0||void 0===e.t0?void 0:e.t0.name)!==ja.AutoApplyCancelled){e.next=17;break}throw e.t0;case 17:if(o!==r.length-1){e.next=22;break}return l={DomElement:i,EntryPoint:null===(s=this.entryPointService)||void 0===s?void 0:s.GetEntryPoint(),FunctionName:t,Scenario:this.autoApplyScenario},c=new na(this.checkoutPageData.retailerData.domainName,Qr.GetBoxValue,l,e.t0.stack),this.logService.LogClientErrorV2(e.t0.message,c),e.abrupt("return","$");case 22:o++,e.next=5;break;case 25:e.next=31;break;case 27:if(!this.checkoutPageUrlData.supportedNoOrderTotal){e.next=31;break}if(!(u=Gl("pageCurrency"))){e.next=31;break}return e.abrupt("return",u);case 31:return e.abrupt("return","$");case 32:case"end":return e.stop()}}),e,this,[[7,13]])}))),function(){return u.apply(this,arguments)})},{key:"GetOrderTotal",value:(l=t(a().mark((function e(){var t,n,r,o,i,s,l,c,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.checkoutPageUrlData.orderTotalDataElementSelector){e.next=27;break}t="Get order total",n=this.checkoutPageUrlData.orderTotalDataElementSelector,r=n.split(","),o=0;case 5:if(!(o<r.length)){e.next=25;break}return i=r[o],e.prev=7,e.next=10,this.GetBoxValue(i,t);case 10:return e.abrupt("return",e.sent);case 13:if(e.prev=13,e.t0=e.catch(7),(null===e.t0||void 0===e.t0?void 0:e.t0.name)!==ja.AutoApplyCancelled){e.next=17;break}throw e.t0;case 17:if(o!==r.length-1){e.next=22;break}throw l={DomElement:i,EntryPoint:null===(s=this.entryPointService)||void 0===s?void 0:s.GetEntryPoint(),FunctionName:t,Scenario:this.autoApplyScenario},c=new na(this.checkoutPageData.retailerData.domainName,Qr.GetBoxValue,l,e.t0.stack),this.logService.LogClientErrorV2(e.t0.message,c),e.t0;case 22:o++,e.next=5;break;case 25:e.next=31;break;case 27:if(!this.checkoutPageUrlData.supportedNoOrderTotal){e.next=31;break}if(!(u=Gl("orderTotal"))){e.next=31;break}return e.abrupt("return",JSON.parse(u));case 31:return e.abrupt("return",-1);case 32:case"end":return e.stop()}}),e,this,[[7,13]])}))),function(){return l.apply(this,arguments)})},{key:"GetOrderSubTotal",value:(s=t(a().mark((function e(){var t,n,r,o,i,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.checkoutPageUrlData.orderSubTotalElementSelector){e.next=30;break}t="Get order subtotal",n=this.checkoutPageUrlData.orderSubTotalElementSelector,r=n.split(","),o=Hl(r),e.prev=5,o.s();case 7:if((i=o.n()).done){e.next=22;break}return s=i.value,e.prev=9,e.next=12,this.GetBoxValue(s,t);case 12:return e.abrupt("return",e.sent);case 15:if(e.prev=15,e.t0=e.catch(9),(null===e.t0||void 0===e.t0?void 0:e.t0.name)!==ja.AutoApplyCancelled){e.next=19;break}throw e.t0;case 19:return e.abrupt("return",-1);case 20:e.next=7;break;case 22:e.next=27;break;case 24:e.prev=24,e.t1=e.catch(5),o.e(e.t1);case 27:return e.prev=27,o.f(),e.finish(27);case 30:return e.abrupt("return",-1);case 31:case"end":return e.stop()}}),e,this,[[5,24,27,30],[9,15]])}))),function(){return s.apply(this,arguments)})},{key:"GetAppliedCoupon",value:(i=t(a().mark((function e(){var t,n,r,o,i,s,l,c,u,d,p,h;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="Get applied coupon",r=this.checkoutPageUrlData.inputBoxSelector,o=null!==(t=this.checkoutPageUrlData.appliedCouponSelector)&&void 0!==t?t:r,!Wt.IsValidDataField(o)){e.next=19;break}return e.prev=4,e.next=7,this.SendDomMessage(this.contextID,new ci(qr.GetAppliedCoupon,o,""),n,!0);case 7:if(i=e.sent,(s=i.TextValue)||o!==r||(c=la.GetFirstVisibleElement(r),u=null!==(l=null==c?void 0:c.getAttribute("value"))&&void 0!==l?l:"",s=u.replace(/[^a-z0-9]/gim,"")),!s||this.IsUserCouponInOurCorpus(s)){e.next=12;break}return e.abrupt("return",new Bl(s,!1,!1,!1));case 12:e.next=19;break;case 14:e.prev=14,e.t0=e.catch(4),p={DomElement:o,EntryPoint:null===(d=this.entryPointService)||void 0===d?void 0:d.GetEntryPoint(),FunctionName:n,Scenario:this.autoApplyScenario},h=new na(this.checkoutPageData.retailerData.domainName,Qr.GetAppliedCoupon,p,e.t0.stack),this.logService.LogClientErrorV2(e.t0.message,h);case 19:return e.abrupt("return",void 0);case 20:case"end":return e.stop()}}),e,this,[[4,14]])}))),function(){return i.apply(this,arguments)})},{key:"GetAutoApplyTime",value:function(e){return null!=e&&e.StartTime?Date.now()-e.StartTime:-1}},{key:"IsUserCouponInOurCorpus",value:function(e){return void 0!==this.checkoutPageData.coupons.find((function(t){return!t.isLowSuccessRateCoupon&&t.couponCode.toLowerCase()===e.toLowerCase()}))}},{key:"GetBoxValue",value:(r=t(a().mark((function e(t,n){var r,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Wt.IsValidDataField(t)){e.next=11;break}return e.prev=1,e.next=4,this.SendDomMessage(this.contextID,new ci(qr.GetTextValue,t,""),n,!0);case 4:return r=e.sent,e.abrupt("return",jt(r.TextValue));case 8:e.prev=8,e.t0=e.catch(1),mn(null!==(o=null===e.t0||void 0===e.t0?void 0:e.t0.name)&&void 0!==o?o:"",null===e.t0||void 0===e.t0?void 0:e.t0.message);case 11:return e.abrupt("return",-1);case 12:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(e,t){return r.apply(this,arguments)})},{key:"GetCurrencyValue",value:(n=t(a().mark((function e(t,n){var r,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Wt.IsValidDataField(t)){e.next=11;break}return e.prev=1,e.next=4,this.SendDomMessage(this.contextID,new ci(qr.GetTextValue,t,""),n,!0);case 4:return r=e.sent,e.abrupt("return",tn(r.TextValue));case 8:e.prev=8,e.t0=e.catch(1),mn(null!==(o=null===e.t0||void 0===e.t0?void 0:e.t0.name)&&void 0!==o?o:"",null===e.t0||void 0===e.t0?void 0:e.t0.message);case 11:return e.abrupt("return","$");case 12:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(e,t){return n.apply(this,arguments)})}]),C}(Ri);pe(Yl,"AutoTriggered"," AutoTriggered: true");var zl=Yl;function jl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return h(this,n)}}var Jl=function(e){d(n,e);var t=jl(n);function n(e,r,a,i,s,l){var c;return o(this,n),pe(p(c=t.call(this)),"CouponCode",void 0),pe(p(c),"Domain",void 0),pe(p(c),"Scenario",void 0),pe(p(c),"PageUrl",void 0),pe(p(c),"data",void 0),pe(p(c),"description",void 0),c.CouponCode=e,c.Domain=r,c.Scenario=a,c.PageUrl=i,c.data=null!=s?s:"",c.description=l,c}return c(n)}(wn);function Xl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return h(this,n)}}var Ql=function(e){d(n,e);var t=Xl(n);function n(e,r){var a;return o(this,n),pe(p(a=t.call(this,L.SelectorExtractionMessage)),"Command",void 0),pe(p(a),"InputPath",void 0),a.Command=e,a.InputPath=r,a}return c(n)}(fe);function Zl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return h(this,n)}}var ql,$l,ec=function(e){d(n,e);var t=Zl(n);function n(e,r,a){var i,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return o(this,n),pe(p(i=t.call(this,r,"","")),"ContextID",void 0),pe(p(i),"Command",void 0),pe(p(i),"checkoutPageUrlData",void 0),pe(p(i),"shouldObserveStatusSelector",void 0),i.ContextID=e,i.Command=r,i.checkoutPageUrlData=a,i.shouldObserveStatusSelector=s,i}return c(n)}(ci),tc=ec;function nc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return h(this,n)}}!function(e){e[e.ConfirmedProductPage=0]="ConfirmedProductPage",e[e.ProductPage=1]="ProductPage",e[e.Homepage=2]="Homepage",e[e.CheckoutPage=3]="CheckoutPage"}(ql||(ql={})),function(e){e[e.Selector=0]="Selector",e[e.Automated=1]="Automated"}($l||($l={}));var rc,ac=function(e){d(n,e);var t=nc(n);function n(){var e;o(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return pe(p(e=t.call.apply(t,[this].concat(a))),"source",void 0),pe(p(e),"extraction",void 0),pe(p(e),"timestamp",void 0),pe(p(e),"numberOfFails",void 0),e}return c(n)}(Ll),oc=ac;!function(e){e.NotSuggestedCoupon="NotSuggestedCoupon",e.NewSuggestedCoupon="NewSuggestedCoupon",e.ExistingSuggestedCoupon="ExistingSuggestedCoupon"}(rc||(rc={}));var ic,sc,lc=function(){function e(){o(this,e),pe(this,"isPersonalizationDataConsentEnabled",void 0),pe(this,"isPersonalizationDataConsentChanged",void 0),pe(this,"isAnonymousFlowEnabled",void 0),pe(this,"isBingSignedInUser",void 0),pe(this,"isMSASignedIn",void 0),pe(this,"isSSOEnabled",void 0),pe(this,"isRebatesUser",void 0),pe(this,"ageGroup",void 0),pe(this,"anonymousUserId",""),pe(this,"isAadEmailPresent",!1),pe(this,"isAADSignedIn",void 0),pe(this,"isMarketingCampaignEventEnrolled",void 0),pe(this,"isCashbackPlatformAcknowledged",void 0),pe(this,"isAADLinkedAccountValid",void 0),pe(this,"isLinkingPolicyEnabled",void 0),pe(this,"hanid",void 0)}return c(e,null,[{key:"Create",value:function(t,n,r,a,o){var i,s,l,c,u,d,p,h,f,v,C,g,S,m,A,E,y,I,T,O,P,k,_,b=new e;return b.isRebatesUser=n||(null==t||null===(i=t.cashback)||void 0===i||null===(s=i.userRebateResponse)||void 0===s?void 0:s.isRebatesUser)||!1,b.isBingSignedInUser=null!==(l=null==t||null===(c=t.userInfo)||void 0===c?void 0:c.isBingSignedInUser)&&void 0!==l&&l,b.isMSASignedIn=null!==(u=null==t||null===(d=t.userInfo)||void 0===d?void 0:d.isMSASignedIn)&&void 0!==u&&u,b.isSSOEnabled=null!==(p=null==t||null===(h=t.userInfo)||void 0===h?void 0:h.isSSOEnabled)&&void 0!==p&&p,b.isPersonalizationDataConsentEnabled=null!==(f=null==t||null===(v=t.userInfo)||void 0===v?void 0:v.isPersonalizationDataConsentEnabled)&&void 0!==f&&f,b.isPersonalizationDataConsentChanged=null!==(C=null==t||null===(g=t.userInfo)||void 0===g?void 0:g.isPersonalizationDataConsentChanged)&&void 0!==C&&C,b.ageGroup=null!==(S=null==t||null===(m=t.userInfo)||void 0===m?void 0:m.ageGroup)&&void 0!==S?S:void 0,b.isAnonymousFlowEnabled=null!==(A=null==t||null===(E=t.itemLevelCashBack)||void 0===E?void 0:E.isAnonymousFlowEnabled)&&void 0!==A&&A,b.isAadEmailPresent=!!r,b.isAADSignedIn=null!==(y=null==t||null===(I=t.userInfo)||void 0===I?void 0:I.isAADSignedIn)&&void 0!==y&&y,b.isMarketingCampaignEventEnrolled=null==t||null===(T=t.promotionalCampaignDealsResponse)||void 0===T?void 0:T.isEnrolled,b.isCashbackPlatformAcknowledged=null==t||null===(O=t.promotionalCampaignDealsResponse)||void 0===O?void 0:O.isCashbackPlatformAcknowledged,b.isAADLinkedAccountValid=Wt.parseBool(a)||(null==t||null===(P=t.userInfo)||void 0===P?void 0:P.isAADLinkedAccountValid)||!1,b.isLinkingPolicyEnabled=Wt.parseBool(o),b.hanid=null!==(k=null==t||null===(_=t.userInfo)||void 0===_?void 0:_.hanid)&&void 0!==k?k:"",b}}]),e}(),cc=function(){function e(){o(this,e),pe(this,"hasLink",void 0),pe(this,"couponCodeElement",void 0),pe(this,"couponCodeHash",void 0),pe(this,"retailerElement",void 0),pe(this,"retailerHash",void 0),pe(this,"channelId",void 0),pe(this,"username",void 0)}return c(e,null,[{key:"Create",value:function(t){var n=new e;return n.hasLink=t.hasLink,n.couponCodeElement=t.couponCodeElement,n.couponCodeHash=t.couponCodeHash,n.retailerElement=t.retailerElement,n.retailerHash=t.retailerHash,n.channelId=t.channelId,n.username=t.username,n}}]),e}(),uc=c((function e(){o(this,e),pe(this,"type",void 0),pe(this,"urlRegex",void 0),pe(this,"validationSelector",void 0),pe(this,"details",void 0),pe(this,"urlFields",void 0)}));!function(e){e.OrderId="orderId"}(ic||(ic={})),function(e){e[e.OrderId=0]="OrderId",e[e.OrderTotalPrice=1]="OrderTotalPrice",e[e.OrderSubTotalPrice=2]="OrderSubTotalPrice",e[e.OrderTaxesPrice=3]="OrderTaxesPrice",e[e.OrderShippingPrice=4]="OrderShippingPrice",e[e.OrderDiscountPrice=5]="OrderDiscountPrice",e[e.OrderDiscountCode=6]="OrderDiscountCode",e[e.OrderShippingDiscountPrice=7]="OrderShippingDiscountPrice",e[e.OrderSubTotalOriginalPrice=8]="OrderSubTotalOriginalPrice",e[e.ProductName=9]="ProductName",e[e.ProductQuantity=10]="ProductQuantity",e[e.ProductTotalPrice=11]="ProductTotalPrice",e[e.ProductItemPrice=12]="ProductItemPrice",e[e.ProductPrice=13]="ProductPrice",e[e.ProductId=14]="ProductId",e[e.AddToCartButton=15]="AddToCartButton",e[e.PlaceOrderButton=16]="PlaceOrderButton",e[e.ProductImgSelector=17]="ProductImgSelector",e[e.GetProductNamesFromImg=18]="GetProductNamesFromImg",e[e.AddCartMonitor=19]="AddCartMonitor",e[e.CartMonitorSelector=20]="CartMonitorSelector"}(sc||(sc={}));var dc=uc,pc=function(){function e(){o(this,e),pe(this,"cartSelector",void 0),pe(this,"collapsedCartProductImageSelector",void 0),pe(this,"productSelector",void 0),pe(this,"productTitleSelector",void 0),pe(this,"productPriceSelector",void 0),pe(this,"productImageSelector",void 0),pe(this,"productUrlSelector",void 0),pe(this,"productQuantitySelector",void 0),pe(this,"productSellerSelector",void 0),pe(this,"productSellerRegex",void 0),pe(this,"productIdSkuSelector",void 0),pe(this,"productIdSkuRegex",void 0),pe(this,"productIdSkuAttribute",void 0),pe(this,"productPriceRegex",void 0)}return c(e,null,[{key:"Create",value:function(t){var n=new e;return n.cartSelector=t.cartSelector,n.collapsedCartProductImageSelector=t.collapsedCartProductImageSelector,n.productSelector=t.productSelector,n.productTitleSelector=t.productTitleSelector,n.productPriceSelector=t.productPriceSelector,n.productImageSelector=t.productImageSelector,n.productUrlSelector=t.productUrlSelector,n.productQuantitySelector=t.productQuantitySelector,n.productSellerSelector=t.productSellerSelector,n.productSellerRegex=t.productSellerRegex,n.productIdSkuSelector=t.productIdSkuSelector,n.productIdSkuRegex=t.productIdSkuRegex,n.productIdSkuAttribute=t.productIdSkuAttribute,n.productPriceRegex=t.productPriceRegex,n}}]),e}(),hc=function(){function e(){o(this,e),pe(this,"productTitleSelector",void 0),pe(this,"productSellerSelector",void 0),pe(this,"productBrandSelector",void 0),pe(this,"productImageSelector",void 0),pe(this,"productOutOfStockSelector",void 0),pe(this,"productPriceSelector",void 0),pe(this,"productASIN",void 0),pe(this,"productUPCSelector",void 0),pe(this,"aggregateRatingSelector",void 0),pe(this,"aggregateRatingNumberOfRatingsSelector",void 0),pe(this,"reviewSelector",void 0),pe(this,"reviewRatingSelector",void 0),pe(this,"reviewDateSelector",void 0),pe(this,"reviewerNameSelector",void 0)}return c(e,null,[{key:"Create",value:function(t){console.log("------------CatalogSelectors- apiResponse---"),console.log(t);var n=new e;return n.productTitleSelector=t.productTitleSelector,n.productSellerSelector=t.productSellerSelector,n.aggregateRatingSelector=t.aggregateRatingSelector,n.aggregateRatingNumberOfRatingsSelector=t.aggregateRatingNumberOfRatingsSelector,n.reviewSelector=t.reviewSelector,n.reviewRatingSelector=t.reviewRatingSelector,n.reviewDateSelector=t.reviewDateSelector,n.reviewerNameSelector=t.reviewerNameSelector,n.productImageSelector=t.productImageSelector,n.productPriceSelector=t.productPriceSelector,n.productOutOfStockSelector=t.productOutOfStockSelector,n.productBrandSelector=t.productBrandSelector,n.productASIN=t.productASIN,n.productUPCSelector=t.productUPCSelector,n}}]),e}(),fc=function(){function e(){o(this,e),pe(this,"otherSellersOverlayLinkSelector",void 0),pe(this,"otherSellerOfferElementSelector",void 0),pe(this,"otherSellerHeadingSelector",void 0),pe(this,"otherSellerPriceSelector",void 0),pe(this,"otherSellerNameSelector",void 0),pe(this,"productImageSelector",void 0),pe(this,"otherSellerRatingSelector",void 0),pe(this,"otherSellerDeliverySelector",void 0),pe(this,"otherSellerAddButtonSelector",void 0),pe(this,"otherSellerAddedConfirmationSelector",void 0),pe(this,"otherSellerLowestPriceSelector",void 0),pe(this,"jSVersionThreshold",void 0)}return c(e,null,[{key:"Create",value:function(t){var n=new e;return n.otherSellersOverlayLinkSelector=t.otherSellersOverlayLinkSelector,n.otherSellerOfferElementSelector=t.otherSellerOfferElementSelector,n.otherSellerHeadingSelector=t.otherSellerHeadingSelector,n.otherSellerPriceSelector=t.otherSellerPriceSelector,n.otherSellerNameSelector=t.otherSellerNameSelector,n.productImageSelector=t.productImageSelector,n.otherSellerRatingSelector=t.otherSellerRatingSelector,n.otherSellerDeliverySelector=t.otherSellerDeliverySelector,n.otherSellerAddButtonSelector=t.otherSellerAddButtonSelector,n.otherSellerAddedConfirmationSelector=t.otherSellerAddedConfirmationSelector,n.otherSellerLowestPriceSelector=t.otherSellerLowestPriceSelector,n.jSVersionThreshold=t.jSVersionThreshold,n}}]),e}(),vc=fc,Cc=function(){function e(){o(this,e),pe(this,"checkoutPageUrl",void 0),pe(this,"priceSelector",void 0),pe(this,"startDateSelector",void 0),pe(this,"endDateSelector",void 0),pe(this,"domainType",void 0),pe(this,"nameSelector",void 0),pe(this,"isRoundTripSelector",void 0)}return c(e,null,[{key:"Create",value:function(t){var n=new e;return n.checkoutPageUrl=t.checkoutPageUrl,n.priceSelector=t.priceSelector,n.startDateSelector=t.startDateSelector,n.endDateSelector=t.endDateSelector,n.nameSelector=t.nameSelector,n.domainType=t.domainType,n.isRoundTripSelector=t.isRoundTripSelector,n}}]),e}(),gc=Cc,Sc=function(){function e(){o(this,e),pe(this,"pageUrlMatchRegex",void 0),pe(this,"flightPriceSelector",void 0),pe(this,"returnFlightPriceSelector",void 0),pe(this,"startDateSelector",void 0),pe(this,"endDateSelector",void 0),pe(this,"domainType",void 0),pe(this,"sourceLocationSelector",void 0),pe(this,"destinationLocationSelector",void 0),pe(this,"isRoundTripSelector",void 0)}return c(e,null,[{key:"Create",value:function(t){var n=new e;return n.pageUrlMatchRegex=t.pageUrlMatchRegex,n.flightPriceSelector=t.flightPriceSelector,n.returnFlightPriceSelector=t.returnFlightPriceSelector,n.startDateSelector=t.startDateSelector,n.endDateSelector=t.endDateSelector,n.domainType=t.domainType,n.sourceLocationSelector=t.sourceLocationSelector,n.destinationLocationSelector=t.destinationLocationSelector,n.isRoundTripSelector=t.isRoundTripSelector,n}}]),e}(),mc=function(){function e(){o(this,e),pe(this,"inputBoxSelector",void 0),pe(this,"applyButtonSelector",void 0),pe(this,"removeCouponButtonSelector",void 0),pe(this,"orderTotalDataElementSelector",void 0),pe(this,"orderTotalDataContainerElementSelector",void 0),pe(this,"orderSubTotalElementSelector",void 0),pe(this,"disabled",void 0),pe(this,"checkoutPageUrl",void 0),pe(this,"layoutClickSelector",void 0),pe(this,"clickBeforeStartSelector",void 0),pe(this,"finalCheckoutButtonSelector",void 0),pe(this,"edgeEnabled",void 0),pe(this,"couponAcceptedMessageElementSelector",void 0),pe(this,"closeModal",void 0),pe(this,"appliedCouponSelector",void 0),pe(this,"errorMessageSelector",void 0),pe(this,"couponSuccessMessageSelectors",void 0),pe(this,"couponFailureMessageSelectors",void 0),pe(this,"enabledTips",void 0),pe(this,"otherSellerSelectors",void 0),pe(this,"clippingSelectors",void 0),pe(this,"cartSelectors",void 0),pe(this,"catalogSelectors",void 0),pe(this,"clickForCartSelector",void 0),pe(this,"socialSelectors",void 0),pe(this,"pinterestSelectors",void 0),pe(this,"automatedCartExtractionEnabled",void 0),pe(this,"shipmentSelector",void 0),pe(this,"preTaxSelector",void 0),pe(this,"estimatedTaxSelector",void 0),pe(this,"waitAfterApplyingCurrentCoupon",void 0),pe(this,"manualCouponApplyTrackingEnabled",void 0),pe(this,"autosDataSelector",void 0),pe(this,"suggestedCouponElementSelector",void 0),pe(this,"suggestedCouponRegex",void 0),pe(this,"suggestedCouponsOnlyPage",void 0),pe(this,"supportedNoOrderTotal",void 0),pe(this,"domMutationEnabled",void 0),pe(this,"pageType",void 0),pe(this,"automaticCouponSavingsSelector",void 0),pe(this,"travelCheckoutSelectors",void 0),pe(this,"isAutoShowDisabled",void 0),pe(this,"productAddToCartSelector",void 0),pe(this,"buyNowSelector",void 0),pe(this,"pageUrlRegex",void 0),pe(this,"pageTypeSelector",void 0),pe(this,"addToCartOverlaySelector",void 0),pe(this,"getProductNamesFromImg",void 0),pe(this,"productTitleSearchSelector",void 0),pe(this,"travelSearchSelectors",void 0),pe(this,"isHomePageSameAsCheckout",void 0)}return c(e,null,[{key:"Create",value:function(t){var n=new e;return n.inputBoxSelector=t.inputBoxSelector,n.removeCouponButtonSelector=t.removeCouponButtonSelector,n.orderTotalDataElementSelector=t.orderTotalDataElementSelector,n.orderTotalDataContainerElementSelector=t.orderTotalDataContainerElementSelector,n.checkoutPageUrl=t.checkoutPageUrl,n.clickBeforeStartSelector=t.clickBeforeStartSelector,n.clickForCartSelector=t.clickForCartSelector,n.layoutClickSelector=t.layoutClickSelector,n.finalCheckoutButtonSelector=t.finalCheckoutButtonSelector,n.disabled=t.disabled,n.edgeEnabled=t.edgeEnabled,n.orderSubTotalElementSelector=t.orderSubTotalElementSelector,n.couponAcceptedMessageElementSelector=t.couponAcceptedMessageElementSelector,n.closeModal=t.closeModal,n.appliedCouponSelector=t.appliedCouponSelector,n.errorMessageSelector=t.errorMessageSelector,n.couponSuccessMessageSelectors=t.couponSuccessMessageSelectors,n.couponFailureMessageSelectors=t.couponFailureMessageSelectors,n.enabledTips=t.enabledTips,n.automatedCartExtractionEnabled=t.automatedCartExtractionEnabled,n.shipmentSelector=t.shipmentSelector,n.preTaxSelector=t.preTaxSelector,n.estimatedTaxSelector=t.estimatedTaxSelector,n.applyButtonSelector=t.applyButtonSelector,n.waitAfterApplyingCurrentCoupon=t.waitAfterApplyingCurrentCoupon,n.manualCouponApplyTrackingEnabled=t.manualCouponApplyTrackingEnabled,n.autosDataSelector=t.autosDataSelector,n.suggestedCouponElementSelector=t.suggestedCouponElementSelector,n.suggestedCouponRegex=t.suggestedCouponRegex,n.suggestedCouponsOnlyPage=t.suggestedCouponsOnlyPage,n.supportedNoOrderTotal=t.supportedNoOrderTotal,n.domMutationEnabled=t.domMutationEnabled,n.pageType=t.pageType,n.automaticCouponSavingsSelector=t.automaticCouponSavingsSelector,n.isAutoShowDisabled=t.isAutoShowDisabled,n.productAddToCartSelector=t.productAddToCartSelector,n.buyNowSelector=t.buyNowSelector,n.pageTypeSelector=t.pageTypeSelector,n.pageUrlRegex=t.pageUrlRegex,n.addToCartOverlaySelector=t.addToCartOverlaySelector,n.productTitleSearchSelector=t.productTitleSearchSelector,n.getProductNamesFromImg=t.getProductNamesFromImg,n.isHomePageSameAsCheckout=t.isHomePageSameAsCheckout,t.otherSellerSelectors&&(n.otherSellerSelectors=vc.Create(t.otherSellerSelectors)),t.clippingSelectors&&(n.clippingSelectors=cr.Create(t.clippingSelectors)),t.cartSelectors&&(n.cartSelectors=pc.Create(t.cartSelectors)),t.catalogSelectors&&(n.catalogSelectors=hc.Create(t.catalogSelectors)),t.socialSelectors&&(n.socialSelectors=pr.Create(t.socialSelectors)),t.pinterestSelectors&&(n.pinterestSelectors=dr.Create(t.pinterestSelectors)),t.travelCheckoutSelectors&&(n.travelCheckoutSelectors=gc.Create(t.travelCheckoutSelectors)),t.travelSearchSelectors&&(n.travelSearchSelectors=Sc.Create(t.travelSearchSelectors)),n}}]),e}(),Ac=mc,Ec=function(){function e(){o(this,e),pe(this,"productPageUrl",void 0),pe(this,"addToCartButtonSelector",void 0),pe(this,"backgroundAAEnabled",void 0),pe(this,"productAddedConfirmationSelector",void 0),pe(this,"addToCartButtonContainer",void 0),pe(this,"suggestedCouponElementSelector",void 0),pe(this,"suggestedCouponRegex",void 0)}return c(e,null,[{key:"Create",value:function(t){var n=new e;return n.productPageUrl=t.productPageUrl,n.addToCartButtonSelector=t.addToCartButtonSelector,n.backgroundAAEnabled=t.backgroundAAEnabled,n.productAddedConfirmationSelector=t.productAddedConfirmationSelector,n.addToCartButtonContainer=t.addToCartButtonContainer,n.suggestedCouponElementSelector=t.suggestedCouponElementSelector,n.suggestedCouponRegex=t.suggestedCouponRegex,n}}]),e}();function yc(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ic(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ic(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function Ic(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Tc(){return La.isExperimentActive(ka.fragmentPageTypeFiltering)}function Oc(){return La.isExperimentActive(ka.collectAllFragments)}function Pc(e){return!e||function(e){return![D.HomePage,D.SearchPage,D.ProductPage].includes(e)}(e)}var kc=function(e,t){return!(!e||!t)&&(t=(t=(t="("+t.toLowerCase()+")").replace(",","|")).replace("/","/"),new RegExp(t.toLowerCase()).test(e.toLowerCase()))},_c=function(e,t){return bc(e,t)?D.HomePage:D.UnknownPage},bc=function(e,t){return!(!e||!t)&&(e.endsWith(t)||e.endsWith("".concat(t,"/")))};function Nc(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Rc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Rc(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function Rc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Dc=function(){function e(t){o(this,e),pe(this,"fragmentCollection",void 0),pe(this,"piiExtraction",void 0),pe(this,"transactionIdSettings",void 0),pe(this,"selectorTimeouts",void 0),pe(this,"isDisableProductNamesCollectionOnConfirmation",void 0),pe(this,"isDisablePurchaseTotalCollectionOnConfirmation",void 0),pe(this,"other",void 0),t&&(this.other=t.other,this.fragmentCollection=t.fragmentCollection,this.piiExtraction=t.piiExtraction,this.transactionIdSettings=t.transactionIdSettings,this.selectorTimeouts=t.selectorTimeouts,this.isDisableProductNamesCollectionOnConfirmation=t.isDisableProductNamesCollectionOnConfirmation,this.isDisablePurchaseTotalCollectionOnConfirmation=t.isDisablePurchaseTotalCollectionOnConfirmation)}return c(e,[{key:"GetOtherFeatureFlag",value:function(e){return!(!this.other||!this.other[e])&&"true"===this.other[e].toLowerCase()}},{key:"IsAttibutionEnabled",value:function(){return this.GetOtherFeatureFlag("isEdgeAttributionEnabled")}},{key:"GetFragmentCollectionTimeout",value:function(e){var t,n=null===(t=this.fragmentCollection)||void 0===t?void 0:t.collectionRates;if(!n)return 0;var r,a=this.GetRatesForPageType(e,n);if(this.IsValidRate(null==a?void 0:a.collectionTimeoutMs))return null!==(r=null==a?void 0:a.collectionTimeoutMs)&&void 0!==r?r:0;var o,i=n.allPages;return this.IsValidRate(null==i?void 0:i.collectionTimeoutMs)&&null!==(o=null==i?void 0:i.collectionTimeoutMs)&&void 0!==o?o:0}},{key:"GetCollectionRate",value:function(e,t,n){var r,a;if(null===(r=this.fragmentCollection)||void 0===r||!r.isEnabled)return 0;var o=null===(a=this.fragmentCollection)||void 0===a?void 0:a.collectionRates;if(!o)return 0;if(this.IsDisableCollectionOnPage(o,e))return 0;var i=this.GetRateFromObject(e,this.GetRatesForPageType(t,o),n);if(this.IsValidRate(i))return null!=i?i:0;var s=this.GetRateFromObject(e,o.allPages,n);return this.IsValidRate(s)&&null!=s?s:0}},{key:"IsDisableCollectionOnPage",value:function(e,t){return!!t&&!!(e.disableCollectionPages&&e.disableCollectionPages.length>0&&this.FindRegexMatch(t,e.disableCollectionPages))}},{key:"GetRateFromObject",value:function(e,t,n){if(t){if(n)return this.IsValidRate(t.extractionIfBroken)?t.extractionIfBroken:void 0;if(t.extractionForRegex&&e){var r=this.FindRateFromRegexMatch(e,t.extractionForRegex);if(this.IsValidRate(r))return r}return this.IsValidRate(t.defaultExtraction)?t.defaultExtraction:void 0}}},{key:"FindRegexMatch",value:function(e,t){var n,r=Nc(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(kc(e,a))return a}}catch(e){r.e(e)}finally{r.f()}}},{key:"FindRateFromRegexMatch",value:function(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var a,o=r[n];if(kc(e,o))return null!==(a=t[o])&&void 0!==a?a:0}}},{key:"IsValidRate",value:function(e){var t=Number(e);return!isNaN(t)}},{key:"GetRatesForPageType",value:function(e,t){switch(e){case D.ConfirmationPage:return t.confirmationPage;case D.CheckoutPage:return t.checkoutPage;case D.UnknownPage:return t.unknownPage;case D.ProductPage:return t.productPage;case D.SearchPage:return t.searchPage;case D.HomePage:return t.homePage;default:return t.otherPages}}}]),e}();function xc(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return wc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return wc(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function wc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Uc=function(){function e(){o(this,e),pe(this,"platform",void 0),pe(this,"domainName",void 0),pe(this,"orderConfirmationPageUrl",void 0),pe(this,"searchQueryUrlRegex",void 0),pe(this,"allCheckoutPages",void 0),pe(this,"isTravelDomain",void 0),pe(this,"allFinalCheckoutPages",void 0),pe(this,"checkoutPageKey",void 0),pe(this,"finalCheckoutPageKey",void 0),pe(this,"productPageKey",void 0),pe(this,"exclusiveMarket",void 0),pe(this,"multiMsgValidationEnabled",void 0),pe(this,"youtubeTemplates",void 0),pe(this,"allProductPages",void 0),pe(this,"exactCheckoutPageUrl",void 0),pe(this,"productOutOfStockSelector",void 0),pe(this,"productNameSelector",void 0),pe(this,"productPriceSelector",void 0),pe(this,"productPageUrl",void 0),pe(this,"productImageSelector",void 0),pe(this,"aaConsentEnabled",void 0),pe(this,"isStorewideCashbackEstimationEnabled",void 0),pe(this,"storeCartInEdgeStorage",void 0),pe(this,"cartMonitorUrl",void 0),pe(this,"travelCheckoutPageKey",void 0),pe(this,"checkoutPageUrl",void 0),pe(this,"confirmationPageTelemetry",void 0),pe(this,"isAOCFragmentCollectionEnabled",void 0),pe(this,"aOCFragmentCollectionRate",void 0),pe(this,"addressBarExpansionEnabled",void 0),pe(this,"retailerTrivia",void 0),pe(this,"disabledPopupOriginationList",void 0),pe(this,"allAutomatedSelectors",void 0),pe(this,"automatedSelectorsKey",void 0),pe(this,"isAddressBarCashbackEnabled",void 0),pe(this,"isCompositeNotificationPhCExcludedRetailer",void 0),pe(this,"isCompositeNotificationPhCTopRetailer",void 0),pe(this,"productPageUrlRegex",void 0),pe(this,"settings",void 0),pe(this,"edgeFeatureFlag",void 0),pe(this,"isEligibleForRewards",void 0)}return c(e,[{key:"updateCurrentCheckoutPage",value:function(e){return this.checkoutPageKey=this.findCurrentPage(e,this.allCheckoutPages,D.CheckoutPage),-1!==this.checkoutPageKey}},{key:"getCurrentCheckoutPage",value:function(e){return null!==this.checkoutPageKey&&-1!==this.checkoutPageKey&&void 0!==this.checkoutPageKey||-1!==this.checkoutPageKey&&e&&(this.updateCurrentCheckoutPage(e),null!==this.checkoutPageKey&&-1!==this.checkoutPageKey&&void 0!==this.checkoutPageKey)?this.allCheckoutPages[this.checkoutPageKey]:void 0}},{key:"updateCurrentFinalCheckoutPage",value:function(e){var t=this.findCurrentPage(e,this.allFinalCheckoutPages);return-1!==t?(this.finalCheckoutPageKey=t,!0):(this.finalCheckoutPageKey=null,!1)}},{key:"getCurrentFinalCheckoutPage",value:function(){if(null!=this.finalCheckoutPageKey)return this.allFinalCheckoutPages[this.finalCheckoutPageKey]}},{key:"getCurrentProductPage",value:function(e){if(null!=this.productPageKey)return this.allProductPages[this.productPageKey];var t=this.findCurrentProductPage(e,this.allProductPages);return-1!==t?(this.productPageKey=t,this.allProductPages[this.productPageKey]):void(this.productPageKey=null)}},{key:"getCurrentAutomatedSelectorsPage",value:function(e){return null!==this.automatedSelectorsKey&&void 0!==this.automatedSelectorsKey&&this.automatedSelectorsKey<this.allAutomatedSelectors.length||e&&(this.updateCurrentAutomatedSelectorsPage(e),null!==this.automatedSelectorsKey&&-1!==this.automatedSelectorsKey&&void 0!==this.automatedSelectorsKey)?this.allAutomatedSelectors[this.automatedSelectorsKey]:void 0}},{key:"getAutomatedSelectorsPageByRegex",value:function(e){for(var t=0;t<this.allAutomatedSelectors.length;t++){var n=this.allAutomatedSelectors[t];if(new RegExp(n.urlRegex).test(e))return this.automatedSelectorsKey=t,n}this.automatedSelectorsKey=-1}},{key:"isConfirmationPage",value:function(e){return new RegExp(this.orderConfirmationPageUrl).test(e)}},{key:"updateCurrentAutomatedSelectorsPage",value:function(e){var t=this.findCurrentAutomatedSelectorsPage(e,this.allAutomatedSelectors);return-1!==t?(this.automatedSelectorsKey=t,!0):(this.automatedSelectorsKey=null,!1)}},{key:"createCheckoutPageList",value:function(e){if(this.allCheckoutPages=[],e.allCheckoutPages&&e.allCheckoutPages.length>0){var t,n=xc(e.allCheckoutPages);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.allCheckoutPages.push(Ac.Create(r))}}catch(e){n.e(e)}finally{n.f()}}}},{key:"createFinalCheckoutPageList",value:function(e){if(this.allFinalCheckoutPages=[],e.allFinalCheckoutPages&&e.allFinalCheckoutPages.length>0){var t,n=xc(e.allFinalCheckoutPages);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.allFinalCheckoutPages.push(Ac.Create(r))}}catch(e){n.e(e)}finally{n.f()}}}},{key:"createAutomatedSelectorsPageList",value:function(e){if(this.allAutomatedSelectors=[],e.allAutomatedSelectors&&e.allAutomatedSelectors.length>0){var t,n=xc(e.allAutomatedSelectors);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.allAutomatedSelectors.push(Wt.DeepAssign(new dc,r))}}catch(e){n.e(e)}finally{n.f()}}}},{key:"createProductPagesList",value:function(e){if(this.allProductPages=[],e.allProductPages&&e.allProductPages.length>0){var t,n=xc(e.allProductPages);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.allProductPages.push(Ec.Create(r))}}catch(e){n.e(e)}finally{n.f()}}}},{key:"createYoutubeTemplateList",value:function(e){if(this.youtubeTemplates=[],e.youtubeTemplates&&e.youtubeTemplates.length>0){var t,n=xc(e.youtubeTemplates);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.youtubeTemplates.push(cc.Create(r))}}catch(e){n.e(e)}finally{n.f()}}}},{key:"findCurrentPage",value:function(e,t,n){for(var r=0;r<t.length;r++){if(Wt.IsPageMatch(t[r].checkoutPageUrl,t[r].pageUrlRegex,e)){if(La.isExperimentActive(ka.checkoutPageTypeCheck)&&n&&t[r].pageType&&t[r].pageType!==n)continue;return t[r].disabled?-1:r}}return-1}},{key:"findCurrentProductPage",value:function(e,t){for(var n=0;n<t.length;n++){if(Wt.IsOnPage(t[n].productPageUrl,e))return n}return-1}},{key:"findCurrentAutomatedSelectorsPage",value:function(e,t){for(var n=0;n<t.length;n++){if(Wt.IsPageRegexMatch(t[n].urlRegex,e))return n}return-1}},{key:"createTriviaData",value:function(e){var t,n;this.retailerTrivia={successRate:null!==(t=null==e||null===(n=e.retailerTrivia)||void 0===n?void 0:n.successRate)&&void 0!==t?t:null}}},{key:"isProductPage",value:function(e){return null!=this.productPageUrlRegex&&Wt.IsPageRegexMatch(this.productPageUrlRegex,e)||null!=this.productPageUrl&&Wt.IsPageRegexMatch(this.productPageUrl,e)}},{key:"getCurrentPageType",value:function(){var e,t,n=null!==(e=null===(t=this.getCurrentCheckoutPage())||void 0===t?void 0:t.pageType)&&void 0!==e?e:D.UnknownPage;return n!==D.UnknownPage?n:this.isProductPage(location.href)?D.ProductPage:D.UnknownPage}}],[{key:"Create",value:function(t){var n=new e;return t&&(n.domainName=t.domainName,n.orderConfirmationPageUrl=t.orderConfirmationPageUrl,n.exclusiveMarket=t.exclusiveMarket,n.multiMsgValidationEnabled=t.multiMsgValidationEnabled,n.exactCheckoutPageUrl=t.exactCheckoutPageUrl,n.productOutOfStockSelector=t.productOutOfStockSelector,n.productNameSelector=t.productNameSelector,n.productPriceSelector=t.productPriceSelector,n.productImageSelector=t.productImageSelector,n.aaConsentEnabled=t.aaConsentEnabled,n.storeCartInEdgeStorage=t.storeCartInEdgeStorage,n.cartMonitorUrl=t.cartMonitorUrl,n.checkoutPageUrl=t.checkoutPageUrl,n.isTravelDomain=t.isTravelDomain,n.isStorewideCashbackEstimationEnabled=t.isStorewideCashbackEstimationEnabled,n.createCheckoutPageList(t),n.createFinalCheckoutPageList(t),n.createYoutubeTemplateList(t),n.createProductPagesList(t),n.confirmationPageTelemetry=t.confirmationPageTelemetry,n.isAOCFragmentCollectionEnabled=t.isAOCFragmentCollectionEnabled,n.productPageUrl=t.productPageUrl,n.aOCFragmentCollectionRate=t.aOCFragmentCollectionRate,n.disabledPopupOriginationList=t.disabledPopupOriginationList,n.addressBarExpansionEnabled=t.addressBarExpansionEnabled,n.createTriviaData(t),n.createAutomatedSelectorsPageList(t),n.isAddressBarCashbackEnabled=t.isAddressBarCashbackEnabled,n.isCompositeNotificationPhCExcludedRetailer=t.isCompositeNotificationPhCExcludedRetailer,n.isCompositeNotificationPhCTopRetailer=t.isCompositeNotificationPhCTopRetailer,n.productPageUrlRegex=t.productPageUrlRegex,n.searchQueryUrlRegex=t.searchQueryUrlRegex,n.settings=t.settings?new Dc(t.settings):void 0,n.edgeFeatureFlag=t.edgeFeatureFlag,n.isEligibleForRewards=t.isEligibleForRewards,n.platform=t.platform),n}}]),e}(),Lc=Uc,Mc=function(){function e(){o(this,e),pe(this,"retailerData",void 0),pe(this,"userInfo",void 0),pe(this,"traceId",void 0),pe(this,"disabledNotifications",void 0),pe(this,"impressionId",void 0),pe(this,"coupons",void 0),pe(this,"suppressedCoupons",void 0),pe(this,"cashback",void 0),pe(this,"market",void 0),pe(this,"page_locale",void 0),pe(this,"aFDMarket",void 0),pe(this,"userPersonalizationInfo",void 0),pe(this,"price",void 0),pe(this,"base64ProductImage",void 0),pe(this,"ranking",void 0),pe(this,"extracted_entity",void 0),pe(this,"comparableOffers",void 0),pe(this,"priceHistory",void 0),pe(this,"url",void 0),pe(this,"isAwarenessExpansionEnabled",void 0),pe(this,"personalizedAdsResponse",void 0),pe(this,"isCashbackEstimationSupportedForDomain",void 0),pe(this,"youtubeTemplates",void 0),pe(this,"youtubeData",void 0),pe(this,"trendingCoupons",void 0),pe(this,"productTracking",void 0),pe(this,"recommendations",void 0),pe(this,"isSSOEnabled",void 0),pe(this,"uHId",void 0),pe(this,"itemLevelCashBack",void 0),pe(this,"productItemizedCashBack",void 0),pe(this,"autos",void 0),pe(this,"shoppingDataContainer",void 0),pe(this,"checkoutData",void 0),pe(this,"dealDaysRetailerData",void 0),pe(this,"dealDaysPDP",void 0),pe(this,"isUserEnrolledInDealDays",void 0),pe(this,"completeExtractedEntity",void 0),pe(this,"isAmazonGiftCardEnabled",void 0),pe(this,"productBestCoupon",void 0),pe(this,"isPackageTrackingEnabled",void 0),pe(this,"inboxPriceMatchNotification",void 0)}return c(e,null,[{key:"getApiResponse",value:function(){return this.apiResponse}},{key:"setApiResponse",value:function(e,t){var n;this.apiResponse=JSON.parse(e),null!==(n=this.apiResponse)&&void 0!==n&&n.retailerData&&(this.apiResponse.retailerData=Lc.Create(this.apiResponse.retailerData),this.apiResponse.userInfo=lc.Create(this.apiResponse)),this.apiResponse.traceId=t}}]),e}();pe(Mc,"apiResponse",new Mc);var Bc,Fc=Mc;!function(e){e.ICLastAutoShowTime="ICLastAutoShowTime",e.ICNotificationType="ICNotificationType",e.ICIsRelatedOffer="ICIsRelatedOffer",e.ICMetadata="ICMetadata",e.ICCurrentPageInfo="ICCurrentPageInfo",e.GroceryCashbackItem="GroceryCashbackItem",e.GroceryCashbackActivated="GroceryCashbackActivated",e.GroceryAutoShowData="GroceryAutoShowData",e.GroceryCategoryAutoShowData="GroceryCategoryAutoShowData",e.ICRelatedPDPOffer="ICRelatedPDPOffer",e.ICActivationMigrationPending="ActivationMigrationPending",e.ICActivatedPending="ICActivatedPending",e.ICActivatedCashbackTotal="ActivatedCashbackTotal",e.ICActivatedCashbackImages="ActivatedCashbackImages",e.ICConfirmationPending="ICConfirmationPending",e.ICConfirmationCompleted="ICConfirmationCompleted",e.AutoClipData="AutoClipData",e.ICPendingTransaction="ICPendingTransaction",e.ICAutoShownOffers="ICAutoShownOffers",e.AutosMarketplace="AutosMarketplace",e.AutosMarketplaceNotification="AutosMarketplaceNotification",e.InboxCouponsGetAllCouponsResponseCache="InboxCouponsGetAllCouponsResponseCache",e.InboxCouponsAuthTokenKeyPrefix="InboxCouponsAuthToken|",e.InboxCouponsUserEmailsStatus="InboxCouponsUserEmailsStatus",e.InboxCouponsUserEmailsStatusCache="InboxCouponsUserEmailsStatusCache",e.InboxCouponsEdgeSignInStarted="InboxCouponsEdgeSignInStarted",e.InboxCouponsEdgeSignInSuccess="InboxCouponsEdgeSignInSuccess",e.InboxCouponsHashedUserId="InboxCouponsHashedUserId",e.InboxCouponsUserHashedEmail="InboxCouponsUserHashedEmail",e.InboxCouponsLogsMetadata="InboxCouponsLogsMetadata",e.InboxCouponsPaneOpen="InboxCouponsPaneOpen",e.TrendingCouponsData="TrendingCouponsData",e.PersonalizationContextCanPrompt="LoadTimePersonalizationContextPrompt",e.ReceiptScannerBannerImpressionIds="ReceiptScannerBannerImpressionIds",e.ReceiptScannerDealImpressionIds="ReceiptScannerDealImpressionIds",e.ReceiptScannerDealClicked="ReceiptScannerDealClicked",e.ICIsPendingTransactionPresent="ICIsPendingTransactionPresent",e.IsEntrolledInDealDaysNotifications="IsEntrolledInDealDaysNotifications",e.GroceryInstantAddToCart="GroceryInstantAddToCart",e.GroceryInstantAddToCartSpb="GroceryInstantAddToCartSpb",e.GroceryCheckoutPageOffersSpb="GroceryCheckoutPageOffersSpb",e.GroceryMatchedCartSpbOffers="GroceryMatchedCartSpbOffers",e.PackageTrackingConfirmationNotifLastShown="PackageTrackingConfirmationNotifLastShown",e.PackageTrackingUXOrderMetadata="PackageTrackingUXOrderMetadata",e.PcbNotificationLastShownAdCount="PcbNotificationLastShownAdCount",e.PersistentCartData="PersistentCartData",e.CartValues="CartValues",e.PersistentWinCartData="PersistentWinCartData",e.ValidCartsToSync="ValidCartsToSync",e.UnprocessedWinCartItems="UnprocessedWinCartItems",e.ProductCollectionBannerLastShown="ProductCollection/BannerLastShown",e.ProductTrackingOOSLastShown="ProductTrackingOOSLastShown",e.ProductTrackingTrackedProducts="productTrackingData",e.ProductTrackingOOSData="ProductTrackingData",e.ProductTrackingUrlProductCache="ProductTracking/UrlProductCache",e.ProductTrackingConsentStatus="ProductTracking/ConsentStatus",e.ProductTrackingAnidData="ProductTracking/AnidData",e.ClearedWinCarts="ClearedWinCarts",e.SidepaneCashback="SidepaneCashback",e.PaneOpenMicroNotificationPopupOrigination="PaneOpenMicroNotificationPopupOrigination",e.ProductBestCouponConsent="ProductBestCouponConsent",e.PackagesNotified="PackagesNotified",e.ValidPackage="ValidPackage",e.ProductBestCoupon="ProductBestCoupon",e.DealsForTopDomainsTimestamp="DealsForTopDomainsTimestamp",e.BestCoupons="BestCoupons",e.CashbackInfo="CashbackInfo",e.PCBStorewideAddressBar="PCBStorewideAddressBar",e.PCBStorewideAddressBarLastRequested="PCBStorewideAddressBarLastRequested",e.ICSpbHomePageShownTimestamp="ICSpbHomePageShownTimestamp",e.ICSpbExpiryNotificationShownTime="ICSpbExpiryNotificationShownTime",e.UserAnid="userAnid",e.ShippingFee="ShippingFee",e.InboxCouponsUserConsented="UserConsentedInboxCoupon",e.CartPageCashbackNotification="CartPageCashbackNotification",e.PriceMatchConsent="PriceMatchConsent",e.AmazonSearchPCBOffer="AmazonSearchPCBOffer",e.UnsuccessfulAutoApplyCount="UnsuccessfulAutoApplyCount",e.ShoppingTripsData="CashbackShoppingTripsData",e.InboxCouponsAAFailureUpsellTriggeredV2="InboxCouponsAAFailureUpsellTriggeredV2",e.InboxCouponsAASuccessUpsellTriggeredV2="InboxCouponsAASuccessUpsellTriggeredV2",e.ShoppingTripsActivateRebateDomain="ShoppingTripsActivateRebateDomain",e.ProductTrackingBackInStockValidationData="ProductTracking/BackInStockValidationData",e.ProductTrackingPriceDropValidationData="ProductTracking/PriceDropValidationData",e.PostPurchasePendingProducts="PostPurchasePendingProducts",e.PostPurchasePathnameProducts="PostPurchasePathnameProducts",e.TravelCheaperFlightData="TravelCheaperFlightData",e.TravelCheaperHotelData="TravelCheaperHotelData",e.IsNavigatedFromAddressBarPersonalizedCashback="IsNavigatedFromAddressBarPersonalizedCashback",e.IsNavigatedFromAddressBarCashback="IsNavigatedFromAddressBarCashback",e.IsNavigatedFromAddressBarCoupons="IsNavigatedFromAddressBarCoupons",e.PersonalizedPromotionsCartData="PersonalizedPromotionsCartData",e.AutoActivatedSpbOffer="AutoActivatedSpbOffer",e.ArticlesCashback="ArticlesCashback",e.ShorelineSpbOffers="ShorelineSpbOffers",e.PriceMatchNotification="PriceMatchNotification",e.BGAABestCouponResult="BGAABestCouponResult",e.BGAAApplyButtonClicked="BGAAApplyButtonClicked",e.ExclusiveCouponConsent="ExclusiveCouponConsent",e.BlossomCampaignUserStatus="BlossomCampaignUserStatus",e.BlossomCampaignUserStatusTimestamp="BlossomCampaignUserStatusTimestamp",e.BlossomShouldShowNotification="BlossomShouldShowNotification",e.BlossomShouldShowPostPurchaseUX="BlossomShouldShowPostPurchaseUX",e.PostPurchaseRewardsData="PostPurchaseRewardsData",e.CheckoutPageNavigatedTime="CheckoutPageNavigatedTime",e.DynamicTransactionId="DynamicTransactionId",e.PurchaseCart="PurchaseCart"}(Bc||(Bc={}));var Gc=new(function(){function e(){o(this,e),pe(this,"rawStorageObj",{}),pe(this,"storageObjStr",""),pe(this,"ICIsPendingTransactionPresent",void 0),pe(this,"ICCurrentPageInfo",void 0),pe(this,"OtherSellersNotificationData",void 0),pe(this,"OtherSellersAutoShowCount",void 0),pe(this,"OtherSellersLastAutoShowTime",void 0),pe(this,"CanSaveYoutubeCoupons",void 0),pe(this,"SocialCoupons",void 0),pe(this,"IsEntrolledInDealDaysNotifications",void 0),pe(this,"CartValues",void 0),pe(this,"CompletedPurchase",void 0),pe(this,"CompletedPurchaseConf",void 0),pe(this,"GiftCardData",void 0),pe(this,"GroceryCashbackItem",void 0),pe(this,"Anid",void 0),pe(this,"GroceryCashbackActivated",void 0),pe(this,"ICRelatedPDPOffer",void 0),pe(this,"ICAutoShownOffers",void 0),pe(this,"AutoOpenData",void 0),pe(this,"AutoOpenPrefData",void 0),pe(this,"AutoOpenDomainPrefData",void 0),pe(this,"LastCleanedData",void 0),pe(this,"LastShownData",void 0),pe(this,"StageAndCategoryLastShown",void 0),pe(this,"ICLastAutoShowTime",void 0),pe(this,"ICMetadata",void 0),pe(this,"PersistentWinCartData",void 0),pe(this,"ICActivatedPending",void 0),pe(this,"PrivacyBadgeViewCount",void 0),pe(this,"PersistentCartData",void 0),pe(this,"PersonalizedPromotionsCartData",void 0),pe(this,"PersistentTravelData",void 0),pe(this,"AutoClipData",void 0),pe(this,"RuleBasedTriggerData",void 0),pe(this,"ICPendingTransaction",void 0),pe(this,"AutosMarketplace",void 0),pe(this,"AutosMarketplaceNotification",void 0),pe(this,"BestCoupons",void 0),pe(this,"ICNotificationType",void 0),pe(this,"CashbackInfo",void 0),pe(this,"ICIsRelatedOffer",void 0),pe(this,"GroceryInstantAddToCart",void 0),pe(this,"GroceryInstantAddToCartSpb",void 0),pe(this,"GroceryMatchedCartSpbOffers",void 0),pe(this,"CheckoutPageNavigatedTime",void 0),pe(this,"DynamicTransactionId",void 0),pe(this,"GroceryAutoShowData",void 0),pe(this,"GroceryCategoryAutoShowData",void 0),pe(this,"ProductTrackingOOSLastShown",void 0),pe(this,"PackageTrackingConfirmationNotifLastShown",void 0),pe(this,"PcbNotificationLastShownAdCount",void 0),pe(this,"TrackedProductsData",void 0),pe(this,"UrlToProductMap",void 0),pe(this,"SidepaneCashback",void 0),pe(this,"ProductBestCouponConsent",void 0),pe(this,"PackagesNotified",void 0),pe(this,"ValidPackage",void 0),pe(this,"DealsForTopDomainsTimestamp",void 0),pe(this,"ICSpbHomePageShownTimestamp",void 0),pe(this,"ICSpbExpiryNotificationShownTime",void 0),pe(this,"PCBStorewideAddressBar",void 0),pe(this,"PCBStorewideAddressBarLastRequested",void 0),pe(this,"ShippingFee",void 0),pe(this,"InboxCouponsUserConsent",void 0),pe(this,"CartPageCashbackNotification",void 0),pe(this,"PriceMatchConsent",void 0),pe(this,"UnsuccessfulAutoApplyCount",void 0),pe(this,"ProductTrackingBackInStockValidationData",void 0),pe(this,"ProductTrackingPriceDropValidationData",void 0),pe(this,"PostPurchasePendingProducts",void 0),pe(this,"PostPurchasePathnameProducts",void 0),pe(this,"InboxCouponsHashedUserId",void 0),pe(this,"InboxCouponsLogsMetadata",void 0),pe(this,"InboxCouponsPaneOpen",void 0),pe(this,"IsNavigatedFromAddressBarPersonalizedCashback",void 0),pe(this,"IsNavigatedFromAddressBarCashback",void 0),pe(this,"IsNavigatedFromAddressBarCoupons",void 0),pe(this,"anidTrackingData",void 0),pe(this,"articlesCashback",void 0),pe(this,"PriceMatchNotificationData",void 0),pe(this,"BGAAApplyButtonClicked",void 0),pe(this,"ExclusiveCouponConsent",void 0),pe(this,"BlossomCampaignUserStatus",void 0),pe(this,"PurchaseCart",void 0)}return c(e,[{key:"Create",value:function(e){var t,n,r,a,o,i,s,l,c,u,d,p,h,f,v,C,g,S;Gc.ICSpbExpiryNotificationShownTime=null!==(t=e[Bc.ICSpbExpiryNotificationShownTime])&&void 0!==t?t:null,Gc.ICSpbHomePageShownTimestamp=null!==(n=e[Bc.ICSpbHomePageShownTimestamp])&&void 0!==n?n:null,Gc.OtherSellersNotificationData=e.OtherSellersNotificationData,Gc.OtherSellersAutoShowCount=e.OtherSellersAutoShowCount,Gc.OtherSellersLastAutoShowTime=e.OtherSellersLastAutoShowTime,Gc.CanSaveYoutubeCoupons=null!==(r=e.CanSaveYoutubeCoupons)&&void 0!==r?r:null,Gc.SocialCoupons=null!==(a=e.socialCoupons)&&void 0!==a?a:null,Gc.IsEntrolledInDealDaysNotifications=null!==(o=e[Bc.IsEntrolledInDealDaysNotifications])&&void 0!==o?o:null,Gc.CartValues=e.CartValues,Gc.CompletedPurchase=e.CompletedPurchase,Gc.CompletedPurchaseConf=e.CompletedPurchaseConf,Gc.GroceryCashbackItem=e[Bc.GroceryCashbackItem],Gc.Anid=e[Bc.UserAnid],Gc.GroceryInstantAddToCart=e[Bc.GroceryInstantAddToCart],Gc.GroceryInstantAddToCartSpb=e[Bc.GroceryInstantAddToCartSpb],Gc.GroceryMatchedCartSpbOffers=e[Bc.GroceryMatchedCartSpbOffers],Gc.GroceryCashbackActivated=e[Bc.GroceryCashbackActivated],Gc.ICAutoShownOffers=e[Bc.ICAutoShownOffers],Gc.AutoOpenData=null!==(i=e.AutoOpenData)&&void 0!==i?i:null,Gc.AutoOpenPrefData=null!==(s=e.AutoOpenPrefData)&&void 0!==s?s:null,Gc.AutoOpenDomainPrefData=null!==(l=e.AutoOpenDomainPrefData)&&void 0!==l?l:null,Gc.LastCleanedData=null!==(c=e.LastCleanedData)&&void 0!==c?c:null,Gc.LastShownData=null!==(u=e.LastShownData)&&void 0!==u?u:null,Gc.StageAndCategoryLastShown=null!==(d=e.StageAndCategoryLastShown)&&void 0!==d?d:null,Gc.ICLastAutoShowTime=e.ICLastAutoShowTime,Gc.ICMetadata=e[Bc.ICMetadata],Gc.ICActivatedPending=e[Bc.ICActivatedPending],Gc.PrivacyBadgeViewCount=e.PrivacyBadgeViewCount,Gc.GiftCardData=null!==(p=e.GiftCardData)&&void 0!==p?p:null,Gc.PersistentCartData=null!==(h=e.PersistentCartData)&&void 0!==h?h:null,Gc.PersistentWinCartData=null!==(f=e.PersistentWinCartData)&&void 0!==f?f:null,Gc.PersistentTravelData=null!==(v=e.PersistentTravelData)&&void 0!==v?v:null,Gc.AutoClipData=null!==(C=e.AutoClipData)&&void 0!==C?C:null,Gc.RuleBasedTriggerData=null!==(g=e.RuleBasedTriggerData)&&void 0!==g?g:null,Gc.ICPendingTransaction=null!==(S=e.ICPendingTransaction)&&void 0!==S?S:null,Gc.AutosMarketplace=e[Bc.AutosMarketplace],Gc.AutosMarketplaceNotification=e[Bc.AutosMarketplaceNotification],Gc.BestCoupons=e[Bc.BestCoupons],Gc.CashbackInfo=e[Bc.CashbackInfo],Gc.ICNotificationType=e[Bc.ICNotificationType],Gc.ICIsRelatedOffer=e[Bc.ICIsRelatedOffer],Gc.GroceryAutoShowData=e[Bc.GroceryAutoShowData],Gc.GroceryCategoryAutoShowData=e[Bc.GroceryCategoryAutoShowData],Gc.ProductTrackingOOSLastShown=e[Bc.ProductTrackingOOSLastShown],Gc.PackageTrackingConfirmationNotifLastShown=e[Bc.PackageTrackingConfirmationNotifLastShown],Gc.ICIsPendingTransactionPresent=e[Bc.ICIsPendingTransactionPresent],Gc.ICCurrentPageInfo=e[Bc.ICCurrentPageInfo],Gc.ICRelatedPDPOffer=e[Bc.ICRelatedPDPOffer],Gc.PcbNotificationLastShownAdCount=e[Bc.PcbNotificationLastShownAdCount],Gc.TrackedProductsData=e[Bc.ProductTrackingTrackedProducts],Gc.UrlToProductMap=e[Bc.ProductTrackingUrlProductCache],Gc.SidepaneCashback=e[Bc.SidepaneCashback],Gc.ProductBestCouponConsent=e[Bc.ProductBestCouponConsent],Gc.PackagesNotified=e[Bc.PackagesNotified],Gc.ValidPackage=e[Bc.ValidPackage],Gc.DealsForTopDomainsTimestamp=e[Bc.DealsForTopDomainsTimestamp],Gc.PCBStorewideAddressBar=e[Bc.PCBStorewideAddressBar],Gc.PCBStorewideAddressBarLastRequested=e[Bc.PCBStorewideAddressBarLastRequested],Gc.ShippingFee=e[Bc.ShippingFee],Gc.InboxCouponsUserConsent=e[Bc.InboxCouponsUserConsented],Gc.CartPageCashbackNotification=e[Bc.CartPageCashbackNotification],Gc.PriceMatchConsent=e[Bc.PriceMatchConsent],Gc.UnsuccessfulAutoApplyCount=e[Bc.UnsuccessfulAutoApplyCount],Gc.ProductTrackingBackInStockValidationData=e[Bc.ProductTrackingBackInStockValidationData],Gc.ProductTrackingPriceDropValidationData=e[Bc.ProductTrackingPriceDropValidationData],Gc.PostPurchasePendingProducts=e[Bc.PostPurchasePendingProducts],Gc.PostPurchasePathnameProducts=e[Bc.PostPurchasePathnameProducts],Gc.InboxCouponsHashedUserId=e[Bc.InboxCouponsHashedUserId],Gc.InboxCouponsLogsMetadata=e[Bc.InboxCouponsLogsMetadata],Gc.InboxCouponsPaneOpen=e[Bc.InboxCouponsPaneOpen],Gc.IsNavigatedFromAddressBarPersonalizedCashback=e[Bc.IsNavigatedFromAddressBarPersonalizedCashback],Gc.anidTrackingData=e[Bc.ProductTrackingAnidData],Gc.PersonalizedPromotionsCartData=e[Bc.PersonalizedPromotionsCartData],Gc.IsNavigatedFromAddressBarCashback=e[Bc.IsNavigatedFromAddressBarCashback],Gc.IsNavigatedFromAddressBarCoupons=e[Bc.IsNavigatedFromAddressBarCoupons],Gc.articlesCashback=e[Bc.ArticlesCashback],Gc.PriceMatchNotificationData=e[Bc.PriceMatchNotification],Gc.BGAAApplyButtonClicked=e[Bc.BGAAApplyButtonClicked],Gc.ExclusiveCouponConsent=e[Bc.ExclusiveCouponConsent],Gc.BlossomCampaignUserStatus=e[Bc.BlossomCampaignUserStatus],Gc.CheckoutPageNavigatedTime=e[Bc.CheckoutPageNavigatedTime],Gc.DynamicTransactionId=e[Bc.DynamicTransactionId],Gc.PurchaseCart=e[Bc.PurchaseCart]}},{key:"setRawStorageObject",value:function(e){this.rawStorageObj=e}},{key:"setStorageObjStr",value:function(e){this.storageObjStr=e}}]),e}()),Vc=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];o(this,e),pe(this,"EXPIRY_PERIOD",432e6),pe(this,"PAGE_WAIT_TIME",5e3),pe(this,"MAX_SUGGESTED_COUPONS_COUNT_FOR_AA",3),pe(this,"MAX_SUGGESTED_COUPONS_COUNT_TO_STORE",10),pe(this,"domainName",void 0),pe(this,"key",void 0),pe(this,"AllSuggestedCoupons",void 0),pe(this,"suggestedCoupons",void 0),pe(this,"fromPlatformDetection",void 0),pe(this,"suggestedCouponEnhancementExp",void 0),pe(this,"sendStorageMessage",void 0),pe(this,"invalidCouponList",["NOT_ELIGIBLE_CARD","INVALID_CARD","AMAZON_PAYMENT_V2","ERROR"]),this.sendStorageMessage=t,this.fromPlatformDetection=n}var n;return c(e,[{key:"GetSuggestedCoupons",value:function(){return this.suggestedCoupons.slice(0,this.MAX_SUGGESTED_COUPONS_COUNT_FOR_AA)}},{key:"PostValidation",value:function(){return Promise.resolve()}},{key:"Init",value:function(){var e,t,n,r,a=this,o=La.isExperimentActive(ka.suggestedCouponEnhancement);return this.domainName=null!==(e=null===(t=Fc.getApiResponse().retailerData)||void 0===t?void 0:t.domainName)&&void 0!==e?e:hn(),this.key="SuggestedCoupons",this.AllSuggestedCoupons=null!==(n=Cn(Gc.rawStorageObj[this.key]))&&void 0!==n?n:new Map,this.suggestedCoupons=null!==(r=this.AllSuggestedCoupons[this.domainName])&&void 0!==r?r:[],Object.keys(this.AllSuggestedCoupons).forEach((function(e){a.AllSuggestedCoupons[e]=a.AllSuggestedCoupons[e].filter((function(e){return e.timestamp+a.EXPIRY_PERIOD>Date.now()})),0===a.AllSuggestedCoupons[e].length&&delete a.AllSuggestedCoupons[e]})),this.suggestedCouponEnhancementExp=null!=o&&o,console.log("ALL SUGGESTED COUPONS",this.AllSuggestedCoupons),console.log("SUGGESTED COUPONS",this.suggestedCoupons),Promise.resolve()}},{key:"Update",value:(n=t(a().mark((function e(n,r,o,i,s,l,c){var u,d=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=this.PAGE_WAIT_TIME,!l){e.next=6;break}if(u=0,!o){e.next=6;break}return e.next=6,Wt.WaitForCondition(t(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",la.HasVisibleElement(o));case 1:case"end":return e.stop()}}),e)}))),this.PAGE_WAIT_TIME);case 6:return e.next=8,Wt.Sleep(u).then((function(){if(console.log("Looking for suggested coupons"),o){var e,t=la.GetFirstVisibleElement(o);if(void 0===i||Kt(i))e=null==t?void 0:t.textContent;else{var a,l=null==t||null===(a=t.textContent)||void 0===a?void 0:a.match(i);e=l&&l[1]?l[1]:""}Kt(e)||d.AddCoupons([e],r,n,$l.Selector,s)}var u=[];if(d.suggestedCouponEnhancementExp){var p=document.body.cloneNode(!0),h="";p.querySelectorAll("script").forEach((function(e){h+=e.innerHTML,e.remove()})),u=[].concat(J(d.GetSuggestedCouponsFromStr(p.innerHTML,d.GetHTMLRegex())),J(d.GetSuggestedCouponsFromStr(h,d.GetScriptRegex()))),u=J(new Set(u))}else u=J(new Set(J(document.body.innerHTML.matchAll(/[^\w](?<!area\s?|zip\s?|postal\s?|no\s)(?:(?:coupon)?code|promotion)"?(?::|\s|<\w+>|>)+"?(\w+)/gi)).map((function(e){return e[1]})).filter((function(e){return e.length>3&&e.length<20&&(/\d/.test(e)||e===e.toUpperCase())}))));d.AddCoupons(u,r,n,$l.Automated,s),La.isExperimentActive(ka.suppressedCoupons)&&d.RemoveSuppressedCoupons(c,s),d.RemoveInvalidCoupons(),d.suggestedCoupons&&d.suggestedCoupons.length>0&&(d.suggestedCoupons.sort((function(e,t){return t.timestamp-e.timestamp})),d.suggestedCouponEnhancementExp?d.suggestedCoupons=d.suggestedCoupons.slice(0,d.MAX_SUGGESTED_COUPONS_COUNT_TO_STORE):d.suggestedCoupons=d.suggestedCoupons.slice(0,d.MAX_SUGGESTED_COUPONS_COUNT_FOR_AA),d.suggestedCoupons.sort((function(e,t){return d.GetScore(e)-d.GetScore(t)})),d.AllSuggestedCoupons[d.domainName]=d.suggestedCoupons),d.sendStorageMessage(d.key,JSON.stringify({value:JSON.stringify(d.AllSuggestedCoupons)}))})).catch((function(e){return console.log("Error while updating suggested coupons"+e)}));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,r,a,o,i,s){return n.apply(this,arguments)})},{key:"GetUpdatedAllSuggestedCouponsHistory",value:function(e){var t=this;return e.forEach((function(e){if("NotApplicable"===e.Applicability){var n=e.Code;t.UpdateSuggestedCouponFails(n)}})),this.AllSuggestedCoupons[this.domainName]=this.suggestedCoupons,Object.keys(this.AllSuggestedCoupons).forEach((function(e){t.AllSuggestedCoupons[e]=t.AllSuggestedCoupons[e].sort((function(e,t){return t.timestamp-e.timestamp})),t.AllSuggestedCoupons[e]=t.AllSuggestedCoupons[e].slice(0,t.MAX_SUGGESTED_COUPONS_COUNT_TO_STORE),t.AllSuggestedCoupons[e]=t.AllSuggestedCoupons[e].filter((function(e){return e.timestamp+t.EXPIRY_PERIOD>Date.now()})),0===t.AllSuggestedCoupons[e].length&&delete t.AllSuggestedCoupons[e]})),this.AllSuggestedCoupons}},{key:"IsSuggestedCouponsEnhancementExpEnabled",value:function(){return this.suggestedCouponEnhancementExp}},{key:"UpdateSuggestedCouponFails",value:function(e){var t=this.suggestedCoupons.findIndex((function(t){return t.couponCode.toLocaleLowerCase()===e.toLocaleLowerCase()}));-1!==t&&this.suggestedCoupons[t].numberOfFails++}},{key:"AddCoupons",value:function(e,t,n,r,a){var o=this;e&&e.length>0&&e.forEach((function(e){var i=o.FindCoupon(t,e),s=o.FindCoupon(o.suggestedCoupons,e);if(s)s.timestamp=Date.now(),s.extraction=Math.min(s.extraction,r),void 0===s.numberOfFails&&(s.numberOfFails=0),n<s.source&&(s.source=n,s.title="Coupon suggested by ".concat(o.domainName));else{var l=new oc;if(l.attribution=o.domainName,l.title="Coupon suggested by ".concat(o.domainName),l.couponCode=e,l.extraction=r,l.numberOfFails=0,l.providerId="SuggestedCoupon",l.source=n,l.timestamp=Date.now(),o.suggestedCoupons.push(l),!i){var c=new Jl(e,o.domainName,te.SuggestedCoupon,location.pathname,JSON.stringify(l)),u=o.fromPlatformDetection?"Site suggested a coupon we didn't have from platform detection":"Site suggested a coupon we didn't have";wl.SendLogEventMessage(c,y.CollectedCoupons,null!=a?a:"",u,E.Information)}}}))}},{key:"FindCoupon",value:function(e,t){return e.find((function(e){return e.couponCode.toLocaleLowerCase()===t.toLocaleLowerCase()}))}},{key:"RemoveInvalidCoupons",value:function(){var e=this;this.suggestedCoupons&&this.suggestedCoupons.length>0&&(console.log("REMOVED INVALID COUPONS",this.suggestedCoupons.filter((function(t){return e.invalidCouponList.includes(t.couponCode)}))),this.suggestedCoupons=this.suggestedCoupons.filter((function(t){return!e.invalidCouponList.find((function(e){return!Kt(t.couponCode)&&e.toLocaleLowerCase()===t.couponCode.toLocaleLowerCase()}))})),this.AllSuggestedCoupons[this.domainName]=this.suggestedCoupons)}},{key:"RemoveSuppressedCoupons",value:function(e,t){var n=this;if(e)try{var r=[];if(e.forEach((function(e){var t=n.suggestedCoupons.findIndex((function(t){return t.couponCode.toLowerCase()===e.toLowerCase()}));-1!==t&&(r.push(n.suggestedCoupons[t]),n.suggestedCoupons.splice(t,1))})),0===r.length)return;var a=new Jl("",this.domainName,te.SuppressedSuggestedCoupons,location.pathname,JSON.stringify(r));wl.SendLogEventMessage(a,y.CollectedCoupons,null!=t?t:"","Site suggested some coupons which are suppressed coupons",E.Information)}catch(e){console.log("Error while removing suppressed coupons from suggested coupons list"+e)}}},{key:"GetScore",value:function(e){return this.suggestedCouponEnhancementExp?10*e.extraction+5*e.numberOfFails+e.source:10*e.extraction+e.source}},{key:"GetSuggestedCouponsFromStr",value:function(e,t){return J(e.matchAll(t)).map((function(e){return e[1]})).filter((function(e){return(e.length>3||3===e.length&&!$t(e))&&(/\d/.test(e)||e===e.toUpperCase())}))}},{key:"GetScriptRegex",value:function(){return/[^\w](?<!no\s|product\s)(?:(?:couponcode|aktionscode)"?|code|promotion)(?::|-|\s|<[^>]+>|>)+"?(\w+)/gi}},{key:"GetHTMLRegex",value:function(){return/[^\w](?<!no\s|product\s)(?:(?:coupon|aktions)?code|promotion)"?(?::|-|\s|<[^>]+>|>)+"?(\w+)/gi}}]),e}(),Hc=Vc,Wc="CartDataStorageInfo",Kc="CartDataFastCollection",Yc=432e5,zc=c((function e(){o(this,e),pe(this,"OrderTotal",void 0),pe(this,"OrderSubTotal",void 0),pe(this,"CartDataCreationTime",void 0),pe(this,"CartId",void 0),pe(this,"CartPreTax",void 0),pe(this,"CartEstimatedTax",void 0),pe(this,"ShipmentDate",void 0),pe(this,"Currency",void 0),pe(this,"Products",void 0),pe(this,"ProductIds",void 0),pe(this,"ProductUrls",void 0),pe(this,"BlockedCoupons",void 0),pe(this,"ExtractionId",void 0)})),jc=function(){function e(){o(this,e),pe(this,"productTitle",void 0),pe(this,"productPrice",void 0),pe(this,"productUrl",void 0),pe(this,"productImg",void 0),pe(this,"productQuantity",void 0),pe(this,"productSeller",void 0),pe(this,"foundInWebAssist",void 0),pe(this,"webAssistTitle",void 0),pe(this,"webAssistPrice",void 0),pe(this,"webAssistImg",void 0),pe(this,"buyNowItem",void 0),this.foundInWebAssist=!1}return c(e,null,[{key:"Create",value:function(t){var n=new e;return n.productTitle=t.productTitle,n.productPrice=t.productPrice,n.productUrl=t.productUrl,n.productImg=t.productImg,n.productQuantity=t.productQuantity,n.productSeller=t.productSeller,n.buyNowItem=t.buyNowItem,n}}]),e}(),Jc=function(){function e(){o(this,e),pe(this,"domain",void 0),pe(this,"cartValue",void 0),pe(this,"subTotal",void 0),pe(this,"currency",void 0),pe(this,"cartUrl",void 0),pe(this,"products",void 0),pe(this,"cartId",void 0),pe(this,"productIds",void 0)}return c(e,null,[{key:"Create",value:function(t){var n,r=new e;return r.domain=t.domain,r.cartValue=t.cartValue,r.currency=t.currency,r.cartUrl=t.cartUrl,r.cartId=t.cartId,r.products=[],r.productIds="",null===(n=t.products)||void 0===n||n.forEach((function(e){r.products.push(jc.Create(e))})),r}}]),e}();function Xc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Qc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xc(Object(n),!0).forEach((function(t){pe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Zc(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return qc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return qc(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function qc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var $c,eu=function(){function e(t){o(this,e),pe(this,"webAssistQueryService",void 0),this.webAssistQueryService=t}var n,r,i,s;return c(e,[{key:"TryCollectCartInformation",value:(s=t(a().mark((function e(t,n,r,o,i,s,l){var c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.CollectCartInformation(t,n,r,o,i,s,l);case 3:e.next=10;break;case 5:e.prev=5,e.t0=e.catch(0),console.log("Error during automatic cart collection: "+(null===e.t0||void 0===e.t0?void 0:e.t0.message)),c={cartId:null!=l?l:"",cartUrl:location.pathname,domain:t},this.LogCartExtractionEvent(c,y.CartExtraction,null===e.t0||void 0===e.t0?void 0:e.t0.message,E.Error,o);case 10:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(e,t,n,r,a,o,i){return s.apply(this,arguments)})},{key:"CollectCartInformation",value:(i=t(a().mark((function e(n,r,o,i,s,l,c){var u,d,p,h,f,v,C,g,S,m,A,I,T,O,P,k,_;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Collecting cart information automatically"),(d=new Jc).domain=n,d.cartValue=r.OrderTotal,d.currency=r.Currency,d.cartUrl=location.pathname,d.cartId=null!=c?c:fe.uuidv4(),d.products=[],p=0,h=null,f=null,e.next=13,Mt(t(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v=document.querySelectorAll("img"),e.abrupt("return",void 0!==v&&v.length>0);case 2:case"end":return e.stop()}}),e)}))),5e3);case 13:return e.next=15,wt(1e4);case 15:if(!(void 0===(v=document.querySelectorAll("img"))||v.length<=0)){e.next=21;break}return C="Unable to automatically find products in cart",console.log(C),this.LogCartExtractionEvent(d,y.CartExtractionError,C,E.Error,i),e.abrupt("return");case 21:g=Zc(v),e.prev=22,g.s();case 24:if((S=g.n()).done){e.next=59;break}if(m=S.value,this.isVisible(m)){e.next=28;break}return e.abrupt("continue",57);case 28:if(!this.isAtTopOfPage(m)){e.next=30;break}return e.abrupt("continue",57);case 30:if(0!==p||this.isInViewPort(m)){e.next=32;break}return e.abrupt("continue",57);case 32:if(A=this.findProductContainer(m),!(0===p&&m.offsetHeight>0)){e.next=42;break}if((I=this.isPotentialCartItem(m,A,n))&&A){e.next=37;break}return e.abrupt("continue",57);case 37:p=m.offsetHeight,h=A,d.products.push(I),e.next=57;break;case 42:if(p!==m.offsetHeight){e.next=57;break}if((T=this.isPotentialCartItem(m,A,n))&&A){e.next=46;break}return e.abrupt("continue",57);case 46:if(null!=f){e.next=52;break}if(h){e.next=49;break}return e.abrupt("continue",57);case 49:if(null!=(f=this.getCommonParent(h,A))){e.next=52;break}return e.abrupt("continue",57);case 52:if(O=Node.DOCUMENT_POSITION_CONTAINED_BY,f.compareDocumentPosition(A)&O){e.next=56;break}return e.abrupt("continue",57);case 56:d.products.push(T);case 57:e.next=24;break;case 59:e.next=64;break;case 61:e.prev=61,e.t0=e.catch(22),g.e(e.t0);case 64:return e.prev=64,g.f(),e.finish(64);case 67:return e.next=69,this.augmentWithWebAssist(d.products,n,s,l);case 69:if(console.log("cartInfo: "),console.log(d),d.products=[],!((null===(u=d.products)||void 0===u?void 0:u.length)>0)){e.next=78;break}this.LogCartExtractionEvent(d,y.CartExtraction,"Successfully automatically extracted Cart Information",E.Information,i),this.StoreCartInfoInLocalStorage(d,r),e.next=83;break;case 78:return P=this.scrapeCandidateUrls(n),e.next=81,this.generateWebassistProducts(P,s,l);case 81:(null==(k=e.sent)?void 0:k.length)>0?(d.products=k,console.log("webassistcartInfo: ",k),this.LogCartExtractionEvent(d,y.CartExtraction,"Successfully automatically extracted Cart Information via webassist scraping",E.Information,i),this.StoreCartInfoInLocalStorage(d,r)):(_="Unable to automatically get enough info about products in cart",console.log(_),this.LogCartExtractionEvent(d,y.CartExtractionError,_,E.Error,i));case 83:case"end":return e.stop()}}),e,this,[[22,61,64,67]])}))),function(e,t,n,r,a,o,s){return i.apply(this,arguments)})},{key:"augmentWithWebAssist",value:(r=t(a().mark((function e(t,n,r,o){var i,s,l=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&0!==t.length){e.next=2;break}return e.abrupt("return");case 2:return i=t.map((function(e){return l.normalizeUrl(e.productUrl,n)})),e.next=5,this.webAssistQueryService.QueryWebAssistUrls(r,i,o);case 5:(s=e.sent)&&t.forEach((function(e){if(null!=e&&e.productUrl){var t=l.normalizeUrl(e.productUrl,n);if(l.HasValidWebAssistEntry(s,t)){var r=s[t];r.entity&&l.AugmentProductWithWebAssistProduct(e,r)}}}));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,n,a){return r.apply(this,arguments)})},{key:"normalizeUrl",value:function(e,t){return e?e.startsWith("http")?e:"https://www.".concat(t).concat(e):""}},{key:"isVisible",value:function(e){var t=e.offsetHeight>0&&e.offsetWidth>0&&"hidden"!==e.style.visibility&&"none"!==e.style.display;return t}},{key:"isAtTopOfPage",value:function(e){var t,n;return window.pageYOffset+(null!==(t=null===(n=e.getBoundingClientRect())||void 0===n?void 0:n.top)&&void 0!==t?t:0)<200}},{key:"isInViewPort",value:function(e){var t,n=e.getBoundingClientRect(),r=n.left,a=n.top;return!0===(null===(t=document.elementFromPoint(r,a))||void 0===t?void 0:t.isSameNode(e))}},{key:"isPotentialCartItem",value:function(e,t,n){var r,a;if(null==t)return null;var o=t.tagName.toLocaleLowerCase();if("html"===o||"body"===o)return null;var i=J(t.querySelectorAll("a")).filter((function(e){return wl.IsValidPDPUrlHeuristic(e.href,n)}));if(i.length<=0)return null;var s=i[0],l=s.href,c=new jc;c.productUrl=l;var u,d,p=null!==(r=s.innerText)&&void 0!==r?r:s.getAttribute("title");if(""===p&&i.length>1)for(var h=1;h<i.length&&""===p;h++){var f;p=null!==(f=i[h].innerText)&&void 0!==f?f:i[h].getAttribute("title")}""===p&&(p=null!==(u=null!==(d=e.getAttribute("title"))&&void 0!==d?d:e.getAttribute("alt"))&&void 0!==u?u:"");c.productTitle=p,c.productImg=null!==(a=e.getAttribute("src"))&&void 0!==a?a:"";var v=this.GetPrices(t);return null!=v&&v.length&&(c.productPrice=this.GetMinimumPrice(v)),c}},{key:"GetMinimumPrice",value:function(e){var t=tn(e[0]);return Math.min.apply(Math,J(e.map((function(e){return parseFloat(e.replace(t,"").replace(/,/g,""))}))))}},{key:"findProductContainer",value:function(e){for(var t=e.parentElement;null!=t&&"BODY"!==t.nodeName;){var n=this.GetPrices(t);if(null!=n&&n.length&&t.querySelector("a"))return t;t=t.parentElement}return null}},{key:"GetPrices",value:function(e){var t=tn(e.innerText);if(t&&$t(t)){var n=new RegExp("("+nn(t)+"[0-9,]+(?:.[0-9]{1,2}){0,1})","g");return e.innerText.match(n)}return[]}},{key:"getCommonParent",value:function(e,t){var n=e.parentElement;if(e===t)return n;if(null==n)return null;for(var r=Node.DOCUMENT_POSITION_CONTAINED_BY,a=n.compareDocumentPosition(t);!(a&r);){if(null==(n=n.parentElement))return null;a=n.compareDocumentPosition(t)}var o=n.tagName.toLocaleLowerCase();return"html"===o||"body"===o?null:n}},{key:"HasValidWebAssistEntry",value:function(e,t){return e.hasOwnProperty(t)}},{key:"AugmentProductWithWebAssistProduct",value:function(e,t){var n,r=t.entity;e.foundInWebAssist=!0,e.webAssistTitle=null!==(n=t.title)&&void 0!==n?n:r.name,e.webAssistImg=r.image;var a=this.CleanWebAssistPrice(r.price_value);a&&(e.webAssistPrice=a)}},{key:"scrapeCandidateUrls",value:function(e){var t=this,n=Array.from(document.querySelectorAll("a")).filter((function(e){return e.href&&""!==e.href&&"#"!==e.href})).filter((function(e){return!t.isAtTopOfPage(e)})).map((function(e){return e.href})).filter((function(t){return wl.IsValidPDPUrlHeuristic(t,e)}));return J(new Set(n))}},{key:"generateWebassistProducts",value:(n=t(a().mark((function e(t,n,r){var o,i,s,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.webAssistQueryService.QueryWebAssistUrls(n,t,r);case 2:if(o=e.sent,i=[],o)for(s in o)o[s].entity&&((l=new jc).productUrl=s,this.AugmentProductWithWebAssistProduct(l,o[s]),i.push(l));return e.abrupt("return",i);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"LogCartExtractionEvent",value:function(e,t,n,r,a){var o,i,s,l,c=Vm.GetLocalDataService(),u=null!==(o=null===(i=c.GetSessionIds())||void 0===i?void 0:i.retailerSessionId)&&void 0!==o?o:"",d=null!==(s=null===(l=c.GetSessionIds())||void 0===l?void 0:l.pageVisitId)&&void 0!==s?s:"";e=Qc(Qc({},e),{},{PageVisitId:d,RetailerSessionId:u}),wl.SendLogEventMessage(e,t,a,n,r)}},{key:"StoreCartInfoInLocalStorage",value:function(e,t){var n=new zc;n.OrderTotal=t.OrderTotal,n.CartDataCreationTime=Date.now(),n.CartId=e.cartId,bt(Wc,JSON.stringify(n))}},{key:"CleanWebAssistPrice",value:function(e){if(e)try{return jt((e=e.replace(/\s/g,"")).split("-")[0])}catch(e){console.log("Error in parsing webassist price string:",e.message)}}}]),e}(),tu=eu,nu=function(){function e(){o(this,e),pe(this,"timeStamp",void 0),pe(this,"allowed",void 0)}return c(e,null,[{key:"GetAAConsentStorageKey",value:function(e){return"AAConsentData_"+e}}]),e}();!function(e){e[e.COUPONS_CLIPPING=0]="COUPONS_CLIPPING",e[e.OTHER_SELLERS=1]="OTHER_SELLERS",e[e.OTHER_SELLERS_CONFIRMATION=2]="OTHER_SELLERS_CONFIRMATION",e[e.EXCLUSIVE_COUPONS=3]="EXCLUSIVE_COUPONS",e[e.OTHER_SELLERS_TRIGGER=4]="OTHER_SELLERS_TRIGGER",e[e.ATTAINABLE_COUPONS=5]="ATTAINABLE_COUPONS",e[e.REWARDS_GIFT_CARD=6]="REWARDS_GIFT_CARD",e[e.PRINT_GROCERY=7]="PRINT_GROCERY",e[e.GROCERY_ITEMIZED_CASHBACK=8]="GROCERY_ITEMIZED_CASHBACK",e[e.AUTOS_MARKETPLACE=9]="AUTOS_MARKETPLACE",e[e.ABANDONED_CART=11]="ABANDONED_CART",e[e.PRODUCT_TRACKING_OUT_OF_STOCK=12]="PRODUCT_TRACKING_OUT_OF_STOCK",e[e.GROCERY_ITEMIZED_CASHBACK_LANDING=13]="GROCERY_ITEMIZED_CASHBACK_LANDING",e[e.SPB_CASHBACK_LANDING=14]="SPB_CASHBACK_LANDING",e[e.AA_CONSENT=16]="AA_CONSENT"}($c||($c={}));function ru(e,t){if(Kt(e))return-1;var n=new Date(e),r=void 0===t?new Date:new Date(t),a=n?r.getTime()-n.getTime():0;return Math.floor(a/1e3/60/60)}var au,ou=c((function e(){o(this,e),pe(this,"BgaaResultAvailable",void 0)}));!function(e){e.ClippingGrocery="ClippingGrocery",e.GroceryNoClipping="GroceryNoClipping",e.Clipping="Clipping",e.SaveSocialCoupons="SaveSocialCoupons",e.GroceryCashback="GroceryCashback",e.Grocery="Grocery",e.OtherSellers="OtherSellers",e.NoRetailerData="NoRetailerData",e.FailUpdateCheckoutPage="FailUpdateCheckoutPage",e.NoCheckoutPageUrl="NoCheckoutPageUrl",e.NoPDPPage="NoPDPPage",e.NotGiftCard="NotGiftCard",e.NotGroceries="NotGroceries",e.PageIsValid="PageIsValid",e.PageIsInvalid="PageIsInvalid",e.IsPageValidError="IsPageValidError",e.NoPinterestDeals="NoPinterestDeals",e.PinterestDeals="PinterestDeals",e.NoSocialCoupons="NoSocialCoupons",e.NoSelectors="NoSelectors",e.FallbackValidation="FallbackValidation",e.FallbackError="FallbackError",e.NoCoupons="NoCoupons",e.PageBecameValid="PageBecameValid",e.CheckingOtherSellers="CheckingOtherSellers",e.AutosMarketplace="AutosMarketplace",e.TrendingDealsChina="TrendingDealsChina",e.SuggestedCouponsOnlyPage="SuggestedCouponsOnlyPage",e.AbandonedCart="AbandonedCart",e.ProductTracking="ProductTracking",e.AutoOpenControllerActive="AutoOpenControllerActive",e.DisabledCheckoutPageData="DisabledCheckoutPageData",e.AAConsent="AAConsent",e.EndofScript_ProductPage="EndofScript_ProductPage",e.EndofScript_CheckoutPage="EndofScript_CheckoutPage",e.EndofScript_HomePage="EndofScript_HomePage",e.EndofScript_SearchPage="EndofScript_SearchPage",e.SponsoredPromotions="SponsoredPromotions",e.EnablePersonalization="EnablePersonalization",e.InvalidCartTotal="InvalidCartTotal"}(au||(au={}));var iu=c((function e(){o(this,e),pe(this,"domain",void 0),pe(this,"validationReason",void 0),pe(this,"time",void 0),pe(this,"initializeTime",void 0),pe(this,"preValidationTime",void 0),pe(this,"path",void 0),pe(this,"pageStatus",void 0),pe(this,"scriptRunNum",void 0),pe(this,"validationMsgNum",void 0)}));function su(){return La.isExperimentActive(ka.bgaaUx)||La.isExperimentActive(ka.bgaaCheckoutOld)||La.isExperimentActive(ka.bgaaNonCheckoutOld)}var lu=function(){function e(){o(this,e),pe(this,"localDataService",void 0),pe(this,"aaConsentEnabled",void 0),pe(this,"aaConsentData",void 0),pe(this,"validatorModule",void 0),pe(this,"domainName",void 0),pe(this,"apiResponse",void 0)}var n,r,i;return c(e,[{key:"Init",value:(i=t(a().mark((function e(){var t,n,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.localDataService=Vm.GetLocalDataService(),this.validatorModule=Vm.GetValidatorModule(),this.domainName=this.localDataService.GetDomainName(),this.aaConsentEnabled=null!==(t=null===(n=this.localDataService.GetCheckoutPageData().retailerData)||void 0===n?void 0:n.aaConsentEnabled)&&void 0!==t&&t,this.apiResponse=Fc.getApiResponse(),this.aaConsentEnabled){e.next=7;break}return e.abrupt("return");case 7:r=this.getAAConsentStr(Gc.rawStorageObj,this.localDataService.GetDomainName()),this.aaConsentData=this.getAAConsentData(r);case 9:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"GetPopupOriginationList",value:function(){return[Ro.AA_CONSENT]}},{key:"CanAutoOpenForFeature",value:(r=t(a().mark((function e(t){var n,r,o,i,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.aaConsentEnabled){e.next=2;break}return e.abrupt("return",!1);case 2:if(n=this.apiResponse.retailerData.allProductPages,!su()){e.next=13;break}r=0;case 6:if(!(r<n.length)){e.next=13;break}if(!this.apiResponse.retailerData.allProductPages[r].backgroundAAEnabled){e.next=10;break}return e.abrupt("return",!1);case 10:r++,e.next=6;break;case 13:return o=!0,this.aaConsentData&&(s=ru(null===(i=this.aaConsentData)||void 0===i?void 0:i.timeStamp))>=0&&s<120&&(console.log("AA Consent: Time since last notification: ",s),o=!1),o&&(Vl("CanOpenAAConsent","true"),this.validatorModule.SendValidationMessage(!1,au.AAConsent,this.domainName,[$c.AA_CONSENT],!1,!ml())),e.abrupt("return",o);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"PostValidation",value:(n=t(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"isAutoTriggeredAAAllowed",value:function(){var e;if(!this.aaConsentEnabled||null===(e=this.aaConsentData)||void 0===e||!e.allowed)return!1;var t=ru(this.aaConsentData.timeStamp);return t>=0&&t<1||(console.log("AA Consent has expired: Time since last consent: ",t),!1)}},{key:"AutoTriggerAutoApply",value:function(e){if(this.aaConsentData){this.aaConsentData.allowed=!1;var t=nu.GetAAConsentStorageKey(this.localDataService.GetDomainName());wl.SendStorageMessage(t,JSON.stringify({value:JSON.stringify(this.aaConsentData)}));var n=new ou;n.BgaaResultAvailable=e,wl.StartEdgeDriver("",JSON.stringify({action:de.PDPconsentAA,data:n}))}}},{key:"getAAConsentStr",value:function(e,t){var n,r,a=nu.GetAAConsentStorageKey(t);return"string"==typeof e[a]?e[a]:null!==(n=null===(r=e[a])||void 0===r?void 0:r.value)&&void 0!==n?n:""}},{key:"getAAConsentData",value:function(e){try{if(!e)return;return JSON.parse(e)}catch(e){var t="Error while getting storage data for AA consent. "+e;return void console.log(t)}}}]),e}(),cu=lu;function uu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return h(this,n)}}var du=function(e){d(n,e);var t=uu(n);function n(){var e;o(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return pe(p(e=t.call.apply(t,[this].concat(a))),"traceId",void 0),e}return c(n,[{key:"init",value:function(e,t,n,r){this.initCommonInfo(e,t,n,ae.Validator),this.traceId=r,this.sendErrorMessage=this.sendValidatorErrorMessage.bind(this),this.sendStorageMessage=wl.SendStorageMessage.bind(this),this.initialize()}},{key:"initialize",value:function(){this.autoOpenDataStr=null==Gc?void 0:Gc.AutoOpenData,this.lastCleanedDataStr=null==Gc?void 0:Gc.LastCleanedData,this.initializeData()}},{key:"sendValidatorErrorMessage",value:function(e,t){try{var n="error";console.log("checkout page status:error"),console.log(t),wl.SendLogEvent(e,t,n,void 0,void 0,void 0),console.log("sending error status"),wl.SendMessage(Cl.CheckoutPageValidationError,[n,this.traceId])}catch(e){console.log("error when sending error message",e)}}}]),n}(Wo),pu=du,hu=c((function e(){o(this,e),pe(this,"retailerData",void 0),pe(this,"impressionId",void 0),pe(this,"coupons",void 0),pe(this,"suppressedCoupons",void 0),pe(this,"market",void 0),pe(this,"userPersonalizationInfo",void 0),pe(this,"cashback",void 0),pe(this,"isCashbackEstimationSupportedForDomain",void 0),pe(this,"userInfo",void 0)})),fu=hu,vu=function(){function e(){o(this,e)}var n,r;return c(e,null,[{key:"WaitAndGetCartValue",value:(r=t(a().mark((function n(r,o,i){var s,l,c;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(l=r,c={OrderTotal:-1,Currency:null!==(s=Qt(o))&&void 0!==s?s:"$",PageCurrency:""},!Wt.IsValidDataField(l)){n.next=6;break}return n.next=5,Wt.WaitForCondition(t(a().mark((function t(){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(null===(n=e.GetCartValue(l,o))||void 0===n?void 0:n.OrderTotal)>0);case 1:case"end":return t.stop()}}),t)}))),null!=i?i:1e4).then((function(){return e.GetCartValue(l,o)})).catch((function(){return c}));case 5:c=n.sent;case 6:return n.abrupt("return",c);case 7:case"end":return n.stop()}}),n)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"WaitAndGetCartValue2",value:(n=t(a().mark((function n(r,o,i){var s,l;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(l={OrderTotal:-1,Currency:null!==(s=Qt(o))&&void 0!==s?s:"$",PageCurrency:""},!Wt.IsValidDataField(r)){n.next=5;break}return n.next=4,Wt.WaitForCondition(t(a().mark((function t(){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(null===(n=e.TrySimpleGetCartValue(r,o))||void 0===n?void 0:n.OrderTotal)>0);case 1:case"end":return t.stop()}}),t)}))),null!=i?i:1e4).then((function(){return e.TrySimpleGetCartValue(r,o)})).catch((function(){return l}));case 4:l=n.sent;case 5:return n.abrupt("return",l);case 6:case"end":return n.stop()}}),n)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"TrySimpleGetCartValue",value:function(e,t){var n,r,a,o=document.querySelector(e),i=(n=Qt(t),null!==(r=null==o?void 0:o.textContent)&&void 0!==r?r:"");a=jt(i);var s=tn(i,!0);return{OrderTotal:a,Currency:qt(s,t),PageCurrency:s}}},{key:"GetCartValue",value:function(e,t){n=Qt(t);var n,r,a,o=wl.GetOrderTotalString(e);a=null!==(r=jt(o))&&void 0!==r?r:-1;var i=tn(o,!0);return{OrderTotal:a,Currency:qt(i,t),PageCurrency:i}}}]),e}(),Cu=vu;function gu(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Su(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Su(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function Su(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var mu=function(){function e(){o(this,e)}var n;return c(e,null,[{key:"CreateCheckoutPageData",value:function(e){if(e){var t=new fu;if(e.retailerData?t.retailerData=Lc.Create(e.retailerData):console.log("retailerData undefined"),e.impressionId&&(t.impressionId=e.impressionId),e.coupons){t.coupons=[];var n,r=gu(e.coupons);try{for(r.s();!(n=r.n()).done;){var a=n.value;t.coupons.push(a)}}catch(e){r.e(e)}finally{r.f()}}if(e.suppressedCoupons){t.suppressedCoupons=[];var o,i=gu(e.suppressedCoupons);try{for(i.s();!(o=i.n()).done;){var s=o.value;t.suppressedCoupons.push(s)}}catch(e){i.e(e)}finally{i.f()}}return e.userPersonalizationInfo&&(t.userPersonalizationInfo=e.userPersonalizationInfo),e.market&&(t.market=e.market),e.cashback&&(t.cashback=Qn.Create(e.cashback)),e.userInfo&&(t.userInfo=lc.Create(e)),t.isCashbackEstimationSupportedForDomain=e.isCashbackEstimationSupportedForDomain,t}return console.log("apiResponse undefined"),new fu}},{key:"GetInitialFields",value:function(e){var t=[],n=e.retailerData.getCurrentCheckoutPage();n&&[n.inputBoxSelector,n.removeCouponButtonSelector,n.clickBeforeStartSelector,n.layoutClickSelector].forEach((function(e){Wt.IsValidDataField(e)&&t.push(e)}));return console.log("fieldsToCheck count:"+t.length),t}},{key:"GetAndSendOrderTotal",value:function(e,t,n){var r,a=this,o=!1,i=!1;n!==au.NoCheckoutPageUrl&&n!==au.DisabledCheckoutPageData||(o=!0),n!==au.NoSelectors&&n!==au.PageIsInvalid&&n!==au.IsPageValidError||(i=!0);var s=this.getDefaultOrderTotalErrorMessage(n),l=Fc.getApiResponse(),c=null===(r=l.retailerData)||void 0===r?void 0:r.domainName;try{var u=l.retailerData.getCurrentCheckoutPage();this.GetOrderTotal(u,e,l.impressionId,c).then((function(e){a.SendValidationLog(t,l.impressionId,l.traceId,o,i,c,e.OrderTotal,e.Currency),e.OrderTotal>0&&(Vl("orderTotal",e.OrderTotal.toString()),Vl("pageCurrency",e.PageCurrency.toString()))}))}catch(e){var d;wl.SendLogEvent(l.impressionId,null!==(d=null==e?void 0:e.message)&&void 0!==d?d:s,"error")}}},{key:"GetCurrentPathName",value:function(){return location.pathname}},{key:"SendValidationLog",value:function(e,t,n,r,a,o,i,s){var l=wl.GetValidationLogMessage(e,r,a);e?i&&-1!==i&&wl.SendLogEvent(t,l,"true",i,s,void 0,void 0,o):wl.SendLogEvent(t,l,"false",i,s,void 0,void 0,o),i&&-1!==i&&this.SendGMVMessage(i,null!=s?s:"$",n)}},{key:"SendGMVMessage",value:function(e,t,n){var r,a=en(t)?t:null!==(r=Zt(t))&&void 0!==r?r:"USD";wl.SendMessage(Cl.CheckoutPageGMV,[n,e.toString(),a])}},{key:"GetOrderTotal",value:(n=t(a().mark((function e(n,r,o,i){var s,l,c,u,d,p,h,f;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=null!==(s=Qt(r))&&void 0!==s?s:"$",c={OrderTotal:-1,Currency:l,PageCurrency:""},!n||!Wt.IsValidDataField(n.orderTotalDataElementSelector)){e.next=7;break}return e.next=6,Wt.WaitForCondition(t(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",la.HasVisibleElement(n.orderTotalDataElementSelector));case 1:case"end":return e.stop()}}),e)}))),5e3).then((function(){return Cu.GetCartValue(n.orderTotalDataElementSelector,r)})).catch((function(e){var t;return wl.SendLogEvent(o,null!==(t=null==e?void 0:e.message)&&void 0!==t?t:"checkoutpage GMV error.","error"),c}));case 6:c=e.sent;case 7:try{d=null==Gc?void 0:Gc.CartValues,p=null!==(u=Cn(d,!0))&&void 0!==u?u:{},h=new Date,p[i]={cartValue:c,timestamp:h},f=JSON.stringify({value:JSON.stringify(p)}),wl.SendStorageMessage("CartValues",f)}catch(e){console.log("Could not reset cart value in storage: "+e)}return console.log("Found cart Value: "),console.log(c),e.abrupt("return",c);case 11:case"end":return e.stop()}}),e)}))),function(e,t,r,a){return n.apply(this,arguments)})},{key:"GetValidatorAutoOpenController",value:function(){var e,t=Fc.getApiResponse(),n=location.pathname,r=new pu;return r.init(t.impressionId,null==t||null===(e=t.retailerData)||void 0===e?void 0:e.domainName,n,t.traceId),r}},{key:"getDefaultOrderTotalErrorMessage",value:function(e){switch(e){case au.DisabledCheckoutPageData:return"disabled checkoutpage GMV error.";case au.NoSelectors:return"no valid initial fields to check";case au.NoCoupons:return"no coupons";case au.NoCheckoutPageUrl:return"no checkoutpage data GMV error."}return"checkoutpage GMV error."}}]),e}(),Au=mu;function Eu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return h(this,n)}}var yu,Iu,Tu=function(e){d(n,e);var t=Eu(n);function n(e,r,a,i,s){var l;return o(this,n),pe(p(l=t.call(this)),"ButtonClicked",void 0),pe(p(l),"ModuleId",void 0),pe(p(l),"Domain",void 0),pe(p(l),"Metadata",void 0),pe(p(l),"FlyoutId",void 0),l.ButtonClicked=e,l.ModuleId=r,l.Domain=a,l.Metadata=i,l.FlyoutId=s,l}return c(n)}(wn);!function(e){e.COUPONS_AVAILABLE="COUPONS_AVAILABLE",e.COUPONS_AUTO_APPLY="COUPONS_AUTO_APPLY",e.COUPONS_CLIPPING="COUPONS_CLIPPING",e.SIMILAR_OFFERS="SIMILAR_OFFERS",e.PRICE_COMPARE_LOWER_PRICES="PRICE_COMPARE_LOWER_PRICES",e.PRICE_COMPARE_BEST_PRICE="PRICE_COMPARE_BEST_PRICE",e.REBATES_ACTIVATE_CASHBACK="REBATES_ACTIVATE_CASHBACK",e.REBATES_BING_CONFIRMATION="REBATES_BING_CONFIRMATION",e.PRICE_HISTORY_DROP="PRICE_HISTORY_DROP",e.PRICE_DROP_PLUS_COUPONS="PRICE_DROP_PLUS_COUPONS",e.PRICE_DROP_PLUS_CASHBACK="PRICE_DROP_PLUS_CASHBACK",e.CASHBACK_PLUS_COUPONS="CASHBACK_PLUS_COUPONS",e.LOWER_PRICE_PLUS_CASHBACK_PLUS_COUPONS="LOWER_PRICE_PLUS_CASHBACK_PLUS_COUPONS",e.PRICE_HISTORY_STABLE="PRICE_HISTORY_STABLE",e.PRICE_HISTORY_INCREASE="PRICE_HISTORY_INCREASE",e.PRICE_HISTORY_NO_INSIGHT="PRICE_HISTORY_NO_INSIGHT",e.DEALS="DEALS",e.PROFESSIONAL_REVIEWS="PROFESSIONAL_REVIEWS",e.VIDEO_REVIEWS="VIDEO_REVIEWS",e.RECOMMENDATIONS="RECOMMENDATIONS",e.ACTIVATE_CASHBACK_NEW="ACTIVATE_CASHBACK_NEW",e.EXPRESS_CHECKOUT="EXPRESS_CHECKOUT",e.ACTIVATE_REWARDS_NEW="ACTIVATE_REWARDS_NEW",e.OTHER_SELLER="OTHER_SELLER",e.PRODUCT_HISTORY="PRODUCT_HISTORY",e.PAYMENT_OPTIONS="PAYMENT_OPTIONS",e.TIPS="TIPS",e.PACKAGE_TRACKING_OPT_IN="PACKAGE_TRACKING_OPT_IN",e.PACKAGE_TRACKING_STATUS_VIEW="PACKAGE_TRACKING_STATUS_VIEW",e.PINTEREST_COUPONS_AVAILABLE="PINTEREST_COUPONS_AVAILABLE",e.PINTEREST_PRICE_HISTORY_DROP="PINTEREST_PRICE_HISTORY_DROP",e.PINTEREST_PRICE_HISTORY_INCREASE="PINTEREST_PRICE_HISTORY_INCREASE",e.PINTEREST_PRICE_HISTORY_STABLE="PINTEREST_PRICE_HISTORY_STABLE",e.PINTEREST_REBATES_ACTIVATE_CASHBACK="PINTEREST_REBATES_ACTIVATE_CASHBACK",e.CASHBACK_RETAILER="CASHBACK_RETAILER",e.GROCERY_PRINT_COUPONS="GROCERY_PRINT_COUPONS",e.GROCERY_DIGITAL_COUPONS="GROCERY_DIGITAL_COUPONS",e.PWILO_NOTIFICATION_PRICE_DROP="PWILO_NOTIFICATION_PRICE_DROP",e.SUSTAINABILITY_LANDING_FULL="SUSTAINABILITY_LANDING_FULL",e.SUSTAINABILITY_LANDING_FOOTER="SUSTAINABILITY_LANDING_FOOTER",e.SUSTAINABILITY_PURCHASE_CONFIRMATION="SUSTAINABILITY_PURCHASE_CONFIRMATION",e.ATTAINABLE_COUPONS="ATTAINABLE_COUPONS",e.COUPON_ATTAINED="COUPON_ATTAINED",e.ATTAINABLE_COUPONS_OVERLAY="ATTAINABLE_COUPONS_OVERLAY",e.ITEMIZED_CASHBACK="ITEMIZED_CASHBACK",e.FEED_TRENDING_OFFERS="FEED_TRENDING_OFFERS",e.FEED_TRENDING_OFFERS_ON_CONTEXTUAL_TAB="FEED_TRENDING_OFFERS_ON_CONTEXTUAL_TAB",e.FEED_DAILY_DEALS="FEED_DAILY_DEALS",e.FEED_INFINITE_CATEGORY="FEED_INFINITE_CATEGORY",e.FEED_MOMENT_IN_TIME="FEED_MOMENT_IN_TIME",e.AUTOS_MARKETPLACE="AUTOS_MARKETPLACE",e.AUTOS_PRICE_INSIGHT="AUTOS_PRICE_INSIGHT",e.AUTOS_INCENTIVES="AUTOS_INCENTIVES",e.ABANDONED_CART="ABANDONED_CART",e.AWARENESS="AWARENESS",e.PRODUCT_TRACKING_STOCK="PRODUCT_TRACKING_STOCK",e.PRODUCT_TRACKING_PRICE="PRODUCT_TRACKING_PRICE",e.PRODUCT_TRACKING_NOTIFICATION="PRODUCT_TRACKING_NOTIFICATION",e.PRODUCT_TRACKING_COLLECTIONS="PRODUCT_TRACKING_COLLECTIONS",e.SHOPPING_TRIPS="SHOPPING_TRIPS",e.VIEW_BEST_COUPON_MODULE="VIEW_BEST_COUPON_MODULE",e.INBOX_COUPONS="INBOX_COUPONS",e.ACTIVE_RETAILER_INBOX_COUPONS="ACTIVE_RETAILER_INBOX_COUPONS",e.PRODUCT_TRACKING_OUT_OF_STOCK_NOTIFICATION="PRODUCT_TRACKING_OUT_OF_STOCK_NOTIFICATION",e.PRODUCT_TRACKING_OFFERS_COUPON_NOTIFICATION="PRODUCT_TRACKING_OFFERS_COUPON_NOTIFICATION",e.PRODUCT_TRACKING_BACK_IN_STOCK_NOTIFICATION="PRODUCT_TRACKING_BACK_IN_STOCK_NOTIFICATION",e.PRODUCT_BEST_COUPON="PRODUCT_BEST_COUPON",e.PRODUCT_TRACKING_ALERT="PRODUCT_TRACKING_ALERT",e.ABANDONED_CART_NOTIFICATION_COUPONS="ABANDONED_CART_NOTIFICATION_COUPONS",e.REWARD_GIFT_CARD="REWARD_GIFT_CARD",e.YOUTUBE_COUPONS_RETAILER="YOUTUBE_COUPONS_RETAILER",e.YOUTUBE_COUPONS_RETAILER_CHECKOUT="YOUTUBE_COUPONS_RETAILER_CHECKOUT",e.YOUTUBE_COUPONS_HOME="YOUTUBE_COUPONS_HOME",e.YOUTUBE_COUPONS_VIDEO="YOUTUBE_COUPONS_VIDEO",e.SAN_CONSENT_NOTIFICATION="SAN_CONSENT_NOTIFICATION",e.FEED_BUY_DIRECT="FEED_BUY_DIRECT",e.CODEX_CHAT="CODEX_CHAT",e.AX_SHOPPING_NAV="AX_SHOPPING_NAV",e.INSTANT_ADD_TO_CART_OVERLAY="INSTANT_ADD_TO_CART_OVERLAY",e.SEARCH_RESULTS="SEARCH_RESULTS",e.FEED_VISUAL_SEARCH="FEED_VISUAL_SEARCH",e.FEED_RELATED_PRODUCTS="FEED_RELATED_PRODUCTS",e.FEED_NATIVE_ADS="FEED_NATIVE_ADS",e.DISCOVER_SHOPPING="DISCOVER_SHOPPING",e.DISCOVER_CHAT_CHIPS="DISCOVER_CHAT_CHIPS",e.SHOPPING_CHIPS="SHOPPING_CHIPS",e.SMART_COMPARE="SMART_COMPARE",e.PRODUCT_SUMMARY="PRODUCT_SUMMARY",e.PRODUCT_SUMMARY_CARD="PRODUCT_SUMMARY_CARD",e.BUYING_GUIDES="BUYING_GUIDES",e.USER_INSIGHTS="USER_INSIGHTS",e.EXPERT_INSIGHTS="EXPERT_INSIGHTS",e.WIN_CART="WIN_CART",e.DISCOVER_CHAT="DISCOVER_CHAT",e.SAFARI_FIRST_RUN_EXPERIENCE="SAFARI_FIRST_RUN_EXPERIENCE",e.SIDEPANE_CASHBACK="SIDEPANE_CASHBACK",e.CAMPAIGN_PDP_CASHBACK="CAMPAIGN_PDP_CASHBACK",e.CAMPAIGN_BANNER="CAMPAIGN_BANNER",e.FEED_CAMPAIGN="FEED_CAMPAIGN ",e.CAMPAIGN_PDP_CASHBACK_NOTIFICATION="CAMPAIGN_PDP_CASHBACK_NOTIFICATION",e.CAMPAIGN_AWARENESS_NOTIFICATION="CAMPAIGN_AWARENESS_NOTIFICATION",e.CJK_SIMILAR_PRODUCTS="CJK_SIMILAR_PRODUCTS",e.WISHLIST="WISHLIST ",e.MENU="MENU",e.FOOTER="FOOTER",e.EDGE_OVERLAY="OVERLAY",e.EXTENSION_POPUP="EXTENSION_POPUP",e.EXTENSION_AUTOAPPLY="EXTENSION_AUTOAPPLY",e.BELL_ICON="BELL_ICON",e.BANNER="BANNER",e.SEARCH_IN_PANE="SEARCH_IN_PANE",e.ENROLL_TO_CASHBACK_CONFIRMATION_NOTIFICATION="ENROLL_TO_CASHBACK_CONFIRMATION_NOTIFICATION",e.POST_PURCHASE_CONSENT_NOTIFICATION="POST_PURCHASE_CONSENT_NOTIFICATION",e.SEARCHBOXDEMO_NOTIFICATION="SEARCHBOXDEMO_NOTIFICATION",e.PRICE_MATCH_PRICE_DROP_NOTIFICATION="PRICE_MATCH_PRICE_DROP_NOTIFICATION",e.INBOX_PRICE_MATCH_PRICE_DROP_NOTIFICATION="INBOX_PRICE_MATCH_PRICE_DROP_NOTIFICATION",e.TRAVEL_CHEAPER_FLIGHT_NOTIFICATION="TRAVEL_CHEAPER_FLIGHT_NOTIFICATION",e.DISCOVER_NOTIFICATION="DISCOVER_NOTIFICATION",e.AX_SHOPPING_NAV_NOTIFICATION="AX_SHOPPING_NAV_NOTIFICATION",e.ARTICLES_CASHBACK="ARTICLES_CASHBACK",e.BACKGROUND_AUTO_APPLY="BACKGROUND_AUTO_APPLY",e.TRAVEL_CHEAPER_HOTEL_NOTIFICATION="TRAVEL_CHEAPER_HOTEL_NOTIFICATION",e.POST_PURCHASE_REWARDS_NOTIFICATION="POST_PURCHASE_REWARDS_NOTIFICATION",e.CASHBACK_DASHBOARD="CASHBACK_DASHBOARD",e.BUYING_OPTIONS="BUYING_OPTIONS"}(yu||(yu={})),function(e){e[e.COUPONS_AVAILABLE=0]="COUPONS_AVAILABLE",e[e.COUPONS_AUTO_APPLY=1]="COUPONS_AUTO_APPLY",e[e.COUPONS_CLIPPING=2]="COUPONS_CLIPPING",e[e.PRICE_COMPARE_LOWER_PRICES=3]="PRICE_COMPARE_LOWER_PRICES",e[e.PRICE_COMPARE_BEST_PRICE=4]="PRICE_COMPARE_BEST_PRICE",e[e.PRICE_COMPARE_SHOW_MORE_SELLERS=5]="PRICE_COMPARE_SHOW_MORE_SELLERS",e[e.REBATES_ACTIVATE_CASHBACK=6]="REBATES_ACTIVATE_CASHBACK",e[e.REBATES_BING_CONFIRMATION=7]="REBATES_BING_CONFIRMATION",e[e.PRICE_HISTORY_DROP=8]="PRICE_HISTORY_DROP",e[e.PRICE_HISTORY_STABLE=9]="PRICE_HISTORY_STABLE",e[e.PRICE_HISTORY_INCREASE=10]="PRICE_HISTORY_INCREASE",e[e.DEALS=11]="DEALS",e[e.PROFESSIONAL_REVIEWS=12]="PROFESSIONAL_REVIEWS",e[e.VIDEO_REVIEWS=13]="VIDEO_REVIEWS",e[e.RECOMMENDATIONS=14]="RECOMMENDATIONS",e[e.ACTIVATE_CASHBACK_NEW=15]="ACTIVATE_CASHBACK_NEW",e[e.EXPRESS_CHECKOUT=16]="EXPRESS_CHECKOUT",e[e.ACTIVATE_REWARDS_NEW=17]="ACTIVATE_REWARDS_NEW",e[e.OTHER_SELLER=18]="OTHER_SELLER",e[e.PRODUCT_HISTORY=19]="PRODUCT_HISTORY",e[e.TIPS=20]="TIPS",e[e.PAYMENT_OPTIONS=21]="PAYMENT_OPTIONS",e[e.PWILO_NOTIFICATION_PRICE_DROP=22]="PWILO_NOTIFICATION_PRICE_DROP",e[e.YOUTUBE_COUPONS_HOME=23]="YOUTUBE_COUPONS_HOME",e[e.YOUTUBE_COUPONS_VIDEO=24]="YOUTUBE_COUPONS_VIDEO",e[e.YOUTUBE_COUPONS_RETAILER=25]="YOUTUBE_COUPONS_RETAILER",e[e.YOUTUBE_COUPONS_AUTO_APPLY=27]="YOUTUBE_COUPONS_AUTO_APPLY",e[e.CASHBACK_RETAILER=28]="CASHBACK_RETAILER",e[e.GROCERY_PRINT_COUPONS=29]="GROCERY_PRINT_COUPONS",e[e.GROCERY_DIGITAL_COUPONS=30]="GROCERY_DIGITAL_COUPONS",e[e.PINTEREST_COUPONS_AVAILABLE=31]="PINTEREST_COUPONS_AVAILABLE",e[e.PINTEREST_REBATES_ACTIVATE_CASHBACK=32]="PINTEREST_REBATES_ACTIVATE_CASHBACK",e[e.PINTEREST_PRICE_HISTORY_DROP=33]="PINTEREST_PRICE_HISTORY_DROP",e[e.PINTEREST_PRICE_HISTORY_STABLE=34]="PINTEREST_PRICE_HISTORY_STABLE",e[e.PINTEREST_PRICE_HISTORY_INCREASE=35]="PINTEREST_PRICE_HISTORY_INCREASE",e[e.PACKAGE_TRACKING_OPT_IN=36]="PACKAGE_TRACKING_OPT_IN",e[e.PACKAGE_TRACKING_STATUS_VIEW=37]="PACKAGE_TRACKING_STATUS_VIEW",e[e.SUSTAINABILITY_LANDING_FOOTER=39]="SUSTAINABILITY_LANDING_FOOTER",e[e.SUSTAINABILITY_PURCHASE_CONFIRMATION=40]="SUSTAINABILITY_PURCHASE_CONFIRMATION",e[e.NTP_REBATES_SAVINGS=41]="NTP_REBATES_SAVINGS",e[e.NTP_ABANDONED_CART=42]="NTP_ABANDONED_CART",e[e.NTP_RECENTLY_VIEWED=43]="NTP_RECENTLY_VIEWED",e[e.NTP_FAVE_RETAILERS=44]="NTP_FAVE_RETAILERS",e[e.NTP_PERSONALIZED_CASHBACK=45]="NTP_PERSONALIZED_CASHBACK",e[e.PCB_VIEWED=46]="PCB_VIEWED",e[e.REWARD_GIFT_CARD=47]="REWARD_GIFT_CARD",e[e.COUPONS_AUTO_APPLY_AUTOFILL=49]="COUPONS_AUTO_APPLY_AUTOFILL",e[e.ITEMIZED_CASHBACK=50]="ITEMIZED_CASHBACK",e[e.GROCERY=51]="GROCERY",e[e.SHOPRUNNER_SIGNUP=52]="SHOPRUNNER_SIGNUP",e[e.NTP_TOP_SITES_SHOPPING_TILE=53]="NTP_TOP_SITES_SHOPPING_TILE",e[e.FEED_TRENDING_OFFERS=54]="FEED_TRENDING_OFFERS",e[e.FEED_DAILY_DEALS=55]="FEED_DAILY_DEALS",e[e.FEED_INFINITE_CATEGORY=56]="FEED_INFINITE_CATEGORY",e[e.ABANDONED_CART=57]="ABANDONED_CART",e[e.PRODUCT_TRACKING_STOCK=58]="PRODUCT_TRACKING_STOCK",e[e.PRODUCT_TRACKING_PRICE=59]="PRODUCT_TRACKING_PRICE",e[e.PRODUCT_TRACKING_NOTIFICATION=60]="PRODUCT_TRACKING_NOTIFICATION",e[e.PRODUCT_TRACKING_COLLECTIONS=61]="PRODUCT_TRACKING_COLLECTIONS",e[e.ATTAINABLE_COUPONS=62]="ATTAINABLE_COUPONS",e[e.COUPON_ATTAINED=63]="COUPON_ATTAINED",e[e.ATTAINABLE_COUPONS_OVERLAY=64]="ATTAINABLE_COUPONS_OVERLAY",e[e.COMMUNITY_COUPONS=65]="COMMUNITY_COUPONS",e[e.AWARENESS=66]="AWARENESS",e[e.OMNIBOX_COUPON_SUGGESTION_MATCH=67]="OMNIBOX_COUPON_SUGGESTION_MATCH",e[e.OMNIBOX_COUPON_HISTORY_MATCH=68]="OMNIBOX_COUPON_HISTORY_MATCH",e[e.OMNIBOX_CASHBACK_SUGGESTION_MATCH=69]="OMNIBOX_CASHBACK_SUGGESTION_MATCH",e[e.OMNIBOX_CASHBACK_HISTORY_MATCH=70]="OMNIBOX_CASHBACK_HISTORY_MATCH",e[e.VIEW_BEST_COUPON_MODULE=71]="VIEW_BEST_COUPON_MODULE",e[e.PRODUCT_TRACKING_OUT_OF_STOCK_NOTIFICATION=72]="PRODUCT_TRACKING_OUT_OF_STOCK_NOTIFICATION",e[e.PRODUCT_TRACKING_BACK_IN_STOCK_NOTIFICATION=73]="PRODUCT_TRACKING_BACK_IN_STOCK_NOTIFICATION",e[e.ABANDONED_CART_NOTIFICATION_COUPONS=74]="ABANDONED_CART_NOTIFICATION_COUPONS",e[e.INBOX_COUPONS=75]="INBOX_COUPONS",e[e.ACTIVE_RETAILER_INBOX_COUPONS=76]="ACTIVE_RETAILER_INBOX_COUPONS",e[e.AUTOS_MARKETPLACE=77]="AUTOS_MARKETPLACE",e[e.AUTOS_PRICE_INSIGHT=78]="AUTOS_PRICE_INSIGHT",e[e.SAN_CONSENT_NOTIFICATION=81]="SAN_CONSENT_NOTIFICATION",e[e.FEED_BUY_DIRECT=82]="FEED_BUY_DIRECT",e[e.FEED_MOMENT_IN_TIME=83]="FEED_MOMENT_IN_TIME",e[e.PRICE_HISTORY_NO_INSIGHT=84]="PRICE_HISTORY_NO_INSIGHT",e[e.FEED_TRENDING_OFFERS_ON_CONTEXTUAL_TAB=85]="FEED_TRENDING_OFFERS_ON_CONTEXTUAL_TAB",e[e.AUTOS_INCENTIVES=86]="AUTOS_INCENTIVES",e[e.GOODRX=87]="GOODRX",e[e.GOODRX_OVERLAY=88]="GOODRX_OVERLAY",e[e.SIMILAR_OFFERS=89]="SIMILAR_OFFERS",e[e.SEARCH_RESULTS=90]="SEARCH_RESULTS",e[e.FEED_VISUAL_SEARCH=91]="FEED_VISUAL_SEARCH",e[e.FEED_NATIVE_ADS=92]="FEED_NATIVE_ADS",e[e.AX_SHOPPING_NAV=93]="AX_SHOPPING_NAV",e[e.SHOPPING_CHIPS=95]="SHOPPING_CHIPS",e[e.SMART_COMPARE=96]="SMART_COMPARE",e[e.BUYING_GUIDES=97]="BUYING_GUIDES",e[e.CAMPAIGN_PDP_CASHBACK=98]="CAMPAIGN_PDP_CASHBACK",e[e.CAMPAIGN_BANNER=99]="CAMPAIGN_BANNER",e[e.FEED_CAMPAIGN=100]="FEED_CAMPAIGN",e[e.CAMPAIGN_PDP_CASHBACK_NOTIFICATION=101]="CAMPAIGN_PDP_CASHBACK_NOTIFICATION",e[e.CAMPAIGN_AWARENESS_NOTIFICATION=102]="CAMPAIGN_AWARENESS_NOTIFICATION",e[e.PRICE_DROP_PLUS_COUPONS=103]="PRICE_DROP_PLUS_COUPONS",e[e.PRODUCT_BEST_COUPON=104]="PRODUCT_BEST_COUPON",e[e.WIN_CART=105]="WIN_CART",e[e.SIDEPANE_CASHBACK=106]="SIDEPANE_CASHBACK",e[e.WISHLIST=107]="WISHLIST",e[e.MENU=108]="MENU",e[e.PRODUCT_TRACKING_ALERT=109]="PRODUCT_TRACKING_ALERT",e[e.OVERLAY_SHARE=110]="OVERLAY_SHARE",e[e.OVERLAY_CLOSE=111]="OVERLAY_CLOSE",e[e.EXTENSION_POPUP=112]="EXTENSION_POPUP",e[e.EXTENSION_AUTOAPPLY=113]="EXTENSION_AUTOAPPLY",e[e.BELL_ICON=114]="BELL_ICON",e[e.BANNER=115]="BANNER",e[e.SEARCH_IN_PANE=116]="SEARCH_IN_PANE",e[e.FOOTER=117]="FOOTER",e[e.CASHBACK_PLUS_COUPONS=118]="CASHBACK_PLUS_COUPONS",e[e.PRICE_DROP_PLUS_CASHBACK=119]="PRICE_DROP_PLUS_CASHBACK",e[e.POST_PURCHASE_CONSENT_NOTIFICATION=120]="POST_PURCHASE_CONSENT_NOTIFICATION",e[e.OMNIBOX_PCB_HISTORY_MATCH=121]="OMNIBOX_PCB_HISTORY_MATCH",e[e.LOWER_PRICE_PLUS_CASHBACK_PLUS_COUPONS=122]="LOWER_PRICE_PLUS_CASHBACK_PLUS_COUPONS",e[e.PRICE_MATCH_PRICE_DROP_NOTIFICATION=124]="PRICE_MATCH_PRICE_DROP_NOTIFICATION",e[e.PRODUCT_TRACKING_OFFERS_COUPON_NOTIFICATION=125]="PRODUCT_TRACKING_OFFERS_COUPON_NOTIFICATION",e[e.SHOPPING_TRIPS=126]="SHOPPING_TRIPS",e[e.DISCOVER_NOTIFICATION=127]="DISCOVER_NOTIFICATION",e[e.AX_SHOPPING_NAV_NOTIFICATION=128]="AX_SHOPPING_NAV_NOTIFICATION",e[e.BACKGROUND_AUTO_APPLY=129]="BACKGROUND_AUTO_APPLY",e[e.FEED_RELATED_PRODUCTS=130]="FEED_RELATED_PRODUCTS",e[e.PRODUCT_SUMMARY_CARD=131]="PRODUCT_SUMMARY_CARD",e[e.INSTANT_ADD_TO_CART_OVERLAY=132]="INSTANT_ADD_TO_CART_OVERLAY",e[e.ARTICLES_CASHBACK=133]="ARTICLES_CASHBACK",e[e.INBOX_PRICE_MATCH_PRICE_DROP_NOTIFICATION=134]="INBOX_PRICE_MATCH_PRICE_DROP_NOTIFICATION",e[e.TRAVEL_CHEAPER_FLIGHT_NOTIFICATION=135]="TRAVEL_CHEAPER_FLIGHT_NOTIFICATION",e[e.TRAVEL_CHEAPER_HOTEL_NOTIFICATION=136]="TRAVEL_CHEAPER_HOTEL_NOTIFICATION",e[e.POST_PURCHASE_REWARDS_NOTIFICATION=137]="POST_PURCHASE_REWARDS_NOTIFICATION",e[e.BUYING_OPTIONS=138]="BUYING_OPTIONS",e[e.MAX_VALUE=139]="MAX_VALUE"}(Iu||(Iu={}));var Ou,Pu,ku=c((function e(t){o(this,e),pe(this,"Timestamp",void 0),pe(this,"ProductId",void 0),pe(this,"Title",void 0),pe(this,"CurrencySymbol",void 0),pe(this,"ProductUrl",void 0),pe(this,"ImageUrl",void 0),pe(this,"CurrentPrice",void 0),pe(this,"OlderPrice",void 0),this.Timestamp=null==t?void 0:t.timestamp,this.ProductId=null==t?void 0:t.productId,this.Title=null==t?void 0:t.title,this.CurrencySymbol=null==t?void 0:t.currencySymbol,this.ProductUrl=null==t?void 0:t.productUrl,this.ImageUrl=null==t?void 0:t.imageUrl,this.CurrentPrice=null==t?void 0:t.currentPrice,this.OlderPrice=null==t?void 0:t.olderPrice})),_u=c((function e(t){o(this,e),pe(this,"domain",void 0),pe(this,"type",void 0),pe(this,"value",void 0),pe(this,"sellerName",void 0),this.domain=null==t?void 0:t.domain,this.type=null==t?void 0:t.type,this.value=null==t?void 0:t.value,this.sellerName=null==t?void 0:t.sellerName})),bu=c((function e(t){o(this,e),pe(this,"url",void 0),pe(this,"productId",void 0),pe(this,"domain",void 0),pe(this,"price",void 0),pe(this,"globalOfferId",void 0),pe(this,"trackingUrl",void 0),this.url=null==t?void 0:t.url,this.productId=null==t?void 0:t.productId,this.domain=null==t?void 0:t.domain,this.price=null==t?void 0:t.price,this.globalOfferId=null==t?void 0:t.globalOfferId,this.trackingUrl=null==t?void 0:t.trackingUrl})),Nu=c((function e(t){o(this,e),pe(this,"couponCode",void 0),pe(this,"successRate",void 0),pe(this,"discountRate",void 0),pe(this,"sellerName",void 0),this.couponCode=null==t?void 0:t.couponCode,this.successRate=null==t?void 0:t.successRate,this.discountRate=null==t?void 0:t.discountRate,this.sellerName=null==t?void 0:t.sellerName}));function Ru(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return h(this,n)}}!function(e){e.OutOfStock="OutOfStock",e.PriceDrop="PriceDrop"}(Ou||(Ou={})),function(e){e.AbandonedCart="AbandonedCart",e.Explicit="Explicit",e.PostPurchase="PostPurchase"}(Pu||(Pu={}));var Du=function(e){d(n,e);var t=Ru(n);function n(e){var r;return o(this,n),pe(p(r=t.call(this,e)),"basePrice",void 0),pe(p(r),"notificationEnabled",!1),pe(p(r),"notificationPercentageDrop",void 0),pe(p(r),"lastNotifiedAt",void 0),pe(p(r),"expirationDate",void 0),pe(p(r),"trackingType",void 0),pe(p(r),"metadata",void 0),pe(p(r),"imageUrl",void 0),pe(p(r),"durationInWeeks",void 0),pe(p(r),"trackingSource",Pu.Explicit),pe(p(r),"notifyForComparableProduct",!1),pe(p(r),"domain",void 0),pe(p(r),"comparableProductNotification",void 0),pe(p(r),"highSuccessRateCoupon",void 0),pe(p(r),"cashbackCommission",void 0),pe(p(r),"sellerName",void 0),r.basePrice=null==e?void 0:e.basePrice,void 0!==(null==e?void 0:e.notificationEnabled)&&(r.notificationEnabled=null==e?void 0:e.notificationEnabled),r.notificationPercentageDrop=null==e?void 0:e.notificationPercentageDrop,r.lastNotifiedAt=null==e?void 0:e.lastNotifiedAt,r.expirationDate=null==e?void 0:e.expirationDate,r.trackingType=null==e?void 0:e.trackingType,r.metadata=null==e?void 0:e.metadata,r.imageUrl=null==e?void 0:e.imageUrl,r.durationInWeeks=null==e?void 0:e.durationInWeeks,void 0!==(null==e?void 0:e.trackingSource)&&(r.trackingSource=null==e?void 0:e.trackingSource),void 0!==(null==e?void 0:e.notifyForComparableProduct)&&(r.notifyForComparableProduct=null==e?void 0:e.notifyForComparableProduct),r.domain=null==e?void 0:e.domain,r.comparableProductNotification=new bu(null==e?void 0:e.comparableProductNotification),r.highSuccessRateCoupon=null!=e&&e.highSuccessRateCoupon?new Nu(null==e?void 0:e.highSuccessRateCoupon):void 0,r.cashbackCommission=null!=e&&e.cashbackCommission?new _u(null==e?void 0:e.cashbackCommission):void 0,r.sellerName=null==e?void 0:e.seller,r}return c(n)}(ku),xu=c((function e(t){o(this,e),pe(this,"abandonedCartTrackingEnabled",void 0),pe(this,"lastUpdatedAt",void 0),pe(this,"IsAnidTrackingConsented",void 0),pe(this,"_abandonedCartTrackingUnset",void 0),void 0===t?(this.abandonedCartTrackingEnabled=!0,this._abandonedCartTrackingUnset=!0,this.IsAnidTrackingConsented=!1):(this.abandonedCartTrackingEnabled=t.abandonedCartTrackingEnabled,this.IsAnidTrackingConsented=t.isAnidTrackingConsented),this.lastUpdatedAt=null==t?void 0:t.lastUpdatedAt}));function wu(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Uu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Uu(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function Uu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Lu,Mu,Bu=c((function e(t){if(o(this,e),pe(this,"trackedProducts",[]),pe(this,"_anid",void 0),pe(this,"_muid",void 0),pe(this,"_currentProduct",void 0),pe(this,"_abandonedCartNotificationToggle",void 0),pe(this,"timestamp",void 0),pe(this,"isUnsupportedDomain",void 0),pe(this,"trackingPreferences",void 0),t){this.trackingPreferences=new xu(t.trackingPreferences),this.isUnsupportedDomain=t.isUnsupportedDomain;var n,r=wu(t.trackedProducts);try{for(r.s();!(n=r.n()).done;){var a=n.value,i=new Du(a);i.Title&&i.ProductUrl&&this.trackedProducts.push(i)}}catch(e){r.e(e)}finally{r.f()}}})),Fu=c((function e(t,n,r){o(this,e),pe(this,"title",void 0),pe(this,"imageUrl",void 0),pe(this,"currency",void 0),pe(this,"extractedImage",void 0),pe(this,"price",void 0),pe(this,"ProductUrl",void 0),pe(this,"base64ProductImage",void 0),pe(this,"triggerPriceHistoryIncreasedAlert",!1),pe(this,"triggerPriceHistoryMinorDropAlert",!1),pe(this,"triggerPriceHistoryStableAlert",!1),pe(this,"originalPrice",void 0),this.title=t,this.imageUrl=n,this.currency=r}));!function(e){e.onCashbackActivationError="onCashbackActivationError",e.onCashBackActivated="onCashBackActivated",e.onDelayedCashBackActivated="onDelayedCashBackActivated",e.onCashBackActivatedForRewards="onCashBackActivatedForRewards",e.telemetryCashBackActivationError="telemetryCashBackActivationError",e.onSignedInAndEnrolledInRebates="onSignedInAndEnrolledInRebates",e.onSignedInAndEnrolledInRebatesFailed="onSignedInAndEnrolledInRebatesFailed",e.telemetryCashBackActivated="telemetryCashBackActivated",e.StyleActivatedState="StyleActivatedState",e.StyleProcessingState="StyleProcessingState",e.CreateCommissionArrow="CreateCommissionArrow",e.CreateModules="CreateModules",e.CreateFeedbackModule="CreateFeedbackModule",e.CreateShortFeedbackModule="CreateShortFeedbackModule",e.ModulesRendered="ModulesRendered",e.PWILOPriceHistory="PWILOPriceHistory",e.onRebatesTelemetrySuccess="onRebatesTelemetrySuccess",e.onRebatesTelemetryFail="onRebatesTelemetryFail",e.onRewardsTelemetrySuccess="onRewardsTelemetrySuccess",e.onRewardsTelemetryFail="onRewardsTelemetryFail",e.onFlyoutResize="onFlyoutResize",e.rebatesNotActivating="rebatesNotActivating",e.rebatesSignInPendingSuccess="rebatesSignInPendingSuccess",e.rebatesSignInFail="rebatesSignInFail",e.rebatesFetchUserInfoFail="rebatesFetchUserInfoFail",e.PDPUpdate="PDPUpdate",e.onDataUpdate="onDataUpdate",e.domainEligibility="domainEligibility",e.pdpEligibility="pdpEligibility",e.flyoutRefresh="flyoutRefresh",e.PWILODeleted="PWILODeleted",e.WinCartDeleted="WinCartDeleted",e.PWILOEmpty="PWILOEmpty",e.PDPRemoved="PDPRemoved",e.CreateCBLearnMore="CreateCBLearnMore",e.FooterCreated="FooterCreated",e.ReRankFlyout="ReRankFlyout",e.MenuOptionClicked="MenuOptionClicked",e.RequestRefresh="RequestRefresh",e.FocusProductCollections="FocusProductCollections",e.FocusProductTracking="FocusProductTracking",e.FocusshoppingTrips="FocusShoppingTrips",e.ProductTrackingUpdate="ProductTrackingUpdate",e.InboxCouponUserLoggedIn="InboxCouponUserLoggedIn",e.InboxCouponUserDisconnected="InboxCouponUserDisconnected",e.ActiveRetailerInboxCouponsEmpty="ActiveRetailerInboxCouponsEmpty",e.InboxCouponsOpenSettings="InboxCouponsOpenSettings",e.InboxCouponsUpsellTriggered="InboxCouponsUpsellTriggered",e.ClientEngagement="ClientEngagement",e.ClientAction="ClientAction",e.OnFlyoutDismissed="OnFlyoutDismissed",e.HomeTabActive="HomeTabActive",e.SeeMoreClick="SeeMoreClick",e.ToastNotification="ToastNotification",e.CompleteEntityExtracted="CompleteEntityExtracted",e.ChangeContextualTitle="ChangeContextualTitle",e.ShoppingSettingsOpened="ShoppingSettingsOpened",e.InboxCouponsEdgeUserSuccsefullySignedIn="InboxCouponsEdgeUserSuccsefullySignedIn",e.InboxCouponsEdgeUserWorkProfileSuccsefullySignedIn="InboxCouponsEdgeUserWorkProfileSuccsefullySignedIn"}(Lu||(Lu={})),function(e){e.topModuleName="topModuleName",e.topContextualModuleName="topContextualModuleName",e.topModulePriority="topModulePriority",e.renderedViewModuleCount="renderedViewModuleCount",e.modulesRendered="modulesRendered",e.isProductDetailPage="isProductDetailPage",e.pcLowestPriceImpression="pcLowestPriceImpression",e.multiPcImpressions="multiPcImpressions",e.canRenderAutoApply="canRenderAutoApply",e.ICOffersRendered="ICOffersRendered",e.nonICPDP="nonICPDP",e.ICRelatedOffersExist="ICRelatedOffersExist",e.icPdpAvailable="icPdpAvailable",e.isTrackingToggleRendered="isTrackingToggleRendered",e.pdpForActivatedAd="pdpForActivatedAd",e.outOfFlow="outOfFlow",e.shouldChangeTitle="shouldChangeTitle",e.renderedModules="renderedModules"}(Mu||(Mu={}));var Gu=function(e){return new CustomEvent(Lu.ToastNotification,{detail:e})},Vu=function(){function e(t,n){o(this,e),pe(this,"logModule",void 0),pe(this,"shopping",void 0),pe(this,"renderedModules",void 0),this.logModule=t,this.shopping=n,this.renderedModules=new Set,this.cleanStateMapping()}return c(e,[{key:"getState",value:function(t){return console.log("getting key ".concat(t,", ").concat(e.stateMapping.get(t))),e.stateMapping.get(t)}},{key:"setState",value:function(t,n){console.log("setting ".concat(t,", ").concat(n)),e.stateMapping.set(t,n)}},{key:"addEventListener",value:function(e,t){try{console.log("listening to event "+e),this.shopping.addEventListener(e,t)}catch(t){var n=li.EdgeImpressionId,r=new di(b.OnErrorInvoked);this.logModule.LogErrorEvent(y.EdgeFlyoutStatus,"addEventListener exception: ".concat(e," ").concat(t),r,n)}}},{key:"removeEventListener",value:function(e,t){try{console.log("stop listening to event "+e),this.shopping.removeEventListener(e,t)}catch(t){var n=li.EdgeImpressionId,r=new di(b.OnErrorInvoked);this.logModule.LogErrorEvent(y.EdgeFlyoutStatus,"removeEventListener exception: ".concat(e," ").concat(t),r,n)}}},{key:"dispatchEvent",value:function(e){try{console.log("dispatching event "+e.type),this.shopping.dispatchEvent(e)}catch(r){console.log("dispatching event error "+e.type+r);var t=li.EdgeImpressionId,n=new di(b.OnErrorInvoked);this.logModule.LogErrorEvent(y.EdgeFlyoutStatus,"dispatchEvent exception: ".concat(null==e?void 0:e.type," ").concat(r),n,t)}}},{key:"AddDiscoverRenderModule",value:function(e){this.renderedModules.add(e)}},{key:"CanDiscoverRender",value:function(e){return e in De&&this.renderedModules.has(De[e])}},{key:"cleanStateMapping",value:function(){e.stateMapping=new Map}}]),e}();pe(Vu,"stateMapping",new Map);function Hu(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Wu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Hu(Object(n),!0).forEach((function(t){pe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Hu(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ku(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Yu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Yu(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function Yu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var zu=["ja-jp","de-de","en-gb","en-ca","en-in","fr-fr","it-it","es-es","es-mx"],ju=function(){function e(t,n,r){o(this,e),this.flyoutData=n,this.stateManagement=r,pe(this,"pageHandlerModule",void 0),pe(this,"logModule",void 0),pe(this,"telemetryUtilities",void 0),pe(this,"utilities",void 0),pe(this,"storageHandler",void 0),pe(this,"anid",void 0),pe(this,"dealsEndpoint","https://www.bing.com/api/shopping/v1/savings"),pe(this,"trackedProductsCachePeriod",12e5),pe(this,"anidTrackingDataCachePeriod",864e5),pe(this,"userConsented",void 0),this.pageHandlerModule=t.pageHandlerModule,this.logModule=t.logModule,this.utilities=t.viewModulesUtilities,this.storageHandler=t.storageHandler,this.telemetryUtilities=t.telemetryHandler}var n,r,i,s,l,u,d,p,h,f,v,C,g,S,m,A,E,I,T,O,P,k,_,N,R,D,x,w,U,L,M,B,F;return c(e,[{key:"AnidTrackingAvailable",value:function(){var e=this.flyoutData.dataLoader.GetLoadTimeDataValue("aadEmail",void 0);return La.isExperimentActive(ka.PTEmail)&&!e}},{key:"shouldRenderProductCollections",value:(F=t(a().mark((function e(t){var n,r,o,i,s,l,c,u,d,p,h;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=!1,s=La.isExperimentActive(ka.productTracking),l=this.getAndCacheAfdMarket(),c="en-us"===l.toLocaleLowerCase(),u=zu.includes(l.toLocaleLowerCase()),e.next=7,this.GetLocalProductTrackingData();case 7:return d=e.sent,p=null==t?void 0:t.toLocaleLowerCase().includes("amazon."),h=p&&zu.includes(null!==(n=null===(r=this.flyoutData.common.market)||void 0===r?void 0:r.toLowerCase())&&void 0!==n?n:""),d&&(null==d||null===(o=d.trackedProducts)||void 0===o?void 0:o.length)>0&&(i=!0),e.abrupt("return",Promise.resolve((s||i||c||h&&u)&&this.flyoutData.common.isPane));case 12:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"hasUserConsented",value:(B=t(a().mark((function e(){var t,n,r,o,i,s,l,c,u,d,p;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.AnidTrackingAvailable()){e.next=2;break}return e.abrupt("return",!1);case 2:if(void 0===this.userConsented){e.next=4;break}return e.abrupt("return",this.userConsented);case 4:return e.next=6,this.storageHandler.getStorageString(Bc.ProductTrackingConsentStatus);case 6:if(o=e.sent,i=null!==(t=_n(o))&&void 0!==t?t:"",s="",!this.pageHandlerModule.IsMessageAllowed("getEdgeAnid")){e.next=24;break}return e.next=12,this.pageHandlerModule.GetEdgeAnid(!0);case 12:if(e.t1=l=e.sent,e.t0=null===e.t1,e.t0){e.next=16;break}e.t0=void 0===l;case 16:if(!e.t0){e.next=20;break}e.t2=void 0,e.next=21;break;case 20:e.t2=l.anid;case 21:if(s=e.t2){e.next=24;break}return e.abrupt("return",!1);case 24:if(!i||!i.IsAnidTrackingConsented){e.next=26;break}return e.abrupt("return",!0);case 26:return e.next=28,this.GetAnidProductTrackingData(s);case 28:return c=e.sent,u=null==c||null===(n=c.trackingPreferences)||void 0===n?void 0:n.IsAnidTrackingConsented,e.next=32,this.GetLocalProductTrackingData();case 32:return d=e.sent,null!=c&&c.trackingPreferences&&this.storageHandler.setStorageString(Bc.ProductTrackingConsentStatus,JSON.stringify({IsAnidTrackingConsented:!!u,timestamp:Date.now()})),p=u||void 0===u&&0===(null==d||null===(r=d.trackedProducts)||void 0===r?void 0:r.length),e.abrupt("return",this.userConsented=p);case 36:case"end":return e.stop()}}),e,this)}))),function(){return B.apply(this,arguments)})},{key:"anidLoggedInHasTrackedProductsButNotExplicitlyConsented",value:(M=t(a().mark((function e(){var t,n,r,o,i,s,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.AnidTrackingAvailable()){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,this.pageHandlerModule.GetEdgeAnid(!0);case 4:if(e.t1=t=e.sent,e.t0=null===e.t1,e.t0){e.next=8;break}e.t0=void 0===t;case 8:if(!e.t0){e.next=12;break}e.t2=void 0,e.next=13;break;case 12:e.t2=t.anid;case 13:return o=e.t2,e.next=16,this.GetAnidProductTrackingData(o);case 16:return i=e.sent,s=null==i||null===(n=i.trackingPreferences)||void 0===n?void 0:n.IsAnidTrackingConsented,e.next=20,this.GetLocalProductTrackingData();case 20:return l=e.sent,e.abrupt("return",o&&!s&&(null==l||null===(r=l.trackedProducts)||void 0===r?void 0:r.length));case 22:case"end":return e.stop()}}),e,this)}))),function(){return M.apply(this,arguments)})},{key:"setConsentLastShown",value:function(e){e&&this.storageHandler.setStorageString(Bc.ProductCollectionBannerLastShown,JSON.stringify({timestamp:Date.now(),banner:e}))}},{key:"shownBannerRecently",value:(L=t(a().mark((function e(t){var n,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageHandler.getStorageString(Bc.ProductCollectionBannerLastShown);case 2:if(n=e.sent,(null==(r=_n(n))?void 0:r.banner)!==t){e.next=6;break}return e.abrupt("return",Date.now()-r.timestamp<1728e5);case 6:return e.abrupt("return",!1);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return L.apply(this,arguments)})},{key:"isSupportedDomainForPrice",value:function(e){var t,n,r,a,o=this.getAndCacheAfdMarket().toLocaleLowerCase();if(!0===(null===(t=this.flyoutData.dataStoreModule.ProductTrackingData)||void 0===t?void 0:t.isUnsupportedDomain))return!1;var i=La.isExperimentActive(ka.productTracking),s="en-us"===o||i,l="en-us"===(null===(n=this.flyoutData.common.market)||void 0===n?void 0:n.toLowerCase())||!this.flyoutData.common.market,c=e.toLocaleLowerCase().includes("amazon."),u=zu.includes(o),d=c&&zu.includes(null!==(r=null===(a=this.flyoutData.common.market)||void 0===a?void 0:a.toLowerCase())&&void 0!==r?r:"");return s&&l||d&&u}},{key:"GetAnidProductTrackingData",value:(U=t(a().mark((function e(t){var n,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,this.storageHandler.getStorageString(Bc.ProductTrackingAnidData);case 4:if(!(n=e.sent)){e.next=9;break}if(null==(r=_n(n))||!r.timestamp||this.isStaleAnidTrackingData(r)){e.next=9;break}return e.abrupt("return",r);case 9:return e.abrupt("return",this.GetAnidProductTrackingDataFromEndpoint(t));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return U.apply(this,arguments)})},{key:"GetAnidProductTrackingDataFromEndpoint",value:(w=t(a().mark((function e(t){var n,r,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(n=t)||void 0===n){e.next=4;break}e.t0=n,e.next=7;break;case 4:return e.next=6,this.getAnid();case 6:e.t0=e.sent;case 7:return t=e.t0,e.next=10,this.createRequest("tracked-products?anid=".concat(t),void 0,"GET");case 10:return r=e.sent,(o=new Bu(null==r?void 0:r.productTrackingData)).timestamp=Date.now().toString(),this.storageHandler.setStorageString(Bc.ProductTrackingAnidData,JSON.stringify(o)),e.abrupt("return",o);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return w.apply(this,arguments)})},{key:"TrackProduct",value:(x=t(a().mark((function e(t,n,r,o){var i,s,l,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.createTrackProductBody(t,this.flyoutData.common,n,r,o);case 2:if(i=e.sent){e.next=8;break}return(s=new di(b.ProductTrackingDebug)).Metadata=JSON.stringify({product:t,isOutOfStock:n,duration:r,priceDrop:o}),this.logModule.LogErrorEvent(y.EdgeFlyoutStatus,"Failed to track product. Invalid product data",s),e.abrupt("return",null);case 8:return e.prev=8,e.next=11,this.createRequest("track",i);case 11:return l=e.sent,e.next=14,this.GetLocalProductTrackingDataFromEndpoint();case 14:if(null!=l&&l.success){e.next=16;break}throw new Error(l.errorCode||l.errorMessage);case 16:return l.product&&this.addProductToUrlProductsMap(t.ProductUrl,l.product),e.abrupt("return",new Du(l.product));case 20:e.prev=20,e.t0=e.catch(8),(c=new di(b.ProductTrackingNetworkError)).Metadata=JSON.stringify({product:t,err:e.t0,productRequest:i}),this.logModule.LogErrorEvent(y.EdgeFlyoutStatus,"Track product request failed: ".concat(e.t0),c),console.log("Error untracking product",e.t0);case 26:return e.abrupt("return",null);case 27:case"end":return e.stop()}}),e,this,[[8,20]])}))),function(e,t,n,r){return x.apply(this,arguments)})},{key:"TrackProductLocal",value:(D=t(a().mark((function t(n){var r,o;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return",[]);case 2:return t.next=4,this.GetLocalProductTrackingData();case 4:return(r=t.sent)&&Array.isArray(r.trackedProducts)?-1===(o=r.trackedProducts.findIndex((function(t){return e.IsSameProduct(t,n)})))?r.trackedProducts.push(n):r.trackedProducts[o]=n:r={trackedProducts:[n]},r.timestamp=(new Date).toString(),this.storageHandler.setStorageString(Bc.ProductTrackingTrackedProducts,JSON.stringify(r)),t.abrupt("return",r.trackedProducts);case 9:case"end":return t.stop()}}),t,this)}))),function(e){return D.apply(this,arguments)})},{key:"UntrackProduct",value:(R=t(a().mark((function e(t){var n,r,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.createUntrackProductBody(t,this.flyoutData.common);case 2:return n=e.sent,e.prev=3,e.next=6,this.createRequest("untrack",n);case 6:if(r=e.sent,this.GetLocalProductTrackingDataFromEndpoint(),r.success){e.next=10;break}throw new Error(r.errorCode||r.errorMessage);case 10:return e.next=12,this.removeProductFromUrlProductsMap(t.ProductUrl);case 12:return e.abrupt("return",r.success);case 15:e.prev=15,e.t0=e.catch(3),(o=new di(b.ProductTrackingNetworkError)).Metadata=JSON.stringify({product:t,productRequest:n,err:e.t0}),this.logModule.LogErrorEvent(y.EdgeFlyoutStatus,"Untrack product request failed: ".concat(e.t0),o),console.log("Error untracking product",e.t0);case 21:return e.abrupt("return",!1);case 22:case"end":return e.stop()}}),e,this,[[3,15]])}))),function(e){return R.apply(this,arguments)})},{key:"UntrackProductLocal",value:(N=t(a().mark((function t(n){var r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return",[]);case 2:return t.next=4,this.GetLocalProductTrackingData();case 4:if(r=t.sent){t.next=7;break}return t.abrupt("return",[]);case 7:return r.trackedProducts=((null==r?void 0:r.trackedProducts)||[]).filter((function(t){return!e.IsSameProduct(t,n)})),r.timestamp=(new Date).toString(),this.removeProductFromUrlProductsMap(n.ProductUrl),this.storageHandler.setStorageString(Bc.ProductTrackingTrackedProducts,JSON.stringify(r)),t.abrupt("return",r.trackedProducts);case 12:case"end":return t.stop()}}),t,this)}))),function(e){return N.apply(this,arguments)})},{key:"SetAbandondedCartPreferences",value:(_=t(a().mark((function e(t){var n,r,o,i,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.flyoutData.common.muid,e.next=3,this.getAnid();case 3:return r=e.sent,o={Muid:n,Anid:r,Preferences:{AbandonedCartTrackingEnabled:t}},e.prev=5,e.next=8,this.createRequest("set-user-preferences",o);case 8:if(i=e.sent,this.GetLocalProductTrackingDataFromEndpoint(),i.success){e.next=12;break}throw new Error(i.errorCode||i.errorMessage);case 12:return e.abrupt("return",i.success);case 15:e.prev=15,e.t0=e.catch(5),(s=new di(b.ProductTrackingNetworkError)).Metadata=JSON.stringify({err:e.t0}),this.logModule.LogErrorEvent(y.EdgeFlyoutStatus,"Set Muid preferences request failed: ".concat(e.t0),s),console.log("Error setting muid preferences",e.t0);case 21:return e.abrupt("return",!1);case 22:case"end":return e.stop()}}),e,this,[[5,15]])}))),function(e){return _.apply(this,arguments)})},{key:"RoamProductsFromEndpoint",value:(k=t(a().mark((function e(){var t,n,r,o,i,s,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAnid();case 2:return n=e.sent,r=this.flyoutData.common.muid,e.next=6,this.pageHandlerModule.GetEmailForMSA(!0);case 6:if(e.t1=t=e.sent,e.t0=null===e.t1,e.t0){e.next=10;break}e.t0=void 0===t;case 10:if(!e.t0){e.next=14;break}e.t2=void 0,e.next=15;break;case 14:e.t2=t.email;case 15:return o=e.t2,i={Muid:r,Anid:n,Email:o},e.prev=17,e.next=20,this.createRequest("roam-products",i);case 20:if(s=e.sent,this.GetLocalProductTrackingDataFromEndpoint(),this.GetAnidProductTrackingDataFromEndpoint(n),s.success){e.next=25;break}throw new Error(s.errorCode||s.errorMessage);case 25:return this.storageHandler.setStorageString(Bc.ProductTrackingConsentStatus,JSON.stringify({IsAnidTrackingConsented:!0,timestamp:Date.now()})),e.abrupt("return",s.success);case 29:e.prev=29,e.t3=e.catch(17),(l=new di(b.ProductTrackingNetworkError)).Metadata=JSON.stringify({err:e.t3}),this.logModule.LogErrorEvent(y.EdgeFlyoutStatus,"Roam products request failed: ".concat(e.t3),l),console.log("Error roaming products",e.t3);case 35:return e.abrupt("return",!1);case 36:case"end":return e.stop()}}),e,this,[[17,29]])}))),function(){return k.apply(this,arguments)})},{key:"LogProductNotification",value:(P=t(a().mark((function e(t,n,r){var o,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&n){e.next=2;break}return e.abrupt("return",!1);case 2:return e.prev=2,e.next=5,this.createRequest("log-notification",{Muid:t,ProductUrl:n},"POST",r);case 5:if((o=e.sent).success){e.next=8;break}throw new Error(o.errorCode||o.errorMessage);case 8:return e.abrupt("return",!0);case 11:e.prev=11,e.t0=e.catch(2),(i=new di(b.ProductTrackingNetworkError)).Metadata=JSON.stringify({Url:n,Muid:t,err:e.t0}),this.logModule.LogErrorEvent(y.EdgeFlyoutStatus,"Log notification request failed: ".concat(e.t0),i),console.log("Error logging tracked product",e.t0);case 17:return e.abrupt("return",!1);case 18:case"end":return e.stop()}}),e,this,[[2,11]])}))),function(e,t,n){return P.apply(this,arguments)})},{key:"GetTrackedProductFromApi",value:(O=t(a().mark((function e(t){var n,r,o,i,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAnid();case 2:return n=e.sent,r=this.flyoutData.common.muid,e.prev=4,o={Muid:r,Url:t},e.next=8,this.canUseAnidForRequest(n);case 8:if(!e.sent){e.next=10;break}o={Anid:n,Url:t};case 10:return e.next=12,this.createRequest("is-tracked",o);case 12:if((i=e.sent).success){e.next=15;break}throw new Error(i.errorCode||i.errorMessage);case 15:return e.abrupt("return",i.product);case 18:return e.prev=18,e.t0=e.catch(4),(s=new di(b.ProductTrackingNetworkError)).Metadata=JSON.stringify({Url:t,Muid:r,Anid:n,err:e.t0}),this.logModule.LogErrorEvent(y.EdgeFlyoutStatus,"Is tracked product request failed",s),console.log("Error getting tracked product",e.t0),e.abrupt("return",null);case 25:case"end":return e.stop()}}),e,this,[[4,18]])}))),function(e){return O.apply(this,arguments)})},{key:"GetTrackedProductsBySource",value:(T=t(a().mark((function e(t){var n,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getProductTrackingData();case 2:return n=e.sent,r=null==n?void 0:n.trackedProducts.filter((function(e){return e.trackingSource===t})),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"getProductTrackingData",value:(I=t(a().mark((function e(){var t,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.GetLocalProductTrackingData();case 2:if(t=e.sent,e.t0=!t,e.t0){e.next=8;break}return e.next=7,this.isStaleTrackedProducts(t);case 7:e.t0=e.sent;case 8:if(!e.t0){e.next=13;break}return e.next=11,this.GetLocalProductTrackingDataFromEndpoint();case 11:return n=e.sent,e.abrupt("return",n);case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this)}))),function(){return I.apply(this,arguments)})},{key:"SetProductTrackingData",value:(E=t(a().mark((function e(t,n){var r,o,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.trackedProducts,o=t.trackingPreferences,r){e.next=4;break}return e.abrupt("return",[]);case 4:if(i&&Array.isArray(i.trackedProducts)?i.trackedProducts=r:i={trackedProducts:r},o&&(i.trackingPreferences=o),!n){e.next=12;break}return e.next=9,this.getAnid();case 9:i._anid=e.sent,e.next=13;break;case 12:i._muid=this.flyoutData.common.muid;case 13:return i.timestamp=(new Date).toString(),this.storageHandler.setStorageString(Bc.ProductTrackingTrackedProducts,JSON.stringify(i)),e.abrupt("return",i.trackedProducts);case 16:case"end":return e.stop()}}),e,this)}))),function(e,t){return E.apply(this,arguments)})},{key:"GetLocalProductTrackingData",value:(A=t(a().mark((function e(){var t,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageHandler.getStorageString(Bc.ProductTrackingTrackedProducts);case 2:if(t=e.sent,e.prev=3,n=JSON.parse(t),!Array.isArray(null==n?void 0:n.trackedProducts)){e.next=7;break}return e.abrupt("return",n);case 7:e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(3),e.abrupt("return",{trackedProducts:[]});case 12:return e.abrupt("return",void 0);case 13:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(){return A.apply(this,arguments)})},{key:"isTrackedProduct",value:(m=t(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.GetTrackedProduct(t);case 2:return e.abrupt("return",!!e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"GetTrackedProduct",value:(S=t(a().mark((function t(n){var r,o,i,s,l,c,u,d,p,h,f;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return",null);case 2:return t.next=4,this.storageHandler.getStorageString(Bc.ProductTrackingUrlProductCache);case 4:if(o=t.sent,i=e.getUrlAndProductToMap(o),!this.AnidTrackingAvailable()){t.next=19;break}return t.next=9,this.getAnid();case 9:return!(s=t.sent)&&i.anid&&(i={},this.storageHandler.setStorageString(Bc.ProductTrackingUrlProductCache,JSON.stringify({muid:this.flyoutData.common.muid}))),t.next=13,this.canUseAnidForRequest(s);case 13:if(t.t0=t.sent,!t.t0){t.next=16;break}t.t0=i.muid;case 16:if(!t.t0){t.next=19;break}i={},this.storageHandler.setStorageString(Bc.ProductTrackingUrlProductCache,JSON.stringify({anid:s}));case 19:if(!(l=null===(r=i)||void 0===r?void 0:r[n])){t.next=22;break}return t.abrupt("return",l);case 22:return t.next=24,this.GetLocalProductTrackingData();case 24:if(c=t.sent,u=!0,null==c||!c.trackedProducts){t.next=48;break}d=Ku(c.trackedProducts),t.prev=28,d.s();case 30:if((p=d.n()).done){t.next=38;break}if(h=p.value,!e.isSameUrl(h.ProductUrl,n)){t.next=34;break}return t.abrupt("return",h);case 34:e.isSameUrlByPathName(h.ProductUrl,n)&&(u=!1);case 36:t.next=30;break;case 38:t.next=43;break;case 40:t.prev=40,t.t1=t.catch(28),d.e(t.t1);case 43:return t.prev=43,d.f(),t.finish(43);case 46:if(!u){t.next=48;break}return t.abrupt("return",null);case 48:return t.next=50,this.GetTrackedProductFromApi(n);case 50:if(!(f=t.sent)){t.next=54;break}return t.next=54,this.addProductToUrlProductsMap(n,f);case 54:return t.abrupt("return",f);case 55:case"end":return t.stop()}}),t,this,[[28,40,43,46]])}))),function(e){return S.apply(this,arguments)})},{key:"checkIsOutOfStock",value:(g=t(a().mark((function t(){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getOutOfStockData();case 2:if(n=t.sent){t.next=5;break}return t.abrupt("return",!1);case 5:if(e.isSameUrlByPathName(null==n?void 0:n.productUrl,this.flyoutData.common.lastCommittedURL)){t.next=9;break}return this.storageHandler.clearStorage(Bc.ProductTrackingOOSData),t.abrupt("return",!1);case 9:return t.abrupt("return",n&&"OUT_OF_STOCK"===(null==n?void 0:n.status));case 10:case"end":return t.stop()}}),t,this)}))),function(){return g.apply(this,arguments)})},{key:"getOutOfStockData",value:(C=t(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageHandler.getStorageString(Bc.ProductTrackingOOSData);case 2:if(!(t=e.sent)){e.next=5;break}return e.abrupt("return",_n(t));case 5:case"end":return e.stop()}}),e,this)}))),function(){return C.apply(this,arguments)})},{key:"sendTrackingData",value:(v=t(a().mark((function e(t,n,r,o,i){var s,l,c,u,d,p;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=this.flyoutData.strings,t){e.next=7;break}return console.log("Product not available, can't track or untrack"),(l=new di(b.ProductTrackingDebug)).Metadata=JSON.stringify({url:this.flyoutData.common.lastCommittedURL,isOutOfStock:r}),this.logModule.LogErrorEvent(y.EdgeFlyoutStatus,"Product unavailable, unable to track or untrack",l),e.abrupt("return");case 7:if(c=new CustomEvent(Lu.ProductTrackingUpdate),!n){e.next=17;break}return e.next=11,this.TrackProduct(t,r,o,i);case 11:return u=e.sent,e.next=14,this.TrackProductLocal(u);case 14:u?(d=r?s.productTrackingStockTrackAlert:s.productTrackingPriceTrackAlert,this.stateManagement.dispatchEvent(Gu({text:d}))):this.stateManagement.dispatchEvent(Gu({text:s.productTrackingTrackFailed})),e.next=25;break;case 17:return e.next=19,this.GetTrackedProduct(t.ProductUrl);case 19:return p=e.sent,this.UntrackProductLocal(p),e.next=23,this.UntrackProduct(t);case 23:e.sent||this.stateManagement.dispatchEvent(Gu({text:s.productTrackingUntrackFailed}));case 25:this.stateManagement.dispatchEvent(c);case 26:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,a){return v.apply(this,arguments)})},{key:"recordTrackingToggleChange",value:function(e,t,n,r,a,o,i){var s=Object.assign({},t,{base64ProductImage:void 0}),l=this.flyoutData.common.openedWith===Oe.Auto,c=JSON.stringify(Wu(Wu({duration:o,priceDropValue:i},s),{},{source:a,isOutOfStock:r,isNotification:l})),u=new Tu(e,this.telemetryUtilities.setContentViewed(a),this.flyoutData.common.domain,c),d="Product ".concat(n?"":"un","tracked from ").concat(a);this.logModule.LogInfoEvent(y.ButtonClick,d,u)}},{key:"setAlertSettingsPrefs",value:function(e,t){bt("ptAlertSettingsPrefs","".concat(e,"-").concat(t))}},{key:"getAlertSettingsPrefs",value:function(){var e=Pt("ptAlertSettingsPrefs"),t={};if(e){var n=Sl(e.split("-",2),2),r=n[0],a=n[1];isNaN(Number(r))||(t.priceDropValue=Number(r)),isNaN(Number(a))||(t.durationValue=Number(a))}return t}},{key:"resetAlertSettingsPrefs",value:function(){kt("ptAlertSettingsPrefs")}},{key:"extractExtractedEntityData",value:function(t,n){var r,a;if(!t)return null;var o=null!==(r=null==t?void 0:t.entity)&&void 0!==r?r:t.product_og_entity,i=(null==o?void 0:o.image)||t.image_url,s=e.GetStrippedTitle((null==o?void 0:o.name)||(null==t?void 0:t.title),this.flyoutData.common.domain),l=(null==o?void 0:o.price_value)||(null==o||null===(a=o["offers/price"])||void 0===a?void 0:a.substring(1));if(l||(l=this.flyoutData.dataLoader.GetLoadTimeDataValue("price",void 0)),s&&(l||n)){var c,u=new Fu(s,i,null!==(c=null==o?void 0:o.price_currency)&&void 0!==c?c:"$");return u.price=l||"",u.ProductUrl=this.flyoutData.common.lastCommittedURL,u}return null}},{key:"ResetOutOfFlowNotificationFrequency",value:function(){var e,t=null===(e=this.flyoutData.dataStoreModule.ProductTrackingNotificationData)||void 0===e?void 0:e.TrackedProducts;t&&t.length>2?this.pageHandlerModule.setShoppingNotificationFrequencyHours(3):this.pageHandlerModule.setShoppingNotificationFrequencyHours(24)}},{key:"getAndCacheAfdMarket",value:function(){var e=this.flyoutData.common.afdMarket;return e?(bt("afdMarket",e),e):Pt("afdMarket")||""}},{key:"canUseAnidForRequest",value:(f=t(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.AnidTrackingAvailable()&&!!t,!e.t0){e.next=5;break}return e.next=4,this.hasUserConsented();case 4:e.t0=e.sent;case 5:return e.abrupt("return",e.t0);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"getAnid",value:(h=t(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.AnidTrackingAvailable()){e.next=2;break}return e.abrupt("return","");case 2:if(this.anid){e.next=7;break}return e.next=5,this.pageHandlerModule.GetEdgeAnid(!0);case 5:t=e.sent.anid,this.anid=null!=t?t:"";case 7:return e.abrupt("return",this.anid);case 8:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"GetLocalProductTrackingDataFromEndpoint",value:(p=t(a().mark((function e(){var t,n,r,o,i,s,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getAnid();case 3:return t=e.sent,n=!1,r=this.flyoutData.common.muid,o="tracked-products?muid=".concat(r,"&trackingSource=5"),e.next=9,this.canUseAnidForRequest(t);case 9:if(!e.sent){e.next=12;break}o="tracked-products?anid=".concat(t,"&trackingSource=5"),n=!0;case 12:return e.next=14,this.createRequest(o,void 0,"GET");case 14:return i=e.sent,(s=new Bu(null==i?void 0:i.productTrackingData))&&this.SetProductTrackingData(s,n),e.abrupt("return",s);case 20:return e.prev=20,e.t0=e.catch(0),console.log("Error getting tracked products",e.t0),l=new di(b.ProductTrackingNetworkError),this.logModule.LogErrorEvent(y.EdgeFlyoutStatus,"Unable to get tracked products ".concat(e.t0),l),e.abrupt("return",new Bu(void 0));case 26:case"end":return e.stop()}}),e,this,[[0,20]])}))),function(){return p.apply(this,arguments)})},{key:"addProductToUrlProductsMap",value:(d=t(a().mark((function t(n,r){var o,i,s;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.storageHandler.getStorageString(Bc.ProductTrackingUrlProductCache);case 2:if(o=t.sent,i=e.getUrlAndProductToMap(o),s=Wu(Wu({},i),{},pe({},n,r)),!this.AnidTrackingAvailable()){t.next=18;break}return t.next=8,this.hasUserConsented();case 8:if(!t.sent){t.next=14;break}return t.next=11,this.getAnid();case 11:t.t0=t.sent,t.next=15;break;case 14:t.t0=void 0;case 15:s.anid=t.t0,t.next=19;break;case 18:s.muid=this.flyoutData.common.muid;case 19:this.storageHandler.setStorageString(Bc.ProductTrackingUrlProductCache,JSON.stringify(s));case 20:case"end":return t.stop()}}),t,this)}))),function(e,t){return d.apply(this,arguments)})},{key:"removeProductFromUrlProductsMap",value:(u=t(a().mark((function t(n){var r,o;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.storageHandler.getStorageString(Bc.ProductTrackingUrlProductCache);case 2:r=t.sent,o=e.getUrlAndProductToMap(r),this.storageHandler.setStorageString(Bc.ProductTrackingUrlProductCache,JSON.stringify(Wu(Wu({},o),{},pe({},n,void 0))));case 5:case"end":return t.stop()}}),t,this)}))),function(e){return u.apply(this,arguments)})},{key:"createRequest",value:(l=t(a().mark((function e(t,n){var r,o,i,s,l,c=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>2&&void 0!==c[2]?c[2]:"POST",o=c.length>3?c[3]:void 0,i=this.flyoutData.dataLoader.GetLoadTimeDataValue("enabledservicefeatures",{}),s=this.flyoutData.dataLoader.GetLoadTimeDataValue("enabledservicefeaturesv2",{}),e.next=6,fetch("".concat(this.dealsEndpoint,"/product-tracking/").concat(t),{body:JSON.stringify(n),headers:{"Content-Type":"application/json",Source:"ProductTracking",Service:null!=o?o:"Extension/UX",EnabledServiceFeatures:JSON.stringify(i),EnabledServiceFeaturesv2:JSON.stringify(s)},method:r});case 6:return l=e.sent,e.next=9,l.json();case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"createUntrackProductBody",value:(s=t(a().mark((function e(t,n){var r,o,i,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={Currency:null!==(r=t.currency)&&void 0!==r?r:t.CurrencySymbol,Domain:n.domain,Market:null!==(o=n.market)&&void 0!==o?o:n.afdMarket,Muid:n.muid,Url:t.ProductUrl},e.next=3,this.getAnid();case 3:return s=e.sent,e.next=6,this.canUseAnidForRequest(s);case 6:if(!e.sent){e.next=10;break}return e.next=9,this.getAnid();case 9:i.Anid=e.sent;case 10:return e.abrupt("return",i);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"createTrackProductBody",value:(i=t(a().mark((function t(n,r,o,i,s){var l,c,u,d,p,h,f;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return p={Currency:n.currency||"$",Domain:r.domain,ImageUrl:n.imageUrl,Market:null!==(l=r.market)&&void 0!==l?l:r.afdMarket,Muid:r.muid,ProductStockStatus:o?2:1,TrackingType:o?"OutOfStock":"PriceDrop",Title:e.GetStrippedTitle(n.title,r.domain),Url:e.GetStrippedUrl(null!==(c=n.ProductUrl)&&void 0!==c?c:r.lastCommittedURL)},t.next=3,this.getAnid();case 3:return h=t.sent,t.next=6,this.canUseAnidForRequest(h);case 6:if(!t.sent){t.next=9;break}p.Anid=h,p.Muid=r.muid;case 9:return f=jt(null!==(u=null==n||null===(d=n.price)||void 0===d?void 0:d.toString())&&void 0!==u?u:""),Number.isNaN(f)||(p.Price=f),i&&(p.DurationInWeeks=i),s&&!o&&(p.DropPercentage=s),t.abrupt("return",p);case 14:case"end":return t.stop()}}),t,this)}))),function(e,t,n,r,a){return i.apply(this,arguments)})},{key:"isStaleTrackedProducts",value:(r=t(a().mark((function e(t){var n,r,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",!0);case 2:return n=t.timestamp,e.next=5,this.hasUserConsented();case 5:if((r=e.sent)||!t._anid){e.next=10;break}return e.abrupt("return",!0);case 10:if(!r||!t._muid){e.next=12;break}return e.abrupt("return",!0);case 12:if(n){e.next=14;break}return e.abrupt("return",!0);case 14:return e.prev=14,o=new Date(n),e.abrupt("return",Date.now()-+o>this.trackedProductsCachePeriod);case 19:return e.prev=19,e.t0=e.catch(14),e.abrupt("return",!0);case 22:case"end":return e.stop()}}),e,this,[[14,19]])}))),function(e){return r.apply(this,arguments)})},{key:"isStaleAnidTrackingData",value:function(e){if(!e)return!0;var t=e.timestamp;if(!t)return!0;try{var n=new Date(+t);return Date.now()-+n>this.anidTrackingDataCachePeriod}catch(e){return!0}}}],[{key:"showedOOSNotifcationRecently",value:function(){try{return Date.now()-+new Date(Gc.ProductTrackingOOSLastShown)<9e5}catch(e){return!1}}},{key:"getDomainFromUrl",value:function(e){if(!e)return"";e=e.startsWith("http")?e:"https://".concat(e);try{var t=new URL(e).hostname.split("."),n=t.length<3?t[0]:t[1];return"".concat(n[0].toUpperCase()).concat(n.substring(1))}catch(t){return e}}},{key:"GetStrippedTitle",value:function(e,t){var n=new RegExp("[\\s\\W]*".concat(t,"[\\s\\W]*"),"gi");return null==e?void 0:e.replace(n,"")}},{key:"GetStrippedUrl",value:function(t){var n;return"amazon"===(null===(n=e.getDomainFromUrl(t))||void 0===n?void 0:n.toLocaleLowerCase())?t.replace(/\/ref=[A-z0-9_]+/,""):t}},{key:"isSameUrl",value:function(t,n){return(t=e.GetStrippedUrl(t))===(n=e.GetStrippedUrl(n))}},{key:"isSameUrlByPathName",value:function(t,n){if(e.isSameUrl(t,n))return!0;try{var r=new URL(e.GetStrippedUrl(t.toLowerCase())),a=new URL(e.GetStrippedUrl(n.toLowerCase()));return r.origin===a.origin&&r.pathname===a.pathname}catch(e){return!1}}},{key:"IsSameProduct",value:function(e,t){var n,r;if(!e||!t)return!1;var a=null!==(n=null==e?void 0:e.ProductId)&&void 0!==n?n:null==e?void 0:e.productId,o=null!==(r=null==t?void 0:t.ProductId)&&void 0!==r?r:null==t?void 0:t.productId;if(e&&a===o)try{var i,s,l=new URL(null!==(i=e.ProductUrl)&&void 0!==i?i:e.productUrl);return new URL(null!==(s=t.ProductUrl)&&void 0!==s?s:t.productUrl).hostname===l.hostname}catch(e){console.log("Error comparing products")}return!1}},{key:"isSupportedDomainAOC",value:function(e,t,n){var r,a,o=null!==(r=null==t?void 0:t.toLocaleLowerCase())&&void 0!==r?r:"",i=La.isExperimentActive(ka.productTracking)||"en-us"===o,s=e.toLocaleLowerCase().includes("amazon.")&&zu.includes(null!==(a=null==n?void 0:n.toLowerCase())&&void 0!==a?a:""),l=zu.includes(o);return i||s&&l}},{key:"IsTrackedProductForAOC",value:(n=t(a().mark((function t(n){var r,o,i,s,l,c,u,d,p,h,f,v,C;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=null===(r=e.getUrlAndProductToMap(Gc.UrlToProductMap))||void 0===r?void 0:r[n],l=[],c=_n(null!==(o=Gc.TrackedProductsData)&&void 0!==o?o:"{}"),l=null!==(i=null==c?void 0:c.trackedProducts)&&void 0!==i?i:[],!s){t.next=6;break}return t.abrupt("return",null===(u=l)||void 0===u?void 0:u.find((function(t){return e.IsSameProduct(t,s)})));case 6:if(!l){t.next=29;break}d=!0,p=Ku(l),t.prev=9,p.s();case 11:if((h=p.n()).done){t.next=19;break}if(f=h.value,!e.isSameUrl(f.ProductUrl,n)){t.next=15;break}return t.abrupt("return",f);case 15:e.isSameUrlByPathName(f.ProductUrl,n)&&(d=!1);case 17:t.next=11;break;case 19:t.next=24;break;case 21:t.prev=21,t.t0=t.catch(9),p.e(t.t0);case 24:return t.prev=24,p.f(),t.finish(24);case 27:if(!d){t.next=29;break}return t.abrupt("return",void 0);case 29:return t.prev=29,t.next=32,fetch("https://www.bing.com/api/shopping/v1/savings/product-tracking/is-tracked",{headers:{Source:"ProductTracking",Service:"Extension/UX"}}).then((function(e){return e.json()}));case 32:return C=t.sent,t.abrupt("return",null!==(v=null==C?void 0:C.product)&&void 0!==v?v:void 0);case 36:t.prev=36,t.t1=t.catch(29),console.log("Error getting tracked product");case 39:return t.abrupt("return",void 0);case 40:case"end":return t.stop()}}),t,null,[[9,21,24,27],[29,36]])}))),function(e){return n.apply(this,arguments)})},{key:"ProductWithPriceDropAndNoNotification",value:function(e){var t=this;if(null!=e&&e.length)return e.find((function(e){return e&&!e.notificationEnabled&&e.basePrice&&e.CurrentPrice&&e.CurrentPrice<e.basePrice&&!t.productExpired(e)}))}},{key:"productExpired",value:function(e){var t,n,r=new Date,a=new Date(null!==(t=e.expirationDate)&&void 0!==t?t:"");return"Invalid Date"===a.toString()||(null!==(n=e.expirationDate)&&void 0!==n&&n.endsWith("Z")||a.setMinutes(a.getMinutes()-r.getTimezoneOffset()),+a<+r)}},{key:"getUrlAndProductToMap",value:function(e){if(!e)return{};var t={};return(t=_n(e))||(t={}),t}}]),e}(),Ju=ju,Xu=c((function e(t){o(this,e),pe(this,"userPersonalizationInfo",void 0),t.userPersonalizationInfo&&(this.userPersonalizationInfo=t.userPersonalizationInfo),console.log(":::RuleBased controller data - userPersonalizationInfo",this.userPersonalizationInfo)}));function Qu(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Zu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Zu(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function Zu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function qu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return h(this,n)}}var $u=function(e){d(n,e);var t=qu(n);function n(e){var r;if(o(this,n),pe(p(r=t.call(this,e)),"coupons",void 0),r.coupons=[],e.coupons){var a,i=Qu(e.coupons);try{for(i.s();!(a=i.n()).done;){var s=a.value;r.coupons.push(s)}}catch(e){i.e(e)}finally{i.f()}}return console.log(":::RuleBased controller data - coupons",r.coupons),r}return c(n)}(Xu);function ed(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return td(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return td(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function td(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function nd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return h(this,n)}}var rd=function(e){d(n,e);var t=nd(n);function n(e){var r,a,i,s;if(o(this,n),pe(p(s=t.call(this,e)),"competingPrices",void 0),pe(p(s),"price",void 0),s.competingPrices=[],(null==e||null===(r=e.comparableOffers)||void 0===r||null===(a=r.apiPriceData)||void 0===a||null===(i=a.value)||void 0===i?void 0:i.length)>0){var l,c=ed(e.comparableOffers.apiPriceData.value);try{for(c.s();!(l=c.n()).done;){var u=l.value;s.competingPrices.push(u)}}catch(e){c.e(e)}finally{c.f()}}return null!=e&&e.price&&(s.price=e.price),console.log(":::RuleBased controller data - competingPrices",s.competingPrices),console.log(":::RuleBased controller data - price",s.price),s}return c(n)}(Xu);function ad(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return h(this,n)}}var od=function(e){d(n,e);var t=ad(n);function n(e){var r,a,i;return o(this,n),pe(p(i=t.call(this,e)),"priceDrop",void 0),null!=e&&null!==(r=e.priceHistory)&&void 0!==r&&null!==(a=r.priceHistoryData)&&void 0!==a&&a.dailyPriceDropPercentage&&(i.priceDrop=e.priceHistory.priceHistoryData.dailyPriceDropPercentage/100),console.log(":::RuleBased controller data - priceDrop",i.priceDrop),i}return c(n)}(Xu),id=c((function e(){o(this,e)}));pe(id,"ruleBasedTriggerDataKey","RuleBasedTriggerData"),pe(id,"defaultCouponExpectationWeight",2),pe(id,"positiveEngagementWeight",3),pe(id,"isSpiritedShopperWeight",1),pe(id,"mlWeight",3),pe(id,"defaultPriceDropWeight",2),pe(id,"defaultBestCompetingPriceWeight",2),pe(id,"scoreThreshold",.4),pe(id,"noPreviousUserDataAutoOpenRate",.6),pe(id,"noPreviousUserDataAlwaysOpenCouponExpectation",.5),pe(id,"noPreviousUserDataAlwaysOpenCouponExpectationV0",.2),pe(id,"noPreviousUserDataAlwaysOpenPriceDrop",.2),pe(id,"noPreviousUserDataAlwaysOpenBestCompetingPrice",.2),pe(id,"mlFirstHighConfidenceRange",.3),pe(id,"mlSecondHighConfidenceRange",.7),pe(id,"minEngagementCount",4),pe(id,"minEngagementCountV1",2),pe(id,"engagementScoreThreshold",.5),pe(id,"flyoutReintroduceDays",1);var sd=c((function e(){o(this,e),pe(this,"mlCouponAutoApplyPopUpProbability",void 0),pe(this,"mlCashbackProbability",void 0),pe(this,"mlPhProbability",void 0),pe(this,"scoreThreshold",void 0),pe(this,"normalizedScore",void 0),pe(this,"positiveEngagementScore",void 0),pe(this,"totalEngagementsCount",void 0),pe(this,"couponExpectation",void 0),pe(this,"priceDrop",void 0),pe(this,"bestCompetingPrice",void 0),pe(this,"isSpiritedShopper",void 0),pe(this,"noPreviousEngagements",void 0),pe(this,"isMLUsed",void 0),pe(this,"noPreviousUserDataAutoOpenRate",void 0),pe(this,"noPreviousUserDataAlwaysOpenCouponExpectation",void 0),pe(this,"minEngagementCount",void 0),pe(this,"message",void 0)})),ld=c((function e(t,n,r){o(this,e),pe(this,"userEngagementResults",void 0),pe(this,"couponExpectationWeight",void 0),pe(this,"firstTimeAutoOpenDisabled",void 0),pe(this,"flyoutReintroduceDays",id.flyoutReintroduceDays),pe(this,"flyoutReintroduceIsForced",!1),pe(this,"notificationTracker",void 0),this.userEngagementResults=t,this.couponExpectationWeight=null!=n?n:id.defaultCouponExpectationWeight,this.firstTimeAutoOpenDisabled=r})),cd=function(){function e(t,n,r,a,i,s,l){var c;if(o(this,e),pe(this,"popupOrigination",void 0),pe(this,"ruleBasedTriggerMap",new Map),pe(this,"isSpiritedShopper",void 0),pe(this,"mlPopUpProbability",void 0),pe(this,"personalizationAutoOpenTelemetryData",void 0),pe(this,"sendErrorMessage",void 0),pe(this,"sendStorageMessage",void 0),pe(this,"variant",void 0),pe(this,"impressionId",void 0),this.popupOrigination=t,this.sendErrorMessage=n,this.sendStorageMessage=r,this.impressionId=a,this.variant=l,this.personalizationAutoOpenTelemetryData=new sd,this.personalizationAutoOpenTelemetryData.minEngagementCount=id.minEngagementCount,this.personalizationAutoOpenTelemetryData.noPreviousUserDataAutoOpenRate=id.noPreviousUserDataAutoOpenRate,this.personalizationAutoOpenTelemetryData.noPreviousUserDataAlwaysOpenCouponExpectation=id.noPreviousUserDataAlwaysOpenCouponExpectation,this.personalizationAutoOpenTelemetryData.message="",s){console.log("ruleBasedTriggerMapStr: ".concat(s));try{this.ruleBasedTriggerMap=JSON.parse(JSON.parse(s),Wt.ParseMap)}catch(e){this.sendErrorMessage(this.impressionId,"Cannot parse Rule Based Trigger Map: ".concat(e,". ruleBasedTriggerMapStr = ").concat(s))}}this.isSpiritedShopper=null==i||null===(c=i.userPersonalizationInfo)||void 0===c?void 0:c.isSpiritedShopper,this.personalizationAutoOpenTelemetryData.isSpiritedShopper=this.isSpiritedShopper?1:0}return c(e,[{key:"canAutoOpen",value:function(){try{var e=this.canAutoOpenWithPersonalization();if(!e&&this.shouldReintroduceFlyout()){var t;this.personalizationAutoOpenTelemetryData.message+=" - ReintroduceFlyout";var n=null===(t=this.ruleBasedTriggerMap)||void 0===t?void 0:t.get(this.popupOrigination.toString());n||(n=new ld),n.flyoutReintroduceIsForced=!0,this.ruleBasedTriggerMap.set(this.popupOrigination.toString(),n);var r=JSON.stringify({value:JSON.stringify(JSON.stringify(this.ruleBasedTriggerMap,Wt.StringifyMap))});this.sendStorageMessage(id.ruleBasedTriggerDataKey,r),e=!0}return this.storeFirstTimeAutoOpenDisabled(e),e}catch(e){return this.sendErrorMessage(this.impressionId,"Couldn't check auto open ".concat(e)),!0}}},{key:"getPersonalizationAutoOpenTelemetryData",value:function(){return this.personalizationAutoOpenTelemetryData}},{key:"noPreviousEngagements",value:function(e){var t,n,r=null!==(t=null==e?void 0:e.positiveEngagementScore)&&void 0!==t?t:-1,a=null!==(n=null==e?void 0:e.totalEngagementsCount)&&void 0!==n?n:0,o=void 0!==this.variant?id.minEngagementCountV1:id.minEngagementCount;return-1===r||a<o}},{key:"canAutoOpenBasedOnFeatures",value:function(e){var t=this.getNormalizedScore(e);return t>id.scoreThreshold||this.canAutoOpenWithRate(t)}},{key:"shouldUseML",value:function(){return void 0!==this.mlPopUpProbability&&(this.mlPopUpProbability>id.mlSecondHighConfidenceRange||this.mlPopUpProbability<id.mlFirstHighConfidenceRange)}},{key:"getRuleBasedTriggerFeaturesWithML",value:function(){return[{feature:this.mlPopUpProbability,name:"MLOutput",weight:id.mlWeight}]}},{key:"canAutoOpenUsingRuleBased",value:function(e,t){return this.canAutoOpenBasedOnFeatures([{feature:t,name:"positiveEngagementScore",weight:id.positiveEngagementWeight}])}},{key:"canAutoOpenWithRate",value:function(e){var t=Math.random(),n="Random: ".concat(t,"  Open probability: ").concat(e);return console.log(n),this.personalizationAutoOpenTelemetryData.message+=" - ".concat(n),t<e}},{key:"getNormalizedScore",value:function(e){var t=0,n=0,r=[];e.forEach((function(e){void 0!==e.feature&&(t+=e.feature*e.weight,n+=e.weight,r.push("".concat(e.name,"(").concat(e.feature,") * ").concat(e.weight)))}));var a=t/n,o="score = ".concat(r.join(" + ")," = ").concat(t," => normalizedScore: ").concat(a," [scoreThreshold: ").concat(id.scoreThreshold,"]");return console.log(o),this.personalizationAutoOpenTelemetryData.message+=" - ".concat(o),this.personalizationAutoOpenTelemetryData.normalizedScore=a,this.personalizationAutoOpenTelemetryData.scoreThreshold=id.scoreThreshold,a}},{key:"canAutoOpenWithPersonalization",value:function(){var e,t,n,r=null===(e=this.ruleBasedTriggerMap)||void 0===e||null===(t=e.get(this.popupOrigination.toString()))||void 0===t?void 0:t.userEngagementResults,a=null==r?void 0:r.positiveEngagementScore,o=this.noPreviousEngagements(r);if(this.personalizationAutoOpenTelemetryData.noPreviousEngagements=o,this.personalizationAutoOpenTelemetryData.positiveEngagementScore=null!=a?a:null,this.personalizationAutoOpenTelemetryData.totalEngagementsCount=null!==(n=null==r?void 0:r.totalEngagementsCount)&&void 0!==n?n:0,this.personalizationAutoOpenTelemetryData.message+="PopupOrigination: ".concat(this.popupOrigination," - No previous client-side engagements: ").concat(o),this.variant===Qs.ML){var i=this.shouldUseML();if(this.personalizationAutoOpenTelemetryData.isMLUsed=i,this.personalizationAutoOpenTelemetryData.message+=" - shouldUseML: ".concat(i),console.log(this.personalizationAutoOpenTelemetryData.message),i)return this.canAutoOpenBasedOnFeatures(this.getRuleBasedTriggerFeaturesWithML())}return this.variant!==Qs.RuleBased||this.canAutoOpenUsingRuleBased(o,a)}},{key:"storeFirstTimeAutoOpenDisabled",value:function(e){var t,n,r=null===(t=this.ruleBasedTriggerMap)||void 0===t?void 0:t.get(this.popupOrigination.toString()),a=null===(n=r)||void 0===n?void 0:n.firstTimeAutoOpenDisabled;e&&(a=void 0),e||void 0!==a||(a=new Date),r||(r=new ld),r.firstTimeAutoOpenDisabled=a,this.ruleBasedTriggerMap.set(this.popupOrigination.toString(),r);var o=JSON.stringify({value:JSON.stringify(JSON.stringify(this.ruleBasedTriggerMap,Wt.StringifyMap))});this.sendStorageMessage(id.ruleBasedTriggerDataKey,o)}},{key:"shouldReintroduceFlyout",value:function(){var e,t,n=null===(e=this.ruleBasedTriggerMap)||void 0===e?void 0:e.get(this.popupOrigination.toString()),r=null==n?void 0:n.firstTimeAutoOpenDisabled,a=null!==(t=null==n?void 0:n.flyoutReintroduceDays)&&void 0!==t?t:id.flyoutReintroduceDays;if(console.log("firstTimeAutoOpenDisabled: "+r),r){var o=(new Date).getTime()-new Date(r).getTime(),i=o/864e5,s="TimeDiff: ".concat(o," - TimeDiffInDays: ").concat(i);return console.log(s),i>=a}return!1}}]),e}(),ud=cd;function dd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return h(this,n)}}var pd=function(e){d(n,e);var t=dd(n);function n(e,r,a,i,s,l,c){var u,d,h,f,v;return o(this,n),pe(p(v=t.call(this,e,r,a,i,s,l,c)),"couponExpectation",void 0),v.mlPopUpProbability=null==s||null===(u=s.userPersonalizationInfo)||void 0===u?void 0:u.mlCouponAutoApplyPopUpProbability,v.personalizationAutoOpenTelemetryData.mlCouponAutoApplyPopUpProbability=null!==(d=v.mlPopUpProbability)&&void 0!==d?d:null,v.couponExpectation=v.calculateCouponExpectation(null!==(h=s.coupons)&&void 0!==h?h:[]),v.personalizationAutoOpenTelemetryData.couponExpectation=null!==(f=v.couponExpectation)&&void 0!==f?f:null,v}return c(n,[{key:"canAutoOpenUsingRuleBased",value:function(e,t){if(console.log("CouponRuleBasedTriggerController decides whether to auto open or not."),e||void 0===t)return!0;if(t>=id.engagementScoreThreshold){var n="".concat(this.variant,": open because engagement score is high enough");return console.log(n),this.personalizationAutoOpenTelemetryData.message+=" - ".concat(n),!0}var r="".concat(this.variant,": open with ").concat(t," rate because engagement score is not high enough.");return console.log(r),this.personalizationAutoOpenTelemetryData.message+=" - ".concat(r),this.canAutoOpenWithRate(t)}},{key:"calculateCouponExpectation",value:function(e){var t=this.getCouponSuccessRates(e);return console.log("successRates: ".concat(t)),this.getExpectation(t)}},{key:"getCouponSuccessRates",value:function(e){return e&&e.length>0?(console.log("Coupon Count = ".concat(e.length)),e.filter((function(e){return void 0!==e.successRate})).map((function(e){return e.successRate}))):(console.log("Coupon Count = 0"),[])}},{key:"getExpectation",value:function(e){if(e&&0!==e.length)return Math.max.apply(null,e)/100}},{key:"getCouponExpectationWeight",value:function(){var e,t,n;return null!==(e=null===(t=this.ruleBasedTriggerMap)||void 0===t||null===(n=t.get(this.popupOrigination.toString()))||void 0===n?void 0:n.couponExpectationWeight)&&void 0!==e?e:id.defaultCouponExpectationWeight}},{key:"getRuleBasedTriggerFeaturesWithML",value:function(){var e=this.getCouponExpectationWeight();return[{feature:this.mlPopUpProbability,name:"MLOutput",weight:id.mlWeight},{feature:this.couponExpectation,name:"couponExpectation",weight:e}]}}]),n}(ud),hd=pd;function fd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return h(this,n)}}var vd=function(e){d(n,e);var t=fd(n);function n(e,r,a,i,s,l,c){var u,d,p;return o(this,n),(p=t.call(this,e,r,a,i,s,l,c)).mlPopUpProbability=null==s||null===(u=s.userPersonalizationInfo)||void 0===u?void 0:u.mlCashbackProbability,p.personalizationAutoOpenTelemetryData.mlCashbackProbability=null!==(d=p.mlPopUpProbability)&&void 0!==d?d:null,p}return c(n,[{key:"canAutoOpen",value:function(){console.log("Cashback ML",this.mlPopUpProbability);var e=.6,t="";if(this.variant===qs.Micro){if(this.mlPopUpProbability&&this.mlPopUpProbability<=e)return t="Cashback ML Micro: can't open normal notification because ML probability <= ".concat(e),console.log(t),this.personalizationAutoOpenTelemetryData.message+=" - ".concat(t),!1}else if(this.mlPopUpProbability&&this.mlPopUpProbability<=e){var n,r=this.getMaxNotificationCountPerMin(),a=this.getMaxNotificationCountPerHour(),o=this.getMaxNotificationCountPerDay(),i=null===(n=this.ruleBasedTriggerMap)||void 0===n?void 0:n.get(this.popupOrigination.toString());if(!i)return!0;var s=null==i?void 0:i.notificationTracker;if(!s)return!0;var l=new Date;return(l.getTime()-new Date(s.perMinFirstTriggered).getTime())/6e4<1&&s.perMinCount>=r?(t="Cashback ML Limit: can't open normal notification because ML probability <= ".concat(e," and notification count exceeds the limit ").concat(r," per min"),console.log(t),this.personalizationAutoOpenTelemetryData.message+=" - ".concat(t),!1):(l.getTime()-new Date(s.perHourFirstTriggered).getTime())/36e5<1&&s.perHourCount>=a?(t="Cashback ML Limit: can't open normal notification because ML probability <= ".concat(e," and notification count exceeds the limit ").concat(a," per hour"),console.log(t),this.personalizationAutoOpenTelemetryData.message+=" - ".concat(t),!1):!((l.getTime()-new Date(s.perDayFirstTriggered).getTime())/864e5<1&&s.perDayCount>=o)||(t="Cashback ML Limit: can't open normal notification because ML probability <= ".concat(e," and notification count exceeds the limit ").concat(o," per day"),console.log(t),this.personalizationAutoOpenTelemetryData.message+=" - ".concat(t),!1)}return!0}},{key:"getMaxNotificationCountPerMin",value:function(){return this.mlPopUpProbability&&this.mlPopUpProbability<=.2||this.mlPopUpProbability&&this.mlPopUpProbability<=.3||this.mlPopUpProbability&&this.mlPopUpProbability,1}},{key:"getMaxNotificationCountPerHour",value:function(){return this.mlPopUpProbability&&this.mlPopUpProbability<=.2?1:this.mlPopUpProbability&&this.mlPopUpProbability<=.3?2:this.mlPopUpProbability&&this.mlPopUpProbability<=.6?3:4}},{key:"getMaxNotificationCountPerDay",value:function(){return this.mlPopUpProbability&&this.mlPopUpProbability<=.2?2:this.mlPopUpProbability&&this.mlPopUpProbability<=.3?4:this.mlPopUpProbability&&this.mlPopUpProbability<=.6?6:8}}]),n}(ud),Cd=vd;function gd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return h(this,n)}}var Sd=function(e){d(n,e);var t=gd(n);function n(e,r,a,i,s,l,c){var u,d;return o(this,n),pe(p(d=t.call(this,e,r,a,i,s,l,c)),"bestCompetingPrice",void 0),pe(p(d),"price",void 0),d.bestCompetingPrice=d.getBestCompetingPrice(s),d.price=s.price,d.personalizationAutoOpenTelemetryData.bestCompetingPrice=null!==(u=d.bestCompetingPrice)&&void 0!==u?u:null,d}return c(n,[{key:"canAutoOpenUsingRuleBased",value:function(e,t){return console.log("bestCompetingPrice: ".concat(this.bestCompetingPrice)),e||void 0===t?this.bestCompetingPrice&&this.price&&this.bestCompetingPrice/this.price>id.noPreviousUserDataAlwaysOpenBestCompetingPrice||this.isSpiritedShopper?(console.log("Rule based: can open because price drop > ".concat(id.noPreviousUserDataAlwaysOpenBestCompetingPrice," OR the user is spirited shopper.")),!0):this.canAutoOpenWithRate(id.noPreviousUserDataAutoOpenRate):this.canAutoOpenBasedOnFeatures([{feature:t,name:"positiveEngagementScore",weight:id.positiveEngagementWeight},{feature:this.bestCompetingPrice,name:"couponExpectation",weight:id.defaultBestCompetingPriceWeight}])}},{key:"getBestCompetingPrice",value:function(e){return Math.min.apply(null,e.competingPrices)}},{key:"getRuleBasedTriggerFeaturesWithML",value:function(){return[{feature:this.mlPopUpProbability,name:"MLOutput",weight:id.mlWeight},{feature:this.bestCompetingPrice,name:"bestCompetingPrice",weight:id.defaultBestCompetingPriceWeight}]}}]),n}(ud),md=Sd;function Ad(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return h(this,n)}}var Ed,yd,Id,Td=function(e){d(n,e);var t=Ad(n);function n(e,r,a,i,s,l,c){var u,d,h,f;return o(this,n),pe(p(f=t.call(this,e,r,a,i,s,l,c)),"priceDrop",void 0),f.mlPopUpProbability=null==s||null===(u=s.userPersonalizationInfo)||void 0===u?void 0:u.mlPhProbability,f.personalizationAutoOpenTelemetryData.mlPhProbability=null!==(d=f.mlPopUpProbability)&&void 0!==d?d:null,f.priceDrop=f.getPriceDrop(s),f.personalizationAutoOpenTelemetryData.priceDrop=null!==(h=f.priceDrop)&&void 0!==h?h:null,f}return c(n,[{key:"canAutoOpen",value:function(){console.log("PH ML",this.mlPopUpProbability);var e=.5,t="";if(this.variant===Zs.Micro){if(this.mlPopUpProbability&&this.mlPopUpProbability<=e)return t="PH ML Micro: can't open normal notification because ml probability <= ".concat(e),console.log(t),this.personalizationAutoOpenTelemetryData.message+=" - ".concat(t),!1}else if(this.mlPopUpProbability&&this.mlPopUpProbability<=e){var n,r=this.getMaxNotificationCountPerMin(),a=this.getMaxNotificationCountPerHour(),o=this.getMaxNotificationCountPerDay(),i=null===(n=this.ruleBasedTriggerMap)||void 0===n?void 0:n.get(this.popupOrigination.toString());if(!i)return!0;var s=null==i?void 0:i.notificationTracker;if(!s)return!0;var l=new Date;return(l.getTime()-new Date(s.perMinFirstTriggered).getTime())/6e4<1&&s.perMinCount>=r?(t="PH ML Limit: can't open normal notification because ml probability <= ".concat(e," and notification count exceeds the limit ").concat(r," per min"),console.log(t),this.personalizationAutoOpenTelemetryData.message+=" - ".concat(t),!1):(l.getTime()-new Date(s.perHourFirstTriggered).getTime())/36e5<1&&s.perHourCount>=a?(t="PH ML Limit: can't open normal notification because ml probability <= ".concat(e," and notification count exceeds the limit ").concat(a," per hour"),console.log(t),this.personalizationAutoOpenTelemetryData.message+=" - ".concat(t),!1):!((l.getTime()-new Date(s.perDayFirstTriggered).getTime())/864e5<1&&s.perDayCount>=o)||(t="PH ML Limit: can't open normal notification because ml probability <= ".concat(e," and notification count exceeds the limit ").concat(o," per day"),console.log(t),this.personalizationAutoOpenTelemetryData.message+=" - ".concat(t),!1)}return!0}},{key:"canAutoOpenUsingRuleBased",value:function(e,t){return console.log("priceDrop: ".concat(this.priceDrop)),e||void 0===t?this.priceDrop&&this.priceDrop>id.noPreviousUserDataAlwaysOpenPriceDrop||this.isSpiritedShopper?(console.log("Rule based: can open because price drop > ".concat(id.noPreviousUserDataAlwaysOpenPriceDrop," OR the user is spirited shopper.")),!0):this.canAutoOpenWithRate(id.noPreviousUserDataAutoOpenRate):this.canAutoOpenBasedOnFeatures([{feature:t,name:"positiveEngagementScore",weight:id.positiveEngagementWeight},{feature:this.priceDrop,name:"priceDrop",weight:id.defaultPriceDropWeight}])}},{key:"getPriceDrop",value:function(e){return e.priceDrop}},{key:"getRuleBasedTriggerFeaturesWithML",value:function(){return[{feature:this.mlPopUpProbability,name:"MLOutput",weight:id.mlWeight},{feature:this.priceDrop,name:"priceDrop",weight:id.defaultPriceDropWeight}]}},{key:"getMaxNotificationCountPerMin",value:function(){return this.mlPopUpProbability&&this.mlPopUpProbability<=.2||this.mlPopUpProbability&&this.mlPopUpProbability<=.3||this.mlPopUpProbability&&this.mlPopUpProbability,1}},{key:"getMaxNotificationCountPerHour",value:function(){return this.mlPopUpProbability&&this.mlPopUpProbability<=.2?1:this.mlPopUpProbability&&this.mlPopUpProbability<=.3?2:this.mlPopUpProbability&&this.mlPopUpProbability<=.5?3:4}},{key:"getMaxNotificationCountPerDay",value:function(){return this.mlPopUpProbability&&this.mlPopUpProbability<=.2?2:this.mlPopUpProbability&&this.mlPopUpProbability<=.3?4:this.mlPopUpProbability&&this.mlPopUpProbability<=.5?6:8}}]),n}(ud),Od=Td,Pd=function(){function e(){o(this,e)}return c(e,null,[{key:"getRuleBasedTriggerController",value:function(e,t,n,r,a){var o,i,s=Fc.getApiResponse();switch(e){case Ro.AUTO_SHOW_COUPONS_CHECKOUT:i=new $u(s),o=new hd(e,t,n,r,i,a,La.getServiceExperimentValue(ka.CouponsPersonalization));break;case Ro.AUTO_SHOW_PRICE_HISTORY:i=new od(s),o=new Od(e,t,n,r,i,a,La.getServiceExperimentValue(ka.PhPersonalization));break;case Ro.AUTO_SHOW_REBATES_ORGANIC:i=new Xu(s),o=new Cd(e,t,n,r,i,a,La.getServiceExperimentValue(ka.CashbackPersonalization));break;case Ro.AUTO_SHOW_LOWER_PRICE_FOUND:i=new rd(s),o=new md(e,t,n,r,i,a,void 0);break;default:i=new Xu(s),o=new ud(e,t,n,r,i,a,void 0)}return o}}]),e}(),kd=Pd;!function(e){e.VIEW_PRODUCT_SUMMARY_CARD="VIEW_PRODUCT_SUMMARY_CARD",e.PRODUCT_SUMMARY_CARD_SAVE_WL="PRODUCT_SUMMARY_CARD_SAVE_WL",e.PRODUCT_SUMMARY_CARD_UNSAVE_WL="PRODUCT_SUMMARY_CARD_UNSAVE_WL",e.COUPONS_COPIED="COUPONS_COPIED",e.NAVIGATE_TO_RETAILER="NAVIGATE_TO_RETAILER",e.TRY_ALL_COUPONS="TRY_ALL_COUPONS",e.SHOW_MORE_SELLERS="SHOW_MORE_SELLERS",e.REBATES_LEARN_MORE="REBATES_LEARN_MORE",e.REBATES_VIEW_IN_PANE="REBATES_VIEW_IN_PANE",e.REBATES_ACCOUNT="REBATES_ACCOUNT",e.REBATES_HISTORY="REBATES_HISTORY",e.ACTIVATE_CASHBACK="ACTIVATE_CASHBACK",e.EXPAND_GRAPH="EXPAND_GRAPH",e.VIEW_PRICE_HISTORY="VIEW_PRICE_HISTORY",e.COUPONS_COPIED_AUTOFILL="COUPONS_COPIED_AUTOFILL",e.TRY_ALL_COUPONS_AUTOFILL="TRY_ALL_COUPONS_AUTOFILL",e.NAVIGATE_TO_DEAL_OFFER="NAVIGATE_TO_DEAL_OFFER",e.NAVIGATE_TO_PROFESSIONAL_REVIEW="NAVIGATE_TO_PROFESSIONAL_REVIEW",e.NAVIGATE_TO_VIDEO_REVIEW="NAVIGATE_TO_VIDEO_REVIEW",e.EXPRESS_CHECKOUT="EXPRESS_CHECKOUT",e.OPEN_FLYOUT="OPEN_FLYOUT",e.OPEN_PANE_FROM_FLYOUT="OPEN_PANE_FROM_FLYOUT",e.NAVIGATE_TO_RECOMMENDATION_OFFER="NAVIGATE_TO_RECOMMENDATION_OFFER",e.CLIP_COUPON="CLIP_COUPON",e.ACTIVATE_CASHBACK_NEW="ACTIVATE_CASHBACK_NEW",e.PRODUCT_HISTORY_NAVIGATION="PRODUCT_HISTORY_NAVIGATION",e.NAVIGATE_TO_OTHER_SELLER="NAVIGATE_TO_OTHER_SELLER",e.TIPS_CLICK="TIPS_CLICK",e.REWARDS_SIGNIN_CLICK="REWARDS_SIGNIN_CLICK",e.REWARDS_REDEEM_CLICK="REWARDS_REDEEM_CLICK",e.CASHBACK_OTHERSITES_CLICK="CASHBACK_OTHERSITES_CLICK",e.ZIP_CHECKOUT="ZIP_CHECKOUT",e.PWILO_NOTIFICATION_PRICE_DROP="PWILO_NOTIFICATION_PRICE_DROP",e.YOUTUBE_COUPON_COPIED_HOME="YOUTUBE_COUPON_COPIED_HOME",e.YOUTUBE_COUPON_COPIED_VIDEO="YOUTUBE_COUPON_COPIED_VIDEO",e.YOUTUBE_COUPON_COPIED_RETAILER="YOUTUBE_COUPON_COPIED_RETAILER",e.YOUTUBE_COUPON_COPIED_RETAILER_CHECKOUT="YOUTUBE_COUPON_COPIED_RETAILER_CHECKOUT",e.YOUTUBE_TRY_ALL_COUPONS="YOUTUBE_TRY_ALL_COUPONS",e.CASHBACK_RETAILER_CLICK="CASHBACK_RETAILER_CLICK",e.ACTIVATE_CASHBACK_RETURNED="ACTIVATE_CASHBACK_RETURNED",e.PRINT_COUPONS_CLICK="PRINT_COUPONS_CLICK",e.SELECT_PRINTABLE_COUPON="SELECT_PRINTABLE_COUPON",e.DIGITAL_GROCERY_COUPONS_CLICK="DIGITAL_GROCERY_COUPONS_CLICK",e.PINTEREST_COUPON_COPIED="PINTEREST_COUPON_COPIED",e.PINTEREST_CASHBACK_ACTIVATED="PINTEREST_CASHBACK_ACTIVATED",e.PINTEREST_VIEW_PRICE_HISTORY="PINTEREST_VIEW_PRICE_HISTORY",e.PACKAGE_TRACKING_EXPAND_SECTION="PACKAGE_TRACKING_EXPAND_SECTION",e.PACKAGE_TRACKING_OPT_IN="PACKAGE_TRACKING_OPT_IN",e.PACKAGE_TRACKING_CARD_CLICKED="PACKAGE_TRACKING_CARD_CLICKED",e.AUTOS_MARKETPLACE_TITLE_CLICK="AUTOS_MARKETPLACE_TITLE_CLICK",e.AUTOS_MARKETPLACE_RECOMMENDATION_CLICK="AUTOS_MARKETPLACE_RECOMMENDATION_CLICK",e.AUTOS_MARKETPLACE_SEE_MORE_CLICK="AUTOS_MARKETPLACE_SEE_MORE_CLICK",e.AUTOS_MARKETPLACE_MYGARAGE_CHECK_NOW="AUTOS_MARKETPLACE_MYGARAGE_CHECK_NOW",e.AUTOS_PRICE_INSIGHT_SEE_MORE_CLICK="AUTOS_PRICE_INSIGHT_SEE_MORE_CLICK",e.AUTOS_PRICE_INSIGHT_RATINGURL_CLICK="AUTOS_PRICE_INSIGHT_RATINGURL_CLICK",e.AUTOS_REVIEWS_VIDEO_CLICK="AUTOS_REVIEWS_VIDEO_CLICK",e.AUTOS_REVIEWS_VIDEO_SEE_MORE_CLICK="AUTOS_REVIEWS_VIDEO_SEE_MORE_CLICK",e.AUTOS_MYGARAGE_TITLE_CLICK="AUTOS_MYGARAGE_TITLE_CLICK",e.AUTOS_MYGARAGE_MODULE_CLICK="AUTOS_MYGARAGE_MODULE_CLICK",e.GO_TO_ABANDONED_CART="GO_TO_ABANDONED_CART",e.GO_TO_WIN_CART="GO_TO_WIN_CART",e.INPUT_COUPON="INPUT_COUPON",e.SUBMIT_COUPON="SUBMIT_COUPON",e.AWARENESS_SEE_MORE="AWARENESS_SEE_MORE",e.PRODUCT_TRACKED_STOCK="PRODUCT_TRACKED_STOCK",e.PRODUCT_TRACKED_PRICE="PRODUCT_TRACKED_PRICE",e.PRODUCT_TRACKING_PRODUCT_NOTIFICATION_CLICK="PRODUCT_TRACKING_PRODUCT_NOTIFICATION_CLICK",e.PRODUCT_TRACKING_PRODUCT_COLLECTIONS_CLICK="PRODUCT_TRACKING_PRODUCT_COLLECTIONS_CLICK",e.PRODUCT_TRACKING_COLLECTIONS_TRACK_CLICK="PRODUCT_TRACKING_COLLECTIONS_TRACK_CLICK",e.PRODUCT_TRACKING_COLLECTIONS_VIEW_STEPS="PRODUCT_TRACKING_COLLECTIONS_VIEW_STEPS",e.PRODUCT_TRACKING_COLLECTIONS_START_TRACKING="PRODUCT_TRACKING_COLLECTIONS_START_TRACKING",e.PRODUCT_TRACKED_VIEW_TRACKED_PRODUCTS="PRODUCT_TRACKED_VIEW_TRACKED_PRODUCTS",e.PRODUCT_TRACKING_ABANDONED_CART_TRACK_CLICK="PRODUCT_TRACKING_ABANDONED_CART_TRACK_CLICK",e.CLICK_BEST_COUPON="CLICK_BEST_COUPON",e.SEE_MORE_TRENDING_COUPONS="SEE_MORE_TRENDING_COUPONS",e.INBOX_COUPONS_SIGN_IN_EDGE="INBOX_COUPONS_SIGN_IN_EDGE",e.INBOX_COUPONS_CONNECT_OUTLOOK_INBOX="INBOX_COUPONS_CONNECT_OUTLOOK_INBOX",e.INBOX_COUPONS_CONNECT_GMAIL_INBOX="INBOX_COUPONS_CONNECT_GMAIL_INBOX",e.INBOX_COUPONS_RECONNECT_INBOX="INBOX_COUPONS_RECONNECT_INBOX",e.INBOX_COUPONS_COPY_COUPON="INBOX_COUPONS_COPY_COUPON",e.INBOX_COUPONS_DISCONNECT_INBOX="INBOX_COUPONS_DISCONNECT_INBOX",e.NAVIGATE_TO_TRENDING_DEAL="NAVIGATE_TO_TRENDING_DEAL",e.PRODUCT_TRACKING_NOTIFICATION_TRACK="PRODUCT_TRACKING_NOTIFICATION_TRACK",e.PRODUCT_TRACKING_COLLECTIONS_RECENT_SEE_MORE_CLICK="PRODUCT_TRACKING_COLLECTIONS_RECENT_SEE_MORE_CLICK",e.PRODUCT_TRACKING_COLLECTIONS_TRACKED_PRODUCT_SEE_MORE_CLICK="PRODUCT_TRACKING_COLLECTIONS_TRACKED_PRODUCT_SEE_MORE_CLICK",e.NOTIFICATION_MOMENT_IN_TIME="NOTIFICATION_MOMENT_IN_TIME",e.FEED_MOMENT_IN_TIME="FEED_MOMENT_IN_TIME",e.FEED_TRENDING_OFFERS="FEED_TRENDING_OFFERS",e.FEED_TRENDING_OFFERS_SHOW_MORE="FEED_TRENDING_OFFERS_SHOW_MORE",e.FEED_DAILY_DEALS="FEED_DAILY_DEALS",e.FEED_DAILY_DEALS_SHOW_MORE="FEED_DAILY_DEALS_SHOW_MORE",e.FEED_INFINITE_CATEGORY="FEED_INFINITE_CATEGORY",e.FEED_INFINITE_CATEGORY_SHOW_MORE="FEED_INFINITE_CATEGORY_SHOW_MORE",e.SWITCH_TO_TAB1="SWITCH_TO_TAB1",e.SWITCH_TO_TAB2="SWITCH_TO_TAB2",e.SWITCH_TO_TAB3="SWITCH_TO_TAB3",e.SCROLL_TO_TAB1="SCROLL_TO_TAB1",e.SCROLL_TO_TAB2="SCROLL_TO_TAB2",e.SCROLL_TO_TAB3="SCROLL_TO_TAB3",e.FEED_BUY_DIRECT="FEED_BUY_DIRECT",e.FEED_BUY_DIRECT_SHOW_MORE="FEED_BUY_DIRECT_SHOW_MORE",e.FETCH_SEARCH_RESULTS="FETCH_SEARCH_RESULTS",e.SEARCH_BOX_FOCUSED="SEARCH_BOX_FOCUSED",e.FEED_INFINITE_CATEGORY_AD="FEED_INFINITE_CATEGORY_AD",e.FEED_RELATED_PRODUCTS="FEED_RELATED_PRODUCTS",e.FEED_NATIVE_ADS="FEED_NATIVE_ADS",e.FEED_SEARCH_RESULTS="FEED_SEARCH_RESULTS",e.FEED_SIMILAR_OFFERS="FEED_SIMILAR_OFFERS",e.FEED_TRENDING_OFFERS_ON_CONTEXTUAL_TAB="FEED_TRENDING_OFFERS_ON_CONTEXTUAL_TAB",e.FEED_VISUAL_SEARCH="FEED_VISUAL_SEARCH",e.CJK_OPEN_FLYOUT="CJK_OPEN_FLYOUT",e.CJK_OPEN_PANE_FROM_FLYOUT="CJK_OPEN_PANE_FROM_FLYOUT",e.CJK_OPEN_PANE_FROM_SIDEBAR="CJK_OPEN_PANE_FROM_SIDEBAR",e.CJK_SCROLL_PAGE="CJK_SCROLL_PAGE",e.CJK_SWITCH_TO_TAB1="CJK_SWITCH_TO_TAB1",e.CJK_SWITCH_TO_TAB2="CJK_SWITCH_TO_TAB2",e.CJK_COUPONS_CLICK="CJK_COUPONS_CLICK",e.CJK_COUPONS_SEE_MORE="CJK_COUPONS_SEE_MORE",e.CJK_VIEW_PRICE_HISTORY="CJK_VIEW_PRICE_HISTORY",e.CJK_PRICE_HISTORY_SET_TIMERANGE="CJK_PRICE_HISTORY_SET_TIMERANGE",e.CJK_PRICE_COMPARISON_CLICK="CJK_PRICE_COMPARISON_CLICK",e.CJK_CLICK_PRICE_COMPARISON_SEE_MORE="CJK_CLICK_PRICE_COMPARISON_SEE_MORE",e.CJK_SIMILAR_PRODUCTS_CLICK="CJK_SIMILAR_PRODUCTS_CLICK",e.CJK_ACTIVITY_CLICK="CJK_ACTIVITY_CLICK",e.CJK_ACTIVITY_SEE_MORE="CJK_ACTIVITY_SEE_MORE",e.CJK_TRENDING_PRODUCTS_CLICK="CJK_TRENDING_PRODUCTS_CLICK",e.CJK_TRENDING_PRODUCTS_SET_CATEGORY="CJK_TRENDING_PRODUCTS_SET_CATEGORY",e.CJK_TRENDING_PRODUCTS_SET_RETAILER="CJK_TRENDING_PRODUCTS_SET_RETAILER",e.CJK_COUPONS_CHECK_COUPON="CJK_COUPONS_CHECK_COUPON",e.CAMPAIGN_SHOP_NOW_BANNER_BUTTON_CLICK="CAMPAIGN_SHOP_NOW_BANNER_BUTTON_CLICK",e.FEED_CAMPAIGN="FEED_CAMPAIGN",e.CAMPAIGN_CASHBACK_BANNER="CAMPAIGN_CASHBACK_BANNER",e.AX_SHOP_INVOKED_PRODUCT_NAME="AX_SHOP_INVOKED_PRODUCT_NAME",e.AX_SHOP_INVOKED_PRODUCT_PRICE="AX_SHOP_INVOKED_PRODUCT_PRICE",e.AX_SHOP_INVOKED_PRODUCT_REVIEW_COUNT="AX_SHOP_INVOKED_PRODUCT_REVIEW_COUNT",e.AX_SHOP_INVOKED_PRODUCT_MANUFACTURER="AX_SHOP_INVOKED_PRODUCT_MANUFACTURER",e.AX_SHOP_INVOKED_PRODUCT_OUT_OF_STOCK_MESSAGE="AX_SHOP_INVOKED_PRODUCT_OUT_OF_STOCK_MESSAGE",e.AX_SHOP_INVOKED_PRODUCT_RATING="AX_SHOP_INVOKED_PRODUCT_RATING",e.AX_SHOP_INVOKED_PRODUCT_OTHER="AX_SHOP_INVOKED_PRODUCT_OTHER",e.TRY_PRODUCT_BEST_COUPON="TRY_PRODUCT_BEST_COUPON",e.VIEW_COUPONS_FROM_NOTIFICATION="VIEW_COUPONS_FROM_NOTIFICATION",e.VIEW_PRICE_COMPARISON_FROM_NOTIFICATION="VIEW_PRICE_COMPARISON_FROM_NOTIFICATION",e.CAMPAIGN_AWARENESS_BANNER_BUTTON_CLICK="CAMPAIGN_AWARENESS_BANNER_BUTTON_CLICK",e.SHOPPING_CHIPS="SHOPPING_CHIPS",e.SMART_COMPARE="SMART_COMPARE",e.BUYING_GUIDES="BUYING_GUIDES",e.WISHLIST_SAVE="WISHLIST_SAVE",e.WISHLIST_UNSAVE="WISHLIST_UNSAVE",e.WISHLIST_SEE_ALL="WISHLIST_SEE_ALL",e.PRICE_MATCH_OPT_IN="PRICE_MATCH_OPT_IN",e.PRICE_MATCH_CARD_CLICK="PRICE_MATCH_CARD_CLICK",e.PRICE_MATCH_CARD_CTA_CLICK="PRICE_MATCH_CARD_CTA_CLICK",e.PRICE_MATCH_NOTIFICATION_CTA_CLICK="PRICE_MATCH_NOTIFICATION_CTA_CLICK",e.CASHBACK_MODULE_VIEW_OFFER_DETAILS_CLICK="CASHBACK_MODULE_VIEW_OFFER_DETAILS_CLICK",e.CASHBACK_MODULE_VIEW_OFFER_DETAILS_SEELESS_CLICK="CASHBACK_MODULE_VIEW_OFFER_DETAILS_SEELESS_CLICK",e.CASHBACK_MODULE_FLYOUT_TAG_CLICK="CASHBACK_MODULE_FLYOUT_TAG_CLICK",e.PRODUCT_TRACKING_COLLECTIONS_SIGN_IN="PRODUCT_TRACKING_COLLECTIONS_SIGN_IN",e.PRODUCT_TRACKING_COLLECTIONS_ROAM="PRODUCT_TRACKING_COLLECTIONS_ROAM",e.ACTIVATE_CLICK_SPB_CASHBACK="ACTIVATE_CLICK_SPB_CASHBACK",e.TRY_BGAA_BEST_COUPON="TRY_BGAA_BEST_COUPON",e.TRAVEL_CHEAPER_FLIGHTS_CLICK="TRAVEL_CHEAPER_FLIGHTS_CLICK",e.TRAVEL_CHEAPER_HOTEL_CLICK="TRAVEL_CHEAPER_HOTEL_CLICK ",e.BUYING_OPTIONS_FILTERCHANGE="BUYING_OPTIONS_FILTERCHANGE",e.BUYING_OPTIONS_RETAILER_HOVER="BUYING_OPTIONS_RETAILER_HOVER"}(Ed||(Ed={})),function(e){e[e.COUPONS_COPIED=0]="COUPONS_COPIED",e[e.NAVIGATE_TO_RETAILER=1]="NAVIGATE_TO_RETAILER",e[e.TRY_ALL_COUPONS=2]="TRY_ALL_COUPONS",e[e.SHOW_MORE_SELLERS=3]="SHOW_MORE_SELLERS",e[e.REBATES_LEARN_MORE=4]="REBATES_LEARN_MORE",e[e.REBATES_ACCOUNT=5]="REBATES_ACCOUNT",e[e.REBATES_HISTORY=6]="REBATES_HISTORY",e[e.ACTIVATE_CASHBACK=7]="ACTIVATE_CASHBACK",e[e.EXPAND_GRAPH=8]="EXPAND_GRAPH",e[e.VIEW_PRICE_HISTORY=9]="VIEW_PRICE_HISTORY",e[e.COUPONS_COPIED_AUTOFILL=10]="COUPONS_COPIED_AUTOFILL",e[e.TRY_ALL_COUPONS_AUTOFILL=11]="TRY_ALL_COUPONS_AUTOFILL",e[e.NAVIGATE_TO_DEAL_OFFER=12]="NAVIGATE_TO_DEAL_OFFER",e[e.NAVIGATE_TO_PROFESSIONAL_REVIEW=13]="NAVIGATE_TO_PROFESSIONAL_REVIEW",e[e.NAVIGATE_TO_VIDEO_REVIEW=14]="NAVIGATE_TO_VIDEO_REVIEW",e[e.EXPRESS_CHECKOUT=15]="EXPRESS_CHECKOUT",e[e.OPEN_FLYOUT=16]="OPEN_FLYOUT",e[e.NAVIGATE_TO_RECOMMENDATION_OFFER=17]="NAVIGATE_TO_RECOMMENDATION_OFFER",e[e.CLIP_COUPON=18]="CLIP_COUPON",e[e.ACTIVATE_CASHBACK_NEW=19]="ACTIVATE_CASHBACK_NEW",e[e.ACTIVATE_REWARDS_NEW=20]="ACTIVATE_REWARDS_NEW",e[e.ADD_TO_CART_FROM_OTHER_SELLER=21]="ADD_TO_CART_FROM_OTHER_SELLER",e[e.PRODUCT_HISTORY_NAVIGATION=22]="PRODUCT_HISTORY_NAVIGATION",e[e.NAVIGATE_TO_OTHER_SELLER=23]="NAVIGATE_TO_OTHER_SELLER",e[e.TIPS_CLICK=24]="TIPS_CLICK",e[e.REWARDS_SIGNIN_CLICK=25]="REWARDS_SIGNIN_CLICK",e[e.REWARDS_REDEEM_CLICK=26]="REWARDS_REDEEM_CLICK",e[e.CASHBACK_OTHERSITES_CLICK=27]="CASHBACK_OTHERSITES_CLICK",e[e.ZIP_CHECKOUT=29]="ZIP_CHECKOUT",e[e.PWILO_NOTIFICATION_PRICE_DROP=30]="PWILO_NOTIFICATION_PRICE_DROP",e[e.YOUTUBE_COUPON_COPIED_HOME=31]="YOUTUBE_COUPON_COPIED_HOME",e[e.YOUTUBE_COUPON_COPIED_VIDEO=32]="YOUTUBE_COUPON_COPIED_VIDEO",e[e.YOUTUBE_COUPON_COPIED_RETAILER=33]="YOUTUBE_COUPON_COPIED_RETAILER",e[e.YOUTUBE_COUPON_COPIED_RETAILER_CHECKOUT=34]="YOUTUBE_COUPON_COPIED_RETAILER_CHECKOUT",e[e.YOUTUBE_TRY_ALL_COUPONS=35]="YOUTUBE_TRY_ALL_COUPONS",e[e.CASHBACK_RETAILER_CLICK=36]="CASHBACK_RETAILER_CLICK",e[e.ACTIVATE_CASHBACK_RETURNED=37]="ACTIVATE_CASHBACK_RETURNED",e[e.PRINT_COUPONS_CLICK=38]="PRINT_COUPONS_CLICK",e[e.SELECT_PRINTABLE_COUPON=39]="SELECT_PRINTABLE_COUPON",e[e.DIGITAL_GROCERY_COUPONS_CLICK=40]="DIGITAL_GROCERY_COUPONS_CLICK",e[e.PINTEREST_COUPON_COPIED=41]="PINTEREST_COUPON_COPIED",e[e.PINTEREST_CASHBACK_ACTIVATED=42]="PINTEREST_CASHBACK_ACTIVATED",e[e.PINTEREST_VIEW_PRICE_HISTORY=43]="PINTEREST_VIEW_PRICE_HISTORY",e[e.PACKAGE_TRACKING_EXPAND_SECTION=44]="PACKAGE_TRACKING_EXPAND_SECTION",e[e.PACKAGE_TRACKING_OPT_IN=45]="PACKAGE_TRACKING_OPT_IN",e[e.PACKAGE_TRACKING_CARD_CLICKED=46]="PACKAGE_TRACKING_CARD_CLICKED",e[e.SUSTAINABILITY_LANDING_FULL_LEARN_MORE=47]="SUSTAINABILITY_LANDING_FULL_LEARN_MORE",e[e.SUSTAINABILITY_LANDING_FOOTER_LEARN_MORE=48]="SUSTAINABILITY_LANDING_FOOTER_LEARN_MORE",e[e.SUSTAINABILITY_PURCHASE_CONFIRMATION_LEARN_MORE=49]="SUSTAINABILITY_PURCHASE_CONFIRMATION_LEARN_MORE",e[e.SUSTAINABILITY_PURCHASE_CONFIRMATION_SHOW_PRODUCTS=50]="SUSTAINABILITY_PURCHASE_CONFIRMATION_SHOW_PRODUCTS",e[e.SUSTAINABILITY_PURCHASE_CONFIRMATION_SOCIAL_SHARE=51]="SUSTAINABILITY_PURCHASE_CONFIRMATION_SOCIAL_SHARE",e[e.NTP_REBATES_REDEEM=52]="NTP_REBATES_REDEEM",e[e.NTP_REBATES_EXPLORE_RETAILERS=53]="NTP_REBATES_EXPLORE_RETAILERS",e[e.NTP_CART_NAVIGATE_TO_CART=54]="NTP_CART_NAVIGATE_TO_CART",e[e.NTP_CART_EXPLORE_MORE=55]="NTP_CART_EXPLORE_MORE",e[e.NTP_CART_VIEW_PRODUCT=56]="NTP_CART_VIEW_PRODUCT",e[e.NTP_DROP_VIEW_PRODUCT=57]="NTP_DROP_VIEW_PRODUCT",e[e.NTP_DROP_SEE_MORE=58]="NTP_DROP_SEE_MORE",e[e.NTP_RETAILERS_VIEW_RETAILER=59]="NTP_RETAILERS_VIEW_RETAILER",e[e.NTP_RETAILERS_EXPLORE_MORE=60]="NTP_RETAILERS_EXPLORE_MORE",e[e.NTP_OFFER_BUY_NOW=61]="NTP_OFFER_BUY_NOW",e[e.CLICK_PCB_CROSS_SESSION=62]="CLICK_PCB_CROSS_SESSION",e[e.REWARD_JOIN_NOW=63]="REWARD_JOIN_NOW",e[e.REWARD_MAYBE_LATER=64]="REWARD_MAYBE_LATER",e[e.REWARD_DISMISS=65]="REWARD_DISMISS",e[e.ACTIVATE_CLICK_ITEMIZED_CASHBACK=66]="ACTIVATE_CLICK_ITEMIZED_CASHBACK",e[e.ACTIVATED_CLICK_ITEMIZED_CASHBACK=67]="ACTIVATED_CLICK_ITEMIZED_CASHBACK",e[e.HOVER_INFO_ICON_ITEMIZED_CASHBACK=68]="HOVER_INFO_ICON_ITEMIZED_CASHBACK",e[e.CLICK_DISCLAIMER_ITEMIZED_CASHBACK=69]="CLICK_DISCLAIMER_ITEMIZED_CASHBACK",e[e.REMIND_ME_LATER=70]="REMIND_ME_LATER",e[e.GROCERY=71]="GROCERY",e[e.NTP_TOP_SITES_HOVER=72]="NTP_TOP_SITES_HOVER",e[e.NTP_TOP_SITES_CART_PRODUCT=73]="NTP_TOP_SITES_CART_PRODUCT",e[e.NTP_TOP_SITES_CART_BUTTON=74]="NTP_TOP_SITES_CART_BUTTON",e[e.NTP_TOP_SITES_PRICE_DROP_PRODUCT=75]="NTP_TOP_SITES_PRICE_DROP_PRODUCT",e[e.NTP_TOP_SITES_STORE_CASHBACK=76]="NTP_TOP_SITES_STORE_CASHBACK",e[e.FEED_TRENDING_OFFERS=77]="FEED_TRENDING_OFFERS",e[